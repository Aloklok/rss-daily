[{"filePath":"/Users/Alok/alok-rss-daily/app/api/article-states/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":10,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":10,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getFreshRssClient } from '../../lib/api-utils';\n\ninterface FreshRssItem {\n    id: string;\n    categories: string[];\n    annotations?: { id: string }[];\n}\n\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { articleIds } = body;\n\n        if (!Array.isArray(articleIds) || articleIds.length === 0) {\n            return NextResponse.json({});\n        }\n\n        const freshRss = getFreshRssClient();\n        const formData = new URLSearchParams();\n        articleIds.forEach((id: string | number) => formData.append('i', String(id)));\n\n        const data = await freshRss.post<{ items: FreshRssItem[] }>('/stream/items/contents?output=json&excludeContent=1', formData);\n\n        const states: { [key: string]: string[] } = {};\n        if (data.items) {\n            data.items.forEach((item: FreshRssItem) => {\n                const annotationTags = (item.annotations || [])\n                    .map(anno => anno.id)\n                    .filter(Boolean);\n\n                const allTags = [\n                    ...(item.categories || []),\n                    ...annotationTags\n                ];\n\n                states[item.id] = [...new Set(allTags)];\n            });\n        }\n\n        return NextResponse.json(states);\n    } catch (error: any) {\n        return NextResponse.json({ message: 'Error fetching article states', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/articles-categories-tags/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":38,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":38,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2147,2150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2147,2150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getFreshRssClient } from '../../lib/api-utils';\nimport { Article, FreshRSSItem } from '../../../types';\n\nexport const dynamic = 'force-dynamic';\n\nfunction mapFreshItemToMinimalArticle(item: FreshRSSItem): Article {\n    const annotationTags = (item.annotations || [])\n        .map((anno: { id: string }) => anno.id)\n        .filter(Boolean);\n\n    const allTags = [\n        ...(Array.isArray(item.categories) ? item.categories : []),\n        ...annotationTags\n    ];\n\n    return {\n        id: item.id || '',\n        title: item.title || '',\n        link: item.alternate?.[0]?.href || '',\n        sourceName: item.origin?.title || '',\n        created_at: new Date().toISOString(),\n        published: new Date(item.published * 1000).toISOString(),\n        category: '',\n        briefingSection: '',\n        keywords: [],\n        verdict: { type: '', score: 0 },\n        summary: '',\n        tldr: '',\n        highlights: '',\n        critiques: '',\n        marketTake: '',\n        n8n_processing_date: undefined,\n        tags: allTags,\n    };\n}\n\nexport async function GET(request: NextRequest) {\n    const searchParams = request.nextUrl.searchParams;\n    const streamId = searchParams.get('value'); // Note: frontend sends 'value' as param name? Original code used req.query.value\n    const n = searchParams.get('n');\n    const c = searchParams.get('c');\n\n    if (!streamId) {\n        return NextResponse.json({ message: 'Stream ID is required.' }, { status: 400 });\n    }\n\n    const freshRss = getFreshRssClient();\n    const safeStreamId = streamId.replace(/&/g, '%26');\n\n    const params: Record<string, string> = {\n        output: 'json',\n        excludeContent: '1'\n    };\n    if (n) params.n = n;\n    if (c) params.c = c;\n\n    try {\n        const data = await freshRss.get<{ items: FreshRSSItem[], continuation?: string }>(`/stream/contents/${safeStreamId}`, params);\n        const articles = (data.items || []).map(mapFreshItemToMinimalArticle);\n\n        return NextResponse.json({\n            articles,\n            continuation: data.continuation\n        });\n    } catch (error: any) {\n        return NextResponse.json({ message: 'Error fetching from FreshRSS', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/articles/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[626,629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[626,629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { fetchArticleContentServer } from '../../lib/data';\n\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { id } = body;\n\n        if (!id) {\n            return NextResponse.json({ message: 'Article ID is required.' }, { status: 400 });\n        }\n\n        const data = await fetchArticleContentServer(id);\n\n        if (!data) {\n            return NextResponse.json({ message: 'Article content not found.' }, { status: 404 });\n        }\n\n        return NextResponse.json(data);\n    } catch (error: any) {\n        console.error('Error in articles API:', error);\n        return NextResponse.json({ message: 'Internal Server Error', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/auth/check/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":6,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET() {\n    const accessToken = process.env.ACCESS_TOKEN;\n    if (!accessToken) {\n        return NextResponse.json({ isAdmin: false, error: 'Server misconfiguration' }, { status: 500 });\n    }\n\n    const cookieStore = await cookies();\n    const siteToken = cookieStore.get('site_token')?.value;\n\n    if (siteToken === accessToken) {\n        return NextResponse.json({ isAdmin: true });\n    }\n\n    return NextResponse.json({ isAdmin: false });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/daily-statuses/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":7,"endColumn":26},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":41,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":41,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2442,2445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2442,2445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getSupabaseClient, verifyAdmin } from '../../lib/api-utils';\nimport { cookies } from 'next/headers';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET(request: NextRequest) {\n    const searchParams = request.nextUrl.searchParams;\n    const start_date = searchParams.get('start_date');\n    const end_date = searchParams.get('end_date');\n\n    if (!start_date || !end_date) {\n        return NextResponse.json({ message: 'start_date and end_date parameters are required.' }, { status: 400 });\n    }\n\n    const supabase = getSupabaseClient();\n\n    const { data, error } = await supabase\n        .from('daily_briefing_status')\n        .select('date, is_completed')\n        .gte('date', start_date)\n        .lte('date', end_date);\n\n    if (error) {\n        console.error('Supabase error in get-daily-statuses:', error);\n        return NextResponse.json({ message: 'Error fetching daily statuses', error: error.message }, { status: 500 });\n    }\n\n    const statuses = (data || []).reduce((acc, row) => {\n        acc[row.date] = row.is_completed;\n        return acc;\n    }, {} as Record<string, boolean>);\n\n    return NextResponse.json(statuses, {\n        headers: {\n            'Cache-Control': 'no-store, max-age=0',\n        },\n    });\n}\n\nexport async function POST(request: NextRequest) {\n    const cookieStore = await cookies();\n    if (!verifyAdmin(cookieStore)) {\n        return NextResponse.json({ message: 'Unauthorized: Admin access required' }, { status: 403 });\n    }\n\n    try {\n        const body = await request.json();\n        const { date, is_completed } = body;\n\n        if (!date || typeof is_completed !== 'boolean') {\n            return NextResponse.json({ message: 'date (YYYY-MM-DD) and is_completed (boolean) are required.' }, { status: 400 });\n        }\n\n        const supabase = getSupabaseClient();\n\n        const { error } = await supabase\n            .from('daily_briefing_status')\n            .upsert(\n                { date: date, is_completed: is_completed },\n                { onConflict: 'date' }\n            );\n\n        if (error) {\n            console.error('Supabase error in update-daily-status:', error);\n            return NextResponse.json({ message: 'Error updating daily status', error: error.message }, { status: 500 });\n        }\n\n        return NextResponse.json({ success: true, date, is_completed });\n    } catch (error: any) {\n        return NextResponse.json({ message: 'Internal Server Error', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/get-available-dates/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":6,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { getSupabaseClient } from '../../lib/api-utils';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET() {\n    const supabase = getSupabaseClient();\n\n    const { data, error } = await supabase\n        .from('articles')\n        .select('n8n_processing_date')\n        .order('n8n_processing_date', { ascending: false });\n\n    if (error) {\n        console.error('Supabase error in get-available-dates:', error);\n        return NextResponse.json({ message: 'Error fetching available dates', error: error.message }, { status: 500 });\n    }\n\n    // Process the data to get unique dates based on the Asia/Shanghai timezone\n    const dateSet = new Set<string>();\n    if (data) {\n        const formatter = new Intl.DateTimeFormat('en-CA', { // en-CA format is YYYY-MM-DD\n            year: 'numeric',\n            month: '2-digit',\n            day: '2-digit',\n            timeZone: 'Asia/Shanghai',\n        });\n\n        data.forEach(item => {\n            if (item.n8n_processing_date) {\n                const date = new Date(item.n8n_processing_date);\n                dateSet.add(formatter.format(date));\n            }\n        });\n    }\n\n    const dates = Array.from(dateSet);\n    return NextResponse.json(dates);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/get-briefings/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":7,"endColumn":26},{"ruleId":"prefer-const","severity":2,"message":"'startDate' is never reassigned. Use 'const' instead.","line":91,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":91,"endColumn":14},{"ruleId":"prefer-const","severity":2,"message":"'endDate' is never reassigned. Use 'const' instead.","line":92,"column":5,"nodeType":"Identifier","messageId":"useConst","endLine":92,"endColumn":12}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getSupabaseClient } from '../../lib/api-utils';\nimport { Article } from '../../../types'; // Adjust path as needed\n\nexport const dynamic = 'force-dynamic'; // Ensure this runs dynamically\n\nexport async function GET(request: NextRequest) {\n    const searchParams = request.nextUrl.searchParams;\n    const date = searchParams.get('date');\n    const slot = searchParams.get('slot');\n    const articleIdsParam = searchParams.get('articleIds');\n\n    // 1. Query by IDs\n    if (articleIdsParam) {\n        const supabase = getSupabaseClient();\n        // Handle array format if passed as multiple params, but standard URLSearchParams handles duplicates differently.\n        // Here we assume comma-separated or multiple keys. Next.js searchParams.getAll('articleIds') handles multiple keys.\n        // But the original code might expect 'id1,id2' or repeated params.\n        // Let's support both: getAll and comma split.\n        let ids: string[] = searchParams.getAll('articleIds');\n        // Removed comma splitting because some IDs (e.g. FreshRSS tag IDs) contain commas.\n        // The client sends multiple 'articleIds' params which getAll handles correctly.\n\n        // If still empty, check if it was passed as 'articleIds[]'\n        if (ids.length === 0) {\n            const idsBrackets = searchParams.getAll('articleIds[]');\n            if (idsBrackets.length > 0) ids = idsBrackets;\n        }\n\n        if (ids.length > 0) {\n            const { data: articles, error } = await supabase\n                .from('articles')\n                .select('*')\n                .in('id', ids);\n\n            if (error) {\n                console.error('Error fetching from Supabase by IDs:', error);\n                return NextResponse.json({ error: error.message }, { status: 500 });\n            }\n\n            const articlesById = (articles || []).reduce((acc, article) => {\n                acc[article.id] = article;\n                return acc;\n            }, {} as Record<string, Article>);\n\n            return NextResponse.json(articlesById);\n        }\n    }\n\n    // 2. Query by Date\n    if (!date) {\n        return NextResponse.json({ message: 'Date parameter is required.' }, { status: 400 });\n    }\n\n    const supabase = getSupabaseClient();\n    let query = supabase.from('articles').select('*');\n\n    let startDate: Date;\n    let endDate: Date;\n\n    // Use UTC construction to match the logic in original file (which used string construction +08:00)\n    // But since we are in Node environment, Date parsing with timezone offset works if the string is correct.\n    // Original: new Date(`${date}T00:00:00.000+08:00`)\n    // We can replicate this logic or use the robust Date.UTC method we used elsewhere.\n    // Let's stick to the original logic for consistency unless it was broken (which we fixed elsewhere).\n    // Actually, we fixed it in `app/lib/data.ts` using Date.UTC. Let's use that robust approach here too.\n\n    const [year, month, day] = date.split('-').map(Number);\n\n    // Shanghai is UTC+8.\n    // 00:00:00 Shanghai = 16:00:00 UTC (previous day)\n    let startHourUtc = 0 - 8;\n    let endHourUtc = 23 - 8;\n    const startMinute = 0; const endMinute = 59;\n    const startSecond = 0; const endSecond = 59;\n\n    if (slot === 'morning') {\n        // 00:00 - 11:59 Shanghai\n        startHourUtc = 0 - 8;\n        endHourUtc = 11 - 8;\n    } else if (slot === 'afternoon') {\n        // 12:00 - 18:59 Shanghai\n        startHourUtc = 12 - 8;\n        endHourUtc = 18 - 8;\n    } else if (slot === 'evening') {\n        // 19:00 - 23:59 Shanghai\n        startHourUtc = 19 - 8;\n        endHourUtc = 23 - 8;\n    }\n\n    startDate = new Date(Date.UTC(year, month - 1, day, startHourUtc, startMinute, startSecond, 0));\n    endDate = new Date(Date.UTC(year, month - 1, day, endHourUtc, endMinute, endSecond, 999));\n\n    query = query.gte('n8n_processing_date', startDate.toISOString());\n    query = query.lte('n8n_processing_date', endDate.toISOString());\n\n    const { data: articles, error } = await query;\n\n    if (error) {\n        console.error('Error fetching from Supabase by date:', error);\n        return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    if (!articles || articles.length === 0) {\n        return NextResponse.json({});\n    }\n\n    const uniqueById = new Map<string | number, Article>();\n    articles.forEach((a: Article) => { uniqueById.set(a.id, a); });\n    const deduped = Array.from(uniqueById.values());\n\n    const groupedArticles: { [key: string]: Article[] } = {\n        '重要新闻': [], '必知要闻': [], '常规更新': [],\n    };\n\n    deduped.forEach(article => {\n        const importance = article.verdict?.importance || '常规更新';\n        if (groupedArticles[importance]) {\n            groupedArticles[importance].push(article);\n        } else {\n            groupedArticles['常规更新'].push(article);\n        }\n    });\n\n    for (const importance in groupedArticles) {\n        groupedArticles[importance].sort((a, b) => (b.verdict?.score || 0) - (a.verdict?.score || 0));\n    }\n\n    return NextResponse.json(groupedArticles);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/indexnow/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":25,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":25,"endColumn":26},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":60,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":60,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":73,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":94,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\nimport { submitUrlsToIndexNow } from '@/utils/indexnow';\nimport { getSitemapUrls } from '../../lib/sitemap-helper';\n\nconst ACCESS_TOKEN = process.env.ACCESS_TOKEN;\n\nasync function isAuthenticated(request: Request): Promise<boolean> {\n    if (!ACCESS_TOKEN) return true; // Open access if no token configured (warning logged in construction?)\n\n    const url = new URL(request.url);\n\n    // 1. Check URL param\n    const tokenParam = url.searchParams.get('token');\n    if (tokenParam === ACCESS_TOKEN) return true;\n\n    // 2. Check Cookie\n    const cookieStore = await cookies();\n    const siteToken = cookieStore.get('site_token')?.value;\n    if (siteToken === ACCESS_TOKEN) return true;\n\n    return false;\n}\n\nexport async function GET(request: Request) {\n    if (!(await isAuthenticated(request))) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const url = searchParams.get('url');\n\n    let urlsToSubmit: string[] = [];\n\n    if (url) {\n        urlsToSubmit = [url];\n    } else {\n        // Auto-submit all sitemap URLs if no specific URL provided\n        console.log('[IndexNow] No URL provided, fetching entire sitemap...');\n        const sitemapItems = await getSitemapUrls();\n        urlsToSubmit = sitemapItems.map(item => item.url);\n    }\n\n    if (urlsToSubmit.length === 0) {\n        return NextResponse.json({ error: 'No URLs found to submit' }, { status: 404 });\n    }\n\n    const success = await submitUrlsToIndexNow(urlsToSubmit);\n\n    return NextResponse.json({\n        success,\n        message: success\n            ? `Submitted ${urlsToSubmit.length} URLs to IndexNow`\n            : 'Submission failed',\n        count: urlsToSubmit.length,\n        urls: urlsToSubmit\n    });\n}\n\nexport async function POST(request: Request) {\n    if (!(await isAuthenticated(request))) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    try {\n        let urls: string[] = [];\n\n        try {\n            const body = await request.json();\n            if (Array.isArray(body.urls)) {\n                urls = body.urls;\n            }\n        } catch (e) {\n            // Body might be empty, which is fine if we want full sync\n        }\n\n        if (urls.length === 0) {\n            console.log('[IndexNow] POST with empty URLs, fetching entire sitemap...');\n            const sitemapItems = await getSitemapUrls();\n            urls = sitemapItems.map(item => item.url);\n        }\n\n        if (urls.length === 0) {\n            return NextResponse.json({ error: 'No URLs found to submit' }, { status: 404 });\n        }\n\n        const success = await submitUrlsToIndexNow(urls);\n\n        return NextResponse.json({\n            success,\n            message: success ? `Submitted ${urls.length} URLs to IndexNow` : 'Submission failed',\n            count: urls.length\n        });\n    } catch (error) {\n        return NextResponse.json({ error: 'Server Error' }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/list-categories-tags/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":13,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":13,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1421,1424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1421,1424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { getFreshRssClient } from '../../lib/api-utils';\nimport { Tag } from '../../../types';\n\nexport const dynamic = 'force-dynamic';\n\ninterface FreshRssTag {\n    id: string;\n    type: string;\n    count?: number;\n}\n\nexport async function GET() {\n    const freshRss = getFreshRssClient();\n\n    try {\n        const data = await freshRss.get<{ tags: FreshRssTag[] }>('/tag/list', {\n            output: 'json',\n            with_counts: '1'\n        });\n        const categories: Tag[] = [];\n        const tags: Tag[] = [];\n\n        if (data.tags) {\n            data.tags.forEach((item) => {\n                const label = decodeURIComponent(item.id.split('/').pop() || '');\n\n                if (item.id.includes('/state/com.google/') || item.id.includes('/state/org.freshrss/')) {\n                    return;\n                }\n\n                if (item.type === 'folder') {\n                    categories.push({ id: item.id, label, count: item.count });\n                } else {\n                    tags.push({ id: item.id, label, count: item.count });\n                }\n            });\n        }\n\n        const sortByName = (a: { label: string }, b: { label: string }) => a.label.localeCompare(b.label, 'zh-Hans-CN');\n\n        return NextResponse.json({\n            categories: categories.sort(sortByName),\n            tags: tags.sort(sortByName),\n        });\n    } catch (error: any) {\n        return NextResponse.json({ message: 'Error fetching categories and tags', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/refresh/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":3,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":3,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(request: NextRequest) {\n    // Redirect to the root of the application\n    return NextResponse.redirect(new URL('/', request.url));\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/revalidate/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":5,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":5,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":35,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { revalidatePath } from 'next/cache';\nimport { cookies } from 'next/headers';\n\nexport async function GET(request: NextRequest) {\n    const secret = request.nextUrl.searchParams.get('secret');\n    const tag = request.nextUrl.searchParams.get('tag');\n\n    // Check for secret provided via query param\n    const isSecretValid = secret === process.env.REVALIDATION_SECRET;\n\n    // Check for admin cookie\n    const cookieStore = await cookies();\n    const tokenCookie = cookieStore.get('site_token');\n    const isCookieValid = tokenCookie?.value === process.env.ACCESS_TOKEN;\n\n    if (!isSecretValid && !isCookieValid) {\n        return NextResponse.json({ message: 'Invalid token' }, { status: 401 });\n    }\n\n    if (!tag) {\n        return NextResponse.json({ message: 'Missing tag parameter' }, { status: 400 });\n    }\n\n    try {\n        const decodedTag = decodeURIComponent(tag);\n        // Revalidate the specific stream page\n        revalidatePath(`/stream/${decodedTag}`);\n\n        // Also revalidate the homepage as it might contain recent stream items\n        revalidatePath('/');\n\n        console.log(`[Revalidate] Successfully revalidated stream for tag: ${decodedTag}`);\n        return NextResponse.json({ revalidated: true, now: Date.now() });\n    } catch (err) {\n        return NextResponse.json({ message: 'Error revalidating' }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/search-articles/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":7,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1217,1220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1217,1220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getSupabaseClient, verifyAdmin } from '../../lib/api-utils';\nimport { cookies } from 'next/headers';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET(request: NextRequest) {\n    const cookieStore = await cookies();\n    if (!verifyAdmin(cookieStore)) {\n        return NextResponse.json({ message: 'Unauthorized: Admin access required' }, { status: 403 });\n    }\n\n    const searchParams = request.nextUrl.searchParams;\n    const query = searchParams.get('query');\n\n    if (!query) {\n        return NextResponse.json({ message: 'Search query parameter is required.' }, { status: 400 });\n    }\n\n    const supabase = getSupabaseClient();\n\n    try {\n        const { data, error } = await supabase\n            .rpc('search_articles_by_partial_keyword', {\n                search_term: query.trim()\n            });\n\n        if (error) {\n            console.error('Supabase RPC error:', error);\n            return NextResponse.json({\n                message: 'Supabase search failed via RPC',\n                details: error.message,\n            }, { status: 500 });\n        }\n\n        return NextResponse.json(data || []);\n\n    } catch (err: any) {\n        console.error('Unexpected server error', err);\n        return NextResponse.json({\n            message: 'Unexpected server error',\n            details: err?.message ?? String(err),\n        }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/sentry-example-api/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":11,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":11,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\n\nexport const dynamic = \"force-dynamic\";\nclass SentryExampleAPIError extends Error {\n  constructor(message: string | undefined) {\n    super(message);\n    this.name = \"SentryExampleAPIError\";\n  }\n}\n// A faulty API route to test Sentry's error monitoring\nexport function GET() {\n  throw new SentryExampleAPIError(\"This error is raised on the backend called by the example page.\");\n  return NextResponse.json({ data: \"Testing Sentry Error...\" });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/sitemap/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":6,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'baseUrl' is assigned a value but never used.","line":8,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { getSitemapUrls } from '../../lib/sitemap-helper';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET() {\n    const urls = await getSitemapUrls();\n    const baseUrl = 'https://www.alok-rss.top'; // Keep for safety or redundancy if needed, though urls has full path\n\n    const sitemap = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n${urls.map(item => `  <url>\n    <loc>${item.url}</loc>\n    ${item.lastmod ? `<lastmod>${item.lastmod}</lastmod>` : ''}\n    <changefreq>${item.changefreq}</changefreq>\n    <priority>${item.priority}</priority>\n  </url>`).join('\\n')}\n</urlset>`;\n\n    return new NextResponse(sitemap, {\n        headers: {\n            'Content-Type': 'application/xml',\n            // Optimized for Daily Briefing Updates (3x/day)\n            // Cache for 1 hour (3600s). Allows crawlers to pick up evening updates.\n            'Cache-Control': 's-maxage=3600, stale-while-revalidate=3600',\n        },\n    });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/api/update-state/route.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":19,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":19,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3393,3396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3393,3396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\nimport { getFreshRssClient, verifyAdmin } from '../../lib/api-utils';\nimport { cookies } from 'next/headers';\nimport { STAR_TAG, READ_TAG } from '../../lib/constants'; // Assuming constants are here or need to be imported\n\n// We need to make sure constants are available. \n// If they were in api/_constants.ts, we should probably move them to app/lib/constants.ts or similar.\n// For now, I'll define them here if not found, or try to import from existing location if possible.\n// Wait, I haven't moved constants yet. Let's assume they are in app/lib/constants.ts or I should create it.\n// Actually, the original code imported from './_constants.js'.\n// Let's check if I should create app/lib/constants.ts.\n// I'll define them here for safety if I can't find them, but better to be consistent.\n// Let's assume I will create app/lib/constants.ts later or use hardcoded values for now to avoid import errors.\n// STAR_TAG = 'user/1001/state/com.google/starred'\n// READ_TAG = 'user/1001/state/com.google/read'\n\n\n\nexport async function POST(request: NextRequest) {\n    const cookieStore = await cookies();\n    if (!verifyAdmin(cookieStore)) {\n        return NextResponse.json({ message: 'Unauthorized: Admin access required' }, { status: 403 });\n    }\n\n    try {\n        const body = await request.json();\n        const { articleId, articleIds, action, isAdding, tagsToAdd, tagsToRemove } = body;\n\n        if ((!articleId && (!articleIds || !Array.isArray(articleIds))) || (!action && typeof isAdding === 'undefined' && (!tagsToAdd || !Array.isArray(tagsToAdd) || tagsToAdd.length === 0) && (!tagsToRemove || !Array.isArray(tagsToRemove) || tagsToRemove.length === 0))) {\n            return NextResponse.json({ message: 'Missing required parameters' }, { status: 400 });\n        }\n        if (action && typeof isAdding !== 'undefined' && typeof isAdding !== 'boolean') {\n            return NextResponse.json({ message: 'When action is provided, isAdding must be a boolean' }, { status: 400 });\n        }\n\n        const freshRss = getFreshRssClient();\n        const shortLivedToken = await freshRss.getActionToken();\n\n        const params = new URLSearchParams();\n\n        const ids = articleIds && Array.isArray(articleIds) ? articleIds : [articleId];\n        ids.forEach((id: string | number) => params.append('i', String(id)));\n        params.append('T', shortLivedToken);\n\n        if (action && typeof isAdding === 'boolean') {\n            const tagMap = {\n                star: STAR_TAG,\n                read: READ_TAG,\n            };\n            const tag = tagMap[action as 'star' | 'read'];\n            if (tag) {\n                params.append(isAdding ? 'a' : 'r', tag);\n            }\n        }\n\n        if (tagsToAdd && Array.isArray(tagsToAdd) && tagsToAdd.length > 0) {\n            tagsToAdd.forEach((tag: string) => params.append('a', tag));\n        }\n        if (tagsToRemove && Array.isArray(tagsToRemove) && tagsToRemove.length > 0) {\n            tagsToRemove.forEach((tag: string) => params.append('r', tag));\n        }\n\n        const responseText = await freshRss.post<string>('/edit-tag', params);\n\n        if (responseText.trim() !== 'OK') {\n            throw new Error(`Failed to update state. FreshRSS responded with: ${responseText}`);\n        }\n\n        return NextResponse.json({ success: true });\n    } catch (error: any) {\n        return NextResponse.json({ message: 'Internal Server Error', error: error.message }, { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/article/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":39,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":39,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Metadata } from 'next';\nimport { fetchArticleById, fetchArticleContentServer } from '../../lib/data';\nimport ArticleDetailClient from '../../components/ArticleDetailClient';\nimport { notFound } from 'next/navigation';\n\nexport const revalidate = false;\n\nexport async function generateMetadata({ params }: { params: Promise<{ id: string }> }): Promise<Metadata> {\n    const { id } = await params;\n    const article = await fetchArticleById(id);\n\n    if (!article) {\n        return {\n            title: 'Article Not Found',\n        };\n    }\n\n    // Truncate summary for description\n    const description = article.summary\n        ? article.summary.replace(/<[^>]+>/g, '').substring(0, 160) + '...'\n        : `Read ${article.title} on Briefing Hub | 在 Briefing Hub 阅读 ${article.title}。`;\n\n    return {\n        title: article.title,\n        description: description,\n        alternates: {\n            canonical: article.link, // Point to original source for SEO protection\n        },\n        openGraph: {\n            title: article.title,\n            description: description,\n            type: 'article',\n            publishedTime: article.published,\n        },\n    };\n}\n\nexport default async function ArticlePage({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n\n    // 1. Fetch metadata (Supabase)\n    const article = await fetchArticleById(id);\n    if (!article) notFound();\n\n    // 2. Fetch full content (FreshRSS) - Server Side\n    const content = await fetchArticleContentServer(article.id);\n\n    const jsonLd = {\n        '@context': 'https://schema.org',\n        '@type': 'NewsArticle',\n        headline: article.title,\n        datePublished: article.published,\n        author: [{\n            '@type': 'Organization',\n            name: article.sourceName || 'Briefing Hub',\n        }],\n    };\n\n    return (\n        <div className=\"max-w-3xl mx-auto px-4 py-8\">\n            <script\n                type=\"application/ld+json\"\n                dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n            />\n            {/* Pass initialContent to Client Component for immediate rendering */}\n            <ArticleDetailClient article={article} initialContent={content} />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/ArticleActions.tsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":23,"column":55,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":149,"endColumn":3},{"ruleId":"react/prop-types","severity":2,"message":"'article' is missing in props validation","line":23,"column":63,"nodeType":"Property","messageId":"missingPropType","endLine":23,"endColumn":70},{"ruleId":"react/prop-types","severity":2,"message":"'className' is missing in props validation","line":23,"column":72,"nodeType":"Property","messageId":"missingPropType","endLine":23,"endColumn":81},{"ruleId":"react/prop-types","severity":2,"message":"'article.id' is missing in props validation","line":42,"column":45,"nodeType":"Identifier","messageId":"missingPropType","endLine":42,"endColumn":47},{"ruleId":"react/prop-types","severity":2,"message":"'article.id' is missing in props validation","line":57,"column":57,"nodeType":"Identifier","messageId":"missingPropType","endLine":57,"endColumn":59},{"ruleId":"react/prop-types","severity":2,"message":"'article.link' is missing in props validation","line":96,"column":38,"nodeType":"Identifier","messageId":"missingPropType","endLine":96,"endColumn":42},{"ruleId":"react/prop-types","severity":2,"message":"'article.id' is missing in props validation","line":105,"column":53,"nodeType":"Identifier","messageId":"missingPropType","endLine":105,"endColumn":55},{"ruleId":"react/prop-types","severity":2,"message":"'article.link' is missing in props validation","line":136,"column":38,"nodeType":"Identifier","messageId":"missingPropType","endLine":136,"endColumn":42}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, memo } from 'react';\nimport Link from 'next/link';\nimport { Article } from '../../types';\nimport { useArticleMetadata } from '../../hooks/useArticleMetadata';\nimport { useUpdateArticleState } from '../../hooks/useArticles'; // Import hook\nimport { useUIStore } from '../../store/uiStore';\nimport TagPopover from '../../components/TagPopover';\nimport { STAR_TAG, READ_TAG } from '../../constants';\nimport { getRandomColorClass } from '../../utils/colorUtils';\n\n// Icons\nconst SpinnerIcon = () => (<svg className=\"animate-spin h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle><path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>);\nconst IconCheckCircle = () => (<svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" /></svg>);\nconst IconCircle = () => (<svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>);\n\ninterface ArticleActionsProps {\n    article: Article;\n    className?: string;\n}\n\nconst ArticleActions: React.FC<ArticleActionsProps> = memo(({ article, className }) => {\n    const { isStarred, isRead, userTagLabels: displayedUserTags } = useArticleMetadata(article);\n    const isAdmin = useUIStore(state => state.isAdmin);\n    const { mutateAsync: updateState } = useUpdateArticleState(); // Use hook directly\n\n    const [isTagPopoverOpen, setIsTagPopoverOpen] = useState(false);\n    const [isLoading, setIsLoading] = useState<'star' | 'read' | null>(null);\n\n    const handleStateChange = async (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => {\n        await updateState({ articleId, tagsToAdd, tagsToRemove });\n    };\n\n    const handleToggleState = async (action: 'star' | 'read') => {\n        setIsLoading(action);\n        const tag = action === 'star' ? STAR_TAG : READ_TAG;\n        const isActive = action === 'star' ? isStarred : isRead;\n        try {\n            const tagsToAdd = isActive ? [] : [tag];\n            const tagsToRemove = isActive ? [tag] : [];\n            await handleStateChange(article.id, tagsToAdd, tagsToRemove);\n        } finally {\n            setIsLoading(null);\n        }\n    };\n\n    const actionButtonClass = \"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 active:scale-95 disabled:opacity-75\";\n    const mobileActionButtonClass = \"flex flex-col items-center justify-center h-16 w-16 text-xs font-medium rounded-full p-1 gap-1 transition-transform active:scale-95\";\n\n    return (\n        <div className={`relative mt-6 md:mt-8 ${className || ''}`}>\n            {/* Desktop Buttons */}\n            <div className=\"hidden md:flex flex-col\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <Link href={`/article/${article.id}`} className={`${actionButtonClass} bg-blue-800 hover:bg-blue-900 text-white`}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" /></svg>\n                            阅读\n                        </Link>\n\n                        {isAdmin && (\n                            <>\n                                <button\n                                    onClick={() => handleToggleState('star')}\n                                    disabled={!!isLoading}\n                                    className={`${actionButtonClass} ${isStarred ? 'bg-amber-400 text-amber-950' : 'bg-amber-200 hover:bg-amber-300 text-amber-900'} ${isLoading ? 'cursor-wait' : ''}`}\n                                >\n                                    {isLoading === 'star' ? <SpinnerIcon /> : <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>}\n                                    {isStarred ? '已收藏' : '收藏'}\n                                </button>\n                                <button\n                                    onClick={() => handleToggleState('read')}\n                                    disabled={!!isLoading}\n                                    className={`${actionButtonClass} ${isRead ? 'bg-emerald-400 text-emerald-950 hover:bg-emerald-500' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} ${isLoading ? 'cursor-wait' : ''}`}\n                                >\n                                    {isLoading === 'read' ? <SpinnerIcon /> : (isRead ? <IconCheckCircle /> : <IconCircle />)}\n                                    {isRead ? '已读' : '标记已读'}\n                                </button>\n                                <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                                    <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className={`${actionButtonClass} bg-sky-200 hover:bg-sky-300 text-sky-900`}>\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                                        标签\n                                    </button>\n                                    {isTagPopoverOpen && <TagPopover article={article} onClose={() => setIsTagPopoverOpen(false)} onStateChange={handleStateChange} />}\n                                </div>\n                            </>\n                        )}\n                        {displayedUserTags.length > 0 && (\n                            <div className=\"hidden md:flex flex-wrap gap-2 items-center\">\n                                <div className=\"border-l border-stone-300 h-6 mx-1\"></div>\n                                {displayedUserTags.map(tagLabel => (tagLabel && <span key={tagLabel} className={`text-xs font-semibold inline-block py-1 px-2.5 rounded-full ${getRandomColorClass(tagLabel)}`}>{tagLabel}</span>))}\n                            </div>\n                        )}\n                    </div>\n                    <a href={article.link} target=\"_blank\" rel=\"noopener noreferrer\" className={`${actionButtonClass} bg-stone-200 hover:bg-stone-300 text-stone-800 w-fit`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" /><path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" /></svg>\n                        原文\n                    </a>\n                </div>\n            </div>\n            {/* Mobile Buttons */}\n            <div className=\"md:hidden mt-8\">\n                <div className=\"flex justify-around items-center\">\n                    <Link href={`/article/${article.id}`} className={`${mobileActionButtonClass} text-blue-600`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-7 w-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" /></svg>\n                        <span className=\"text-xs sr-only\">阅读</span>\n                    </Link>\n                    {isAdmin && (\n                        <>\n                            <button\n                                onClick={() => handleToggleState('star')}\n                                disabled={!!isLoading}\n                                className={`${mobileActionButtonClass} ${isStarred ? 'text-amber-500' : 'text-gray-600'} ${isLoading ? 'cursor-wait' : ''}`}\n                            >\n                                {isLoading === 'star' ? <SpinnerIcon /> : <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-7 w-7\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>}\n                                <span className=\"text-xs sr-only\">{isStarred ? '已收藏' : '收藏'}</span>\n                            </button>\n                            <button\n                                onClick={() => handleToggleState('read')}\n                                disabled={!!isLoading}\n                                className={`${mobileActionButtonClass} ${isRead ? 'text-emerald-600' : 'text-gray-600'} ${isLoading ? 'cursor-wait' : ''}`}\n                            >\n                                {isLoading === 'read' ? <SpinnerIcon /> : (isRead ? <IconCheckCircle /> : <IconCircle />)}\n                                <span className=\"text-xs sr-only\">{isRead ? '已读' : '标记已读'}</span>\n                            </button>\n                            <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                                <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className={`${mobileActionButtonClass} text-sky-600`}>\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-7 w-7\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                                    <span className=\"text-xs sr-only\">标签</span>\n                                </button>\n                                {isTagPopoverOpen && <TagPopover article={article} onClose={() => setIsTagPopoverOpen(false)} onStateChange={handleStateChange} />}\n                            </div>\n                        </>\n                    )}\n                    <a href={article.link} target=\"_blank\" rel=\"noopener noreferrer\" className={`${mobileActionButtonClass} text-gray-600`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-7 w-7\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" /><path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" /></svg>\n                        <span className=\"text-xs sr-only\">原文</span>\n                    </a>\n                </div>\n                {displayedUserTags.length > 0 && (\n                    <div className=\"flex flex-wrap gap-2 items-center justify-center mt-2 pt-2 border-t border-gray-200\">\n                        {displayedUserTags.map(tagLabel => (tagLabel && <span key={tagLabel} className={`text-xs font-semibold inline-block py-1 px-2.5 rounded-full ${getRandomColorClass(tagLabel)}`}>{tagLabel}</span>))}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n});\n\nexport default ArticleActions;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/ArticleDetailClient.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":14,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":14,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport ArticleDetail from '../../components/ArticleDetail';\nimport { Article, CleanArticleContent } from '../../types';\nimport { useArticleStore } from '../../store/articleStore';\n\ninterface ArticleDetailClientProps {\n    article: Article;\n    initialContent?: CleanArticleContent | null;\n}\n\nexport default function ArticleDetailClient({ article: initialArticle, initialContent }: ArticleDetailClientProps) {\n    const router = useRouter();\n    // Try to get the live article from the store to ensure we have the latest tags/state\n    const storedArticle = useArticleStore(state => state.articlesById[initialArticle.id]);\n    const article = storedArticle || initialArticle;\n\n    const handleClose = () => {\n        // Navigate back to home or previous page\n        router.push('/');\n    };\n\n    return (\n        <ArticleDetail\n            article={article}\n            onClose={handleClose}\n            initialContent={initialContent}\n        />\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/ArticleTitleStar.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":6,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useArticleMetadata } from '../../hooks/useArticleMetadata';\nimport { Article } from '../../types';\n\nexport default function ArticleTitleStar({ article, className = \"w-6 h-6 mr-2\" }: { article: Article; className?: string }) {\n    const { isStarred } = useArticleMetadata(article);\n\n    // Use a mounted check to avoid hydration mismatch if needed, \n    // but usually useArticleMetadata should be consistent if store is hydrated.\n    // For now, we assume it's fine or we accept a small flicker.\n\n    if (!isStarred) return null;\n    return (\n        <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 24 24\"\n            fill=\"currentColor\"\n            className={`text-amber-400 ${className}`}\n            style={{ shapeRendering: 'geometricPrecision' }}\n        >\n            <title>已收藏</title>\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z\" />\n        </svg>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/FloatingButtonsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useArticleStore' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":14,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":14,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSearchLoading' is assigned a value but never used.","line":35,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":62},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isBriefingLoading' is assigned a value but never used.","line":39,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isFilterLoading' is assigned a value but never used.","line":46,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":35}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useMemo } from 'react';\nimport { useRouter } from 'next/navigation';\nimport FloatingActionButtons from '../../components/FloatingActionButtons';\nimport { useUIStore } from '../../store/uiStore';\nimport { useArticleStore } from '../../store/articleStore';\nimport { useArticleActions } from '../../hooks/useArticleActions';\nimport { useBriefingArticles, useFilteredArticles, useSearchResults } from '../../hooks/useArticles';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { useFilters } from '../../hooks/useFilters';\nimport { getCurrentTimeSlotInShanghai } from '../../services/api';\n\nexport default function FloatingButtonsClient({ isAdmin }: { isAdmin: boolean }) {\n    const router = useRouter();\n    const queryClient = useQueryClient();\n\n    // Store State\n    const activeFilter = useUIStore(state => state.activeFilter);\n    const selectedArticleId = useUIStore(state => state.selectedArticleId);\n    const setSelectedArticleId = useUIStore(state => state.setSelectedArticleId);\n    const setTimeSlot = useUIStore(state => state.setTimeSlot);\n    const timeSlot = useUIStore(state => state.timeSlot);\n    const { handleResetFilter } = useFilters();\n\n    // Actions\n    const {\n        handleArticleStateChange,\n        handleMarkAllClick,\n        isUpdatingArticle,\n        isMarkingAsRead\n    } = useArticleActions();\n\n    // Data Fetching for articleIdsInView\n    const { data: searchResultIds, isLoading: isSearchLoading } = useSearchResults(\n        activeFilter?.type === 'search' ? activeFilter.value : null\n    );\n\n    const { data: briefingArticleIds, isLoading: isBriefingLoading, isFetching: isBriefingFetching } = useBriefingArticles(\n        activeFilter?.type === 'date' ? activeFilter.value : null,\n        timeSlot\n    );\n\n    const {\n        data: filteredArticlesData,\n        isLoading: isFilterLoading,\n    } = useFilteredArticles(\n        (activeFilter?.type === 'category' || activeFilter?.type === 'tag') ? activeFilter.value : null\n    );\n\n    const filteredArticleIds = useMemo(() => {\n        return filteredArticlesData?.pages.flatMap((page: { articles: (string | number)[] }) => page.articles) || [];\n    }, [filteredArticlesData]);\n\n    const articleIdsInView = useMemo(() => {\n        if (activeFilter?.type === 'date') {\n            return briefingArticleIds || [];\n        } else if (activeFilter?.type === 'category' || activeFilter?.type === 'tag') {\n            return filteredArticleIds || [];\n        } else if (activeFilter?.type === 'search') {\n            return searchResultIds || [];\n        }\n        return [];\n    }, [activeFilter, briefingArticleIds, filteredArticleIds, searchResultIds]);\n\n    const handleRefreshToHome = async () => {\n        setSelectedArticleId(null);\n        setTimeSlot(getCurrentTimeSlotInShanghai());\n        await queryClient.invalidateQueries({ queryKey: ['briefing'] });\n        handleResetFilter();\n        window.scrollTo({ top: 0, behavior: 'smooth' });\n        router.push('/');\n    };\n\n    // Wrapper for onArticleStateChange to match expected signature if needed, \n    // but useArticleActions.handleArticleStateChange already matches (id, add, remove)\n\n    return (\n        <FloatingActionButtons\n            selectedArticleId={selectedArticleId}\n            articleIdsInView={articleIdsInView}\n            isBriefingFetching={isBriefingFetching}\n            isUpdatingArticle={isUpdatingArticle}\n            isMarkingAsRead={isMarkingAsRead}\n            onArticleStateChange={handleArticleStateChange}\n            onMarkAllClick={() => handleMarkAllClick(articleIdsInView)}\n            onRefreshToHome={handleRefreshToHome}\n            isAdmin={isAdmin}\n        />\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/GlobalUI.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":11,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":11,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport Toast from './Toast';\nimport { useAppToast } from '../../hooks/useAppToast';\nimport { useArticleStore } from '../../store/articleStore';\nimport { useUIStore } from '../../store/uiStore';\nimport UnifiedArticleModal from '../../components/UnifiedArticleModal';\nimport { useUpdateArticleState } from '../../hooks/useArticles';\n\nexport default function GlobalUI() {\n    const { toast, hideToast } = useAppToast();\n    const modalArticleId = useUIStore(state => state.modalArticleId);\n    const modalInitialMode = useUIStore(state => state.modalInitialMode);\n    const closeModal = useUIStore(state => state.closeModal);\n    const articlesById = useArticleStore(state => state.articlesById);\n\n    // We need a way to handle state changes from the modal.\n    // Ideally this should come from a hook, but GlobalUI is just a shell.\n    // Let's import the hook here.\n    const { mutateAsync: updateArticleState } = useUpdateArticleState();\n\n    const handleStateChange = async (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => {\n        return updateArticleState({ articleId, tagsToAdd, tagsToRemove });\n    };\n\n    const selectedArticle = modalArticleId ? articlesById[modalArticleId] : null;\n\n    return (\n        <>\n            <Toast\n                message={toast.message}\n                isVisible={toast.isVisible}\n                onClose={hideToast}\n                type={toast.type}\n            />\n            {selectedArticle && (\n                <UnifiedArticleModal\n                    article={selectedArticle}\n                    onClose={closeModal}\n                    onStateChange={handleStateChange}\n                    initialMode={modalInitialMode}\n                />\n            )}\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/MainContentClient.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":25,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":25,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":53,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useEffect, useMemo } from 'react';\nimport { useUIStore } from '../../store/uiStore';\nimport { useArticleStore } from '../../store/articleStore';\nimport ArticleDetailClient from './ArticleDetailClient';\nimport Briefing from '../../components/Briefing';\nimport SearchList from '../../components/SearchList';\nimport StreamList from '../../components/StreamList';\nimport TrendsView from '../../components/TrendsView';\nimport LoadingSpinner from '../../components/LoadingSpinner';\nimport { useBriefingArticles, useFilteredArticles, useSearchResults, useUpdateArticleState } from '../../hooks/useArticles';\nimport { Filter, Article } from '../../types';\nimport { useRouter } from 'next/navigation';\nimport { useQueryClient } from '@tanstack/react-query';\n\ninterface MainContentClientProps {\n    initialDate?: string;\n    initialHeaderImageUrl?: string;\n    initialArticles?: Article[];\n    initialActiveFilter?: Filter | null;\n    initialContinuation?: string | null;\n}\n\nexport default function MainContentClient({\n    initialDate,\n    initialHeaderImageUrl,\n    initialArticles = [],\n    initialActiveFilter,\n    initialContinuation\n}: MainContentClientProps) {\n    const storeActiveFilter = useUIStore(state => state.activeFilter);\n    // Use initial props for SSR/Hydration if store is empty\n    const activeFilter = storeActiveFilter || initialActiveFilter;\n\n    // Sync prop to store after mount\n    useEffect(() => {\n        if (initialActiveFilter && !storeActiveFilter) {\n            useUIStore.getState().setActiveFilter(initialActiveFilter);\n        }\n    }, [initialActiveFilter, storeActiveFilter]);\n\n    const selectedArticleId = useUIStore(state => state.selectedArticleId);\n    const timeSlot = useUIStore(state => state.timeSlot);\n    const setTimeSlot = useUIStore(state => state.setTimeSlot);\n    const isSidebarCollapsed = useUIStore(state => state.isSidebarCollapsed);\n    const toggleSidebar = useUIStore(state => state.toggleSidebar);\n    const articlesById = useArticleStore(state => state.articlesById);\n    const addArticles = useArticleStore(state => state.addArticles);\n\n    const openModal = useUIStore(state => state.openModal);\n\n    const router = useRouter();\n    const queryClient = useQueryClient();\n    const { mutateAsync: updateArticleState } = useUpdateArticleState();\n\n    // Initialize timeSlot if not set (e.g. first load)\n    useEffect(() => {\n        if (!timeSlot && activeFilter?.type === 'date') {\n            const hour = new Date().getHours();\n            let currentSlot: 'morning' | 'afternoon' | 'evening' = 'morning';\n            if (hour >= 12 && hour < 19) currentSlot = 'afternoon';\n            if (hour >= 19) currentSlot = 'evening';\n            setTimeSlot(currentSlot);\n        }\n    }, [timeSlot, activeFilter, setTimeSlot]);\n\n    // Determine which date to use (active filter or initial default)\n    // Fallback to today if initialDate is missing (prevents missing header)\n    const today = new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Shanghai' });\n    const dateToUse = activeFilter?.type === 'date' ? activeFilter.value : (activeFilter ? null : (initialDate || today));\n\n    // Hydrate store with server-fetched articles (SSR -> Client Handover)\n    useEffect(() => {\n        if (initialArticles.length > 0) {\n            // 1. Update Zustand (Detailed objects)\n            addArticles(initialArticles);\n\n            // 2. Update React Query Cache (ID List)\n            if (activeFilter?.type === 'date' && dateToUse) {\n                queryClient.setQueryData(['briefing', dateToUse, 'all'], initialArticles.map(a => a.id));\n            } else if (activeFilter?.type === 'category' || activeFilter?.type === 'tag') {\n                // Pre-populate useFilteredArticles cache?\n                // React Query key needed.\n                // Key: ['filteredArticles', filterValue]\n                if (activeFilter.value) {\n                    // We need to match the structure expected by useFilteredArticles\n                    // It expects InfiniteData<{ articles: number[], continuation: string | null }>\n                    queryClient.setQueryData(['filteredArticles', activeFilter.value], {\n                        pages: [{\n                            articles: initialArticles.map(a => a.id),\n                            continuation: initialContinuation\n                        }],\n                        pageParams: [null]\n                    });\n                }\n            }\n        }\n    }, [initialArticles, addArticles, queryClient, dateToUse, activeFilter, initialContinuation]);\n\n    // Memoize initial IDs for hook\n    const initialArticleIds = useMemo(() => initialArticles.map(a => a.id), [initialArticles]);\n\n    // Hooks must be called unconditionally\n    const { data: briefingArticleIds, isLoading: isBriefingLoading } = useBriefingArticles(\n        dateToUse || null,\n        timeSlot,\n        // Pass initial data only if matching the SSR date\n        (dateToUse === initialDate) ? initialArticleIds : undefined\n    );\n\n    const {\n        data: filteredData,\n        isLoading: isFilteredLoading,\n        fetchNextPage,\n        hasNextPage,\n        isFetchingNextPage\n    } = useFilteredArticles(\n        (activeFilter?.type === 'category' || activeFilter?.type === 'tag') ? activeFilter.value : null\n    );\n\n    const { data: searchResultIds, isLoading: isSearchLoading } = useSearchResults(\n        activeFilter?.type === 'search' ? activeFilter.value : null\n    );\n\n    // Handlers\n    const handleOpenArticle = (article: Article) => {\n        openModal(article.id);\n    };\n\n    const handleReaderModeRequest = (article: Article) => {\n        openModal(article.id, 'reader');\n    };\n\n    // Render Logic\n    if (selectedArticleId) {\n        const article = articlesById[selectedArticleId] || initialArticles.find(a => a.id === selectedArticleId);\n        if (article) {\n            return <ArticleDetailClient article={article} />;\n        }\n    }\n\n    if (activeFilter?.type === 'trends') {\n        return <TrendsView />;\n    }\n\n    if (activeFilter?.type === 'category' || activeFilter?.type === 'tag') {\n        const ids = filteredData?.pages.flatMap(page => page.articles) || [];\n        return (\n            <StreamList\n                articleIds={ids}\n                isLoading={isFilteredLoading}\n                fetchNextPage={fetchNextPage}\n                hasNextPage={hasNextPage}\n                isFetchingNextPage={isFetchingNextPage}\n            />\n        );\n    }\n\n    if (activeFilter?.type === 'search') {\n        return (\n            <SearchList\n                articleIds={searchResultIds || []}\n                onOpenArticle={handleOpenArticle}\n                isLoading={isSearchLoading}\n            />\n        );\n    }\n\n    // Default to Briefing (Date View)\n    // This handles both explicit date filter AND default initial state\n    if (dateToUse) {\n        // Use effective IDs: from hook (client) or fallback to initial (SSR)\n        const effectiveArticleIds = briefingArticleIds || (dateToUse === initialDate ? initialArticleIds : []);\n\n        return (\n            <Briefing\n                articleIds={effectiveArticleIds}\n                date={dateToUse}\n                headerImageUrl={dateToUse === initialDate ? initialHeaderImageUrl : undefined}\n                timeSlot={timeSlot}\n                selectedReportId={1}\n                onReportSelect={() => { }}\n                onReaderModeRequest={handleReaderModeRequest}\n                onStateChange={async (id, add, remove) => { await updateArticleState({ articleId: id, tagsToAdd: add, tagsToRemove: remove }); }}\n                onTimeSlotChange={setTimeSlot}\n                isSidebarCollapsed={isSidebarCollapsed}\n                onToggleSidebar={toggleSidebar}\n                articleCount={effectiveArticleIds.length}\n                // Only show loading if we really have no content AND are fetching (and client is mounted)\n                // This prevents infinite spinner in No-JS if SSR failed\n                isLoading={effectiveArticleIds.length === 0 && isBriefingLoading && typeof window !== 'undefined'}\n                articles={initialArticles} // Pass initial objects for fallback lookup\n                isToday={dateToUse === today}\n            />\n        );\n    }\n\n    return <LoadingSpinner />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/MainLayoutClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AvailableFilters' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Article' is defined but never used.","line":8,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[461,464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[461,464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":18,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":18,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedArticleId' is assigned a value but never used.","line":29,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":28}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useUIStore } from '../../store/uiStore';\nimport SidebarClient from './SidebarClient';\nimport FloatingButtonsClient from './FloatingButtonsClient';\n\nimport { AvailableFilters, Article } from '../../types';\n\ninterface MainLayoutClientProps {\n    children: React.ReactNode;\n    isAdmin: boolean;\n    initialDates: string[];\n    initialAvailableFilters: { tags: any[]; categories: any[] };\n    initialStarredHeaders: { id: string | number; title: string; tags: string[] }[]; // Update type\n}\n\nexport default function MainLayoutClient({\n    children,\n    isAdmin,\n    initialDates,\n    initialAvailableFilters,\n    initialStarredHeaders\n}: MainLayoutClientProps) {\n    const isSidebarCollapsed = useUIStore(state => state.isSidebarCollapsed);\n    const toggleSidebar = useUIStore(state => state.toggleSidebar);\n    const setSidebarCollapsed = useUIStore(state => state.setSidebarCollapsed);\n    const setAdminStatus = useUIStore(state => state.setAdminStatus);\n    const selectedArticleId = useUIStore(state => state.selectedArticleId);\n    const modalArticleId = useUIStore(state => state.modalArticleId);\n\n    // Initialize admin status immediately\n    const initialized = useRef(false);\n    if (!initialized.current) {\n        useUIStore.setState({ isAdmin });\n        initialized.current = true;\n    }\n\n    useEffect(() => {\n        setAdminStatus(isAdmin);\n    }, [isAdmin, setAdminStatus]);\n\n    const [isMdUp, setIsMdUp] = useState<boolean>(false);\n    const mainContentRef = useRef<HTMLDivElement | null>(null);\n\n    // Handle viewport resize\n    useEffect(() => {\n        const updateViewport = () => {\n            const mdUp = window.innerWidth >= 768;\n            setIsMdUp(mdUp);\n            // Auto-collapse on mobile, expand on desktop if needed\n            // But let's respect user state if possible, or just default logic:\n            if (!mdUp) {\n                setSidebarCollapsed(true);\n            } else {\n                setSidebarCollapsed(false);\n            }\n        };\n        updateViewport();\n        window.addEventListener('resize', updateViewport);\n        return () => window.removeEventListener('resize', updateViewport);\n    }, [setSidebarCollapsed]);\n\n    // Handle body overflow for mobile sidebar\n    useEffect(() => {\n        if (!isSidebarCollapsed && !isMdUp) {\n            document.body.style.overflow = 'hidden';\n        } else {\n            document.body.style.overflow = '';\n        }\n        return () => { document.body.style.overflow = ''; };\n    }, [isSidebarCollapsed, isMdUp]);\n\n    const [transitionsEnabled, setTransitionsEnabled] = useState(false);\n\n    const handleToggle = () => {\n        setTransitionsEnabled(true);\n        toggleSidebar();\n    };\n\n    const transitionClass = transitionsEnabled ? 'transition-all duration-300 ease-in-out' : '';\n\n    return (\n        <div className=\"flex flex-col md:flex-row min-h-screen font-sans bg-gray-50 dark:bg-midnight-bg\">\n            {/* Mobile Overlay */}\n            {!isSidebarCollapsed && !isMdUp && (\n                <div\n                    className=\"fixed inset-0 bg-black/50 z-40\"\n                    onClick={() => setSidebarCollapsed(true)}\n                    aria-hidden=\"true\"\n                />\n            )}\n\n            {/* Sidebar Container */}\n            <div className={`h-full bg-gray-50 dark:bg-midnight-sidebar border-r border-transparent dark:border-midnight-sidebar z-50 ${transitionClass} ${!isMdUp\n                ? `fixed top-0 left-0 w-64 ${isSidebarCollapsed ? '-translate-x-full' : 'translate-x-0'}`\n                : `md:fixed md:top-0 md:bottom-0 md:left-0 md:overflow-y-auto ${isSidebarCollapsed ? 'md:w-0 md:opacity-0 md:pointer-events-none' : 'md:w-80 md:opacity-100'}`\n                }`}>\n                <SidebarClient\n                    initialDates={initialDates}\n                    initialAvailableFilters={initialAvailableFilters}\n                    initialStarredHeaders={initialStarredHeaders}\n                />\n            </div>\n\n            {/* Desktop Toggle Button */}\n            <button\n                onClick={handleToggle}\n                className={`fixed top-5 p-2 bg-white dark:bg-midnight-card rounded-full shadow-lg hover:shadow-xl ${transitionClass} border border-gray-200 dark:border-midnight-border z-50\n                    hidden md:block\n                    md:left-5 ${transitionsEnabled ? 'md:transition-all md:duration-300' : ''} ${isSidebarCollapsed ? 'md:left-5' : 'md:left-[304px]'}\n                    right-5 md:right-auto cursor-pointer\n                `}\n                aria-label=\"Toggle Sidebar\"\n            >\n                {isSidebarCollapsed ? (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-800 dark:text-gray-200\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" /></svg>\n                ) : (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-800 dark:text-gray-200\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" strokeWidth=\"2\" /><path d=\"M9 4v16\" strokeWidth=\"2\" /></svg>\n                )}\n            </button>\n\n            {/* Mobile Toggle Button */}\n            {/* Mobile Toggle Button - HIDE when modal is open */}\n            {!modalArticleId && (\n                <button\n                    onClick={handleToggle}\n                    className={`md:hidden fixed top-4 right-6 z-50 p-2 rounded-full ${transitionClass}\n                    ${isSidebarCollapsed ? 'bg-gray-800 text-white' : 'bg-white/20 text-white'} cursor-pointer\n                `}\n                    aria-label=\"Toggle Sidebar\"\n                >\n                    {isSidebarCollapsed ? (\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" /></svg>\n                    ) : (\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" strokeWidth=\"2\" /><path d=\"M9 4v16\" strokeWidth=\"2\" /></svg>\n                    )}\n                </button>\n            )}\n\n            {/* Main Content Area */}\n            <div ref={mainContentRef} className={`flex-1 flex flex-col min-w-0 bg-neutral-50 dark:bg-midnight-bg bg-paper-texture dark:bg-none ${transitionClass} ${!isSidebarCollapsed ? 'md:ml-80' : ''}`}>\n                <div className=\"w-full max-w-3xl mx-auto px-2 md:px-8 pt-2 md:pt-4\">\n                    {children}\n                </div>\n                <FloatingButtonsClient isAdmin={isAdmin} />\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/SidebarClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AvailableFilters' is defined but never used.","line":9,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[533,536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[533,536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[552,555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[552,555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":18,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":18,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pathname' is assigned a value but never used.","line":24,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setActiveFilter' is assigned a value but never used.","line":25,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":26},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":60,"column":17,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":60,"endColumn":30,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2144,2157],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useCallback } from 'react';\nimport { useRouter, usePathname } from 'next/navigation';\nimport Sidebar from '../../components/Sidebar';\nimport { useFilters } from '../../hooks/useFilters';\nimport { useUIStore } from '../../store/uiStore';\nimport { useArticleStore } from '../../store/articleStore';\nimport { Article, AvailableFilters } from '../../types';\nimport { toShortId } from '../../utils/idHelpers';\n\ninterface SidebarClientProps {\n    initialDates: string[];\n    initialAvailableFilters: { tags: any[]; categories: any[] };\n    initialStarredHeaders: { id: string | number; title: string; tags: string[] }[]; // Update type\n}\n\nexport default function SidebarClient({\n    initialDates,\n    initialAvailableFilters,\n    initialStarredHeaders\n}: SidebarClientProps) {\n    const router = useRouter();\n    const pathname = usePathname();\n    const setActiveFilter = useUIStore(state => state.setActiveFilter);\n    const setSelectedArticleId = useUIStore(state => state.setSelectedArticleId);\n    const addArticles = useArticleStore(state => state.addArticles);\n\n    const {\n        isInitialLoad,\n        isRefreshing: isRefreshingFilters,\n        datesForMonth,\n        availableMonths,\n        selectedMonth,\n        setSelectedMonth,\n        refreshFilters,\n        dailyStatuses,\n        handleToggleDailyStatus,\n        availableFilters,\n    } = useFilters({ initialDates, initialAvailableFilters });\n\n    const onMonthChange = useCallback((month: string) => {\n        setSelectedMonth(month);\n    }, [setSelectedMonth]);\n\n    const handleSidebarArticleClick = useCallback((article: Article) => {\n        setSelectedArticleId(article.id);\n        addArticles([article]);\n        router.push(`/article/${toShortId(String(article.id))}?view=page`);\n    }, [setSelectedArticleId, addArticles, router]);\n\n    // Mock toggle for now or implement real logic if needed\n    const handleToggleDailyStatusWrapper = (date: string, currentStatus: boolean) => {\n        handleToggleDailyStatus(date, currentStatus);\n    };\n\n    return (\n        <div className=\"h-full sticky top-0\">\n            <Sidebar\n                // @ts-ignore\n                isInitialLoading={isInitialLoad}\n                isRefreshingFilters={isRefreshingFilters}\n                availableMonths={availableMonths}\n                selectedMonth={selectedMonth}\n                onMonthChange={onMonthChange}\n                onOpenArticle={handleSidebarArticleClick}\n                onRefresh={refreshFilters}\n                datesForMonth={datesForMonth}\n                dailyStatuses={dailyStatuses}\n                onToggleDailyStatus={handleToggleDailyStatusWrapper}\n                initialStarredHeaders={initialStarredHeaders}\n                availableFilters={availableFilters}\n            />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/StreamList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMemo' is defined but never used.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":35},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":15,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":15,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'status' is assigned a value but never used.","line":38,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useEffect, useMemo } from 'react';\nimport { useFilteredArticles } from '../../hooks/useArticles';\nimport StreamArticleListItem from '../../components/StreamArticleListItem';\nimport { useArticleStore } from '../../store/articleStore';\nimport { Article } from '../../types';\n\ninterface StreamListProps {\n    filterValue: string;\n    initialArticles: Article[];\n    initialContinuation?: string;\n}\n\nexport default function StreamList({ filterValue, initialArticles, initialContinuation }: StreamListProps) {\n    // Construct initialData for useInfiniteQuery\n    const initialData = {\n        pages: [{\n            articles: initialArticles.map(a => a.id),\n            continuation: initialContinuation\n        }],\n        pageParams: [undefined]\n    };\n\n    // Pre-populate store with initial articles\n    // We need to do this because useFilteredArticles only adds to store in queryFn, \n    // but initialData skips the first queryFn call.\n    const addArticles = useArticleStore(state => state.addArticles);\n    useEffect(() => {\n        addArticles(initialArticles);\n    }, [initialArticles, addArticles]);\n\n    const {\n        data,\n        fetchNextPage,\n        hasNextPage,\n        isFetchingNextPage,\n        status\n    } = useFilteredArticles(filterValue, initialData);\n\n    const articlesById = useArticleStore(state => state.articlesById);\n\n    // Memoize initial articles map for SSR fallback\n    const initialArticlesMap = React.useMemo(() => {\n        return initialArticles.reduce((acc, article) => {\n            acc[article.id] = article;\n            return acc;\n        }, {} as Record<string, Article>);\n    }, [initialArticles]);\n\n    // Flatten all pages of article IDs\n    const allArticleIds = data?.pages.flatMap(page => page.articles) || [];\n\n    return (\n        <div className=\"space-y-4\">\n            {allArticleIds.map(id => {\n                const article = articlesById[id] || initialArticlesMap[id];\n                if (!article) return null;\n                return <StreamArticleListItem key={id} articleId={id} initialArticle={article} />;\n            })}\n\n            {hasNextPage && (\n                <div className=\"flex justify-center pt-8\">\n                    <button\n                        onClick={() => fetchNextPage()}\n                        disabled={isFetchingNextPage}\n                        className=\"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 transition-colors cursor-pointer\"\n                    >\n                        <span className=\"cursor-pointer\">{isFetchingNextPage ? '加载中...' : '加载更多'}</span>\n                    </button>\n                </div>\n            )}\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/components/Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/date/[date]/BriefingClient.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":21,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":21,"endColumn":39},{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":63,"column":9,"endLine":63,"endColumn":64,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useQueryClient } from '@tanstack/react-query';\nimport Briefing from '../../../components/Briefing';\nimport { Article, TimeSlot } from '../../../types';\nimport { useArticleStore } from '../../../store/articleStore';\nimport { useUIStore } from '../../../store/uiStore';\nimport { useUpdateArticleState, useBriefingArticles } from '../../../hooks/useArticles';\nimport { getArticleTimeSlot } from '../../../utils/dateUtils';\n\ninterface BriefingClientProps {\n    articles: Article[];\n    date: string;\n    headerImageUrl?: string;\n    isToday: boolean;\n    prevDate?: string | null;\n    nextDate?: string | null;\n}\n\nexport default function BriefingClient({ articles, date, headerImageUrl, isToday, prevDate, nextDate }: BriefingClientProps) {\n    const addArticles = useArticleStore(state => state.addArticles);\n    const setActiveFilter = useUIStore(state => state.setActiveFilter);\n    const activeFilter = useUIStore(state => state.activeFilter);\n\n    // Decoupled Local State: Archives always start as \"Show All\" (null)\n    const [timeSlot, setTimeSlot] = useState<TimeSlot | null>(null);\n\n    // Reset local state when date changes (handles client-side soft nav)\n    useEffect(() => {\n        setTimeSlot(null);\n    }, [date]);\n\n    const openModal = useUIStore(state => state.openModal);\n    const isSidebarCollapsed = false; // Default or from store if needed\n    // const toggleSidebar = ... // If we want to control sidebar from here\n\n    const { mutateAsync: updateArticleState } = useUpdateArticleState();\n\n    const handleStateChange = async (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => {\n        await updateArticleState({ articleId, tagsToAdd, tagsToRemove });\n    };\n\n    // Hydrate store with server-fetched articles\n    // AND sync React Query cache with server-fetched IDs.\n    const queryClient = useQueryClient();\n    useEffect(() => {\n        if (articles.length > 0) {\n            // 1. Update Zustand (Detailed objects)\n            addArticles(articles);\n\n            // 2. Update React Query Cache (ID List)\n            queryClient.setQueryData(['briefing', date, 'all'], articles.map(a => a.id));\n        }\n    }, [articles, addArticles, queryClient, date]);\n\n    // Set active filter to date\n    useEffect(() => {\n        // Only set if not already set to avoid loops or overrides\n        if (activeFilter?.type !== 'date' || activeFilter.value !== date) {\n            setActiveFilter({ type: 'date', value: date });\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [date, setActiveFilter]);\n\n    // Use hook to get filtered articles based on timeSlot\n    const initialArticleIds = useMemo(() => articles.map(a => a.id), [articles]);\n\n    // 1. Always get the \"All Day\" dataset\n    const { data: allDayArticleIds, isLoading } = useBriefingArticles(date, 'all', initialArticleIds);\n\n    // 2. Client-Side Filtering\n    const articlesById = useArticleStore(state => state.articlesById);\n\n    const displayedArticleIds = useMemo(() => {\n        // Safe fallback\n        const masterIds = allDayArticleIds || initialArticleIds;\n\n        if (!timeSlot) {\n            return masterIds;\n        }\n\n        // Filter based on the article's n8n_processing_date or published date\n        return masterIds.filter((id: string | number) => {\n            const article = articles.find(a => a.id === id) || articlesById[id];\n            if (!article) return false;\n            // Use processing date for alignment with server logic, fallback to published\n            const dateStr = article.n8n_processing_date || article.published;\n            return getArticleTimeSlot(dateStr) === timeSlot;\n        });\n    }, [timeSlot, allDayArticleIds, initialArticleIds, articles, articlesById]);\n\n    const articleIds = displayedArticleIds;\n\n    return (\n        <Briefing\n            articleIds={articleIds}\n            date={date}\n            headerImageUrl={headerImageUrl}\n            timeSlot={timeSlot}\n            selectedReportId={1} // Default to 1 as Briefing.tsx hardcodes a single report with ID 1\n            onReportSelect={() => { }} // No-op for now\n            onReaderModeRequest={(article) => openModal(article.id, 'reader')}\n            onStateChange={handleStateChange}\n            onTimeSlotChange={setTimeSlot}\n            isSidebarCollapsed={isSidebarCollapsed}\n            onToggleSidebar={() => { }} // No-op or implement if needed\n            articleCount={articleIds.length}\n            // Only show loading if we are fetching AND we have no articles to show.\n            isLoading={isLoading}\n            articles={articles}\n            isToday={isToday}\n            prevDate={prevDate}\n            nextDate={nextDate}\n            disableAutoTimeSlot={true} // Force \"Show All\" visual state for Archive Pages\n        />\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/date/[date]/error.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":5,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":5,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect } from 'react';\n\nexport default function Error({\n    error,\n    reset,\n}: {\n    error: Error & { digest?: string };\n    reset: () => void;\n}) {\n    useEffect(() => {\n        // Log the error to an error reporting service\n        console.error('Briefing Page Error:', error);\n    }, [error]);\n\n    return (\n        <div className=\"flex flex-col items-center justify-center min-h-[50vh] p-4 text-center\">\n            <h2 className=\"text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4\">\n                Something went wrong loading the briefing.\n            </h2>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6 max-w-md\">\n                {error.message || 'An unexpected error occurred.'}\n            </p>\n            <button\n                onClick={\n                    // Attempt to recover by trying to re-render the segment\n                    () => reset()\n                }\n                className=\"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors shadow-md\"\n            >\n                Try again\n            </button>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/date/[date]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'notFound' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":14,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":14,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1020,1023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1020,1023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":134,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":134,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hasArticles' is assigned a value but never used.","line":149,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":22}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Metadata } from 'next';\nimport { notFound } from 'next/navigation';\nimport { fetchBriefingData, fetchAvailableDates, getTodayInShanghai } from '../../lib/data';\n\nimport BriefingClient from './BriefingClient';\nimport { unstable_noStore as noStore } from 'next/cache';\nimport { resolveBriefingImage } from '../../../services/articleLoader';\n\n// Revalidate every hour for past dates (ISR).\n// For \"Today\", we will use noStore() to opt out of caching.\nexport const revalidate = 604800;\n\nexport async function generateStaticParams() {\n    const dates = await fetchAvailableDates();\n    const today = getTodayInShanghai();\n\n    // Exclude today from static generation to ensure it's always treated as dynamic (SSR) initially\n    // and to avoid building a stale version at build time.\n    return dates\n        .filter(date => date !== today)\n        .map((date) => ({\n            date: date,\n        }));\n}\n\n// Helper to extract top keywords from articles\nfunction getTopKeywords(articles: any[], limit = 10): string[] {\n    const frequency: Record<string, number> = {};\n    articles.forEach(article => {\n        if (Array.isArray(article.keywords)) {\n            article.keywords.forEach((k: string) => {\n                const cleanKey = k.trim();\n                if (cleanKey) {\n                    frequency[cleanKey] = (frequency[cleanKey] || 0) + 1;\n                }\n            });\n        }\n    });\n    return Object.entries(frequency)\n        .sort(([, a], [, b]) => b - a)\n        .slice(0, limit)\n        .map(([key]) => key);\n}\n\nexport async function generateMetadata({ params }: { params: Promise<{ date: string }> }): Promise<Metadata> {\n    const { date } = await params;\n\n    // Fetch data for dynamic description\n    const groupedArticles = await fetchBriefingData(date);\n    const allArticles = Object.values(groupedArticles).flat();\n\n    // Auto-SEO: Extract keywords\n    const topKeywords = getTopKeywords(allArticles, 10);\n\n    // Fetch header image for metadata\n    const headerImageUrl = await resolveBriefingImage(date);\n\n    // Construct description from Article TLDRs (User Preference: Numbered list of TLDRs)\n    // Example: 1. AI辅助... 2. Memori...\n    const tldrList = allArticles\n        .slice(0, 10) // Limit to top 10 to avoid excessive length\n        .map((a, i) => `${i + 1}. ${a.tldr || a.title}`)\n        .join(' ');\n\n    const description = tldrList\n        ? `${date} 每日简报。本期要点：${tldrList}`\n        : `${date} 每日精选简报。汇聚科技新闻与 RSS 订阅精华。`;\n\n    // Dynamic Title Generation: \"Title Party\" Mode\n    const PRIORITY_MAP: Record<string, number> = {\n        '重要新闻': 3,\n        '必知要闻': 2,\n        '常规更新': 1,\n    };\n\n    // Sort ALL articles by Priority descending, then by specific Score descending\n    const sortedForTitle = [...allArticles].sort((a, b) => {\n        const sectionA = a.briefingSection || a.verdict?.importance || '常规更新';\n        const sectionB = b.briefingSection || b.verdict?.importance || '常规更新';\n\n        const pA = PRIORITY_MAP[sectionA] || 0;\n        const pB = PRIORITY_MAP[sectionB] || 0;\n\n        if (pA !== pB) return pB - pA; // Higher priority first\n        return (b.verdict?.score || 0) - (a.verdict?.score || 0); // Higher score first within priority\n    });\n\n    const topArticles = sortedForTitle.slice(0, 2); // Get top 2\n    let dynamicTitle = `${date} `;\n\n    if (topArticles.length > 0) {\n        // Simple cleanup: remove special chars if needed\n        const t1 = topArticles[0].title.replace(/\\|/g, '-');\n        dynamicTitle += `${t1}`;\n\n        if (topArticles.length > 1) {\n            const t2 = topArticles[1].title.replace(/\\|/g, '-');\n            // Check approximate length (Social/Search limit ~60 chars)\n            // Relaxed limit to 100 to ensure 2nd title shows (User Preference > Strict SEO No-Truncation)\n            if ((dynamicTitle.length + t2.length) < 100) {\n                dynamicTitle += `、${t2}`;\n            }\n        }\n        // dynamicTitle += ` | RSS Briefing Hub`; // Removed to avoid duplication with layout template\n    } else {\n        dynamicTitle += `Briefing`;\n    }\n\n    return {\n        title: dynamicTitle,\n        description: description,\n        keywords: topKeywords, // Inject explicit keywords tag\n        alternates: {\n            canonical: `/date/${date}`,\n        },\n        openGraph: {\n            title: dynamicTitle,\n            description: description,\n            type: 'article',\n            publishedTime: date,\n            images: [\n                {\n                    url: headerImageUrl || 'https://www.alok-rss.top/computer_cat_180.jpeg',\n                    width: 1600,\n                    height: 1200,\n                    alt: `${date} Briefing Cover`,\n                }\n            ],\n        },\n    };\n}\n\nexport default async function BriefingPage({ params }: { params: Promise<{ date: string }> }) {\n    const { date } = await params;\n    const today = getTodayInShanghai();\n\n    // If it's today, opt out of caching to ensure real-time updates (SSR)\n    if (date === today) {\n        noStore();\n    }\n\n    const groupedArticles = await fetchBriefingData(date);\n\n    // Flatten articles for BriefingClient\n    const allArticles = Object.values(groupedArticles).flat();\n\n    // Check if empty\n    const hasArticles = allArticles.length > 0;\n\n    // Prefetch header image\n    const headerImageUrl = await resolveBriefingImage(date);\n\n    // Construct consistent description for JSON-LD (Same as Metadata)\n    const tldrList = allArticles\n        .slice(0, 10)\n        .map((a, i) => `${i + 1}. ${a.tldr || a.title}`)\n        .join(' ');\n\n    const description = tldrList\n        ? `${date} 每日简报。本期要点：${tldrList}`\n        : `${date} 每日精选简报。汇聚科技新闻与 RSS 订阅精华。`;\n\n    const jsonLd = {\n        '@context': 'https://schema.org',\n        '@type': 'NewsArticle',\n        headline: `${date} Briefing | 每日简报`,\n        image: {\n            '@type': 'ImageObject',\n            'url': headerImageUrl || 'https://www.alok-rss.top/computer_cat_180.jpeg' // Fallback image\n        },\n        description: description,\n        datePublished: `${date}T08:00:00+08:00`, // ISO 8601 with +08:00 timezone (assuming 8 AM Shanghai)\n        author: [{\n            '@type': 'Organization',\n            name: 'Briefing Hub',\n            url: 'https://www.alok-rss.top'\n        }],\n        mainEntity: {\n            '@type': 'ItemList',\n            itemListElement: allArticles.map((article, index) => ({\n                '@type': 'ListItem',\n                position: index + 1,\n                url: `https://www.alok-rss.top/article/${article.id}`,\n                name: article.title,\n                // Enhanced Rich Snippet: Use the full AI summary for deep content understanding\n                description: article.summary || article.tldr || ''\n            }))\n        }\n    };\n\n    // Calculate Previous and Next dates for Internal Linking (SEO)\n    const dates = await fetchAvailableDates();\n    const currentIndex = dates.indexOf(date);\n    // dates are sorted desc (newest first). \n    // Next date (chronologically tomorrow) is at index - 1. \n    // Prev date (chronologically yesterday) is at index + 1.\n    const nextDate = currentIndex > 0 ? dates[currentIndex - 1] : null;\n    const prevDate = currentIndex < dates.length - 1 ? dates[currentIndex + 1] : null;\n\n    return (\n        <>\n            <script\n                type=\"application/ld+json\"\n                dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n            />\n            <BriefingClient\n                key={date} // Force remount on date change to ensure clean state (no timeSlot leakage)\n                articles={allArticles}\n                date={date}\n                headerImageUrl={headerImageUrl}\n                isToday={date === today}\n                prevDate={prevDate}\n                nextDate={nextDate}\n            />\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/feed.xml/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Article' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":8,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":8,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { getAvailableDates } from '@/services/api';\nimport { fetchBriefingArticles } from '@/services/articleLoader';\nimport { Article } from '@/types';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function GET() {\n    try {\n        // 1. 获取最新的简报日期\n        const dates = await getAvailableDates();\n        const latestDate = dates[0];\n\n        if (!latestDate) {\n            return new NextResponse('No content available', { status: 404 });\n        }\n\n        // 2. 获取该日期的所有文章（包含 AI 分析数据）\n        const articles = await fetchBriefingArticles(latestDate, null);\n\n        // 3. 生成 RSS XML\n        const feedParams = {\n            title: \"RSS Briefing Hub | Daily AI Insights\",\n            description: \"Your personal daily briefing with AI-curated summaries, critiques, and market takes.\",\n            link: \"https://www.alok-rss.top\",\n            lastBuildDate: new Date().toUTCString(),\n        };\n\n        const itemXmls = articles.map(article => {\n            // 构建 item 内容：只包含 AI 生成的部分，不包含原文\n            const description = `\n                <p><strong>Verdict:</strong> ${article.verdict?.type} (Score: ${article.verdict?.score})</p>\n                <p><strong>One-Liner:</strong> ${article.summary}</p>\n                <p><strong>Market Take:</strong> ${article.marketTake || 'N/A'}</p>\n                <p><strong>Critique:</strong> ${article.critiques || 'N/A'}</p>\n                <hr/>\n                <p><a href=\"https://www.alok-rss.top/date/${latestDate}\">Read full briefing on the Hub</a></p>\n            `.trim();\n\n            return `\n            <item>\n                <title><![CDATA[${article.title}]]></title>\n                <link>https://www.alok-rss.top/date/${latestDate}#article-${article.id}</link>\n                <guid isPermaLink=\"false\">${article.id}</guid>\n                <pubDate>${new Date(article.published).toUTCString()}</pubDate>\n                <description><![CDATA[${description}]]></description>\n                <category>${article.briefingSection}</category>\n            </item>\n            `;\n        }).join('\\n');\n\n        const rssXml = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<rss version=\"2.0\" xmlns:atom=\"http://www.w3.org/2005/Atom\">\n    <channel>\n        <title>${feedParams.title}</title>\n        <link>${feedParams.link}</link>\n        <description>${feedParams.description}</description>\n        <language>zh-cn</language>\n        <lastBuildDate>${feedParams.lastBuildDate}</lastBuildDate>\n        <atom:link href=\"https://www.alok-rss.top/feed.xml\" rel=\"self\" type=\"application/rss+xml\" />\n        ${itemXmls}\n    </channel>\n</rss>`;\n\n        return new NextResponse(rssXml, {\n            headers: {\n                'Content-Type': 'application/xml; charset=utf-8',\n                'Cache-Control': 's-maxage=3600, stale-while-revalidate',\n            },\n        });\n\n    } catch (error) {\n        console.error('Error generating feed:', error);\n        return new NextResponse('Internal Server Error', { status: 500 });\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/global-error.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":7,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as Sentry from \"@sentry/nextjs\";\nimport NextError from \"next/error\";\nimport { useEffect } from \"react\";\n\nexport default function GlobalError({ error }: { error: Error & { digest?: string } }) {\n  useEffect(() => {\n    Sentry.captureException(error);\n  }, [error]);\n\n  return (\n    <html>\n      <body>\n        {/* `NextError` is the default Next.js error page component. Its type\n        definition requires a `statusCode` prop. However, since the App Router\n        does not expose status codes for errors, we simply pass 0 to render a\n        generic error message. */}\n        <NextError statusCode={0} />\n      </body>\n    </html>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/layout.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":69,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":69,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './globals.css';\nimport { cookies } from 'next/headers';\nimport Providers from './providers';\nimport { Metadata } from 'next';\nimport { SpeedInsights } from \"@vercel/speed-insights/next\";\nimport { Analytics } from \"@vercel/analytics/react\";\nimport GlobalUI from './components/GlobalUI';\nimport MainLayoutClient from './components/MainLayoutClient';\nimport { Inter, Playfair_Display } from 'next/font/google';\n// import Script from 'next/script';\n\nconst inter = Inter({\n    subsets: ['latin'],\n    variable: '--font-inter',\n    display: 'swap',\n});\n\nconst playfair = Playfair_Display({\n    subsets: ['latin'],\n    variable: '--font-playfair',\n    display: 'swap',\n});\n\nexport const metadata: Metadata = {\n    metadataBase: new URL('https://www.alok-rss.top'),\n    title: {\n        default: 'RSS Briefing Hub - 全栈技术资讯雷达 | 聚焦架构设计、AI趋势与云原生',\n        template: '%s | RSS简报',\n    },\n    description: '一站式全栈技术资讯雷达。深度聚合 Martin Fowler、ACM Queue、Netflix Tech Blog 及 CNCF 等权威信源。内容覆盖大规模分布式系统设计、Kubernetes 云原生实践、高并发后端工程及前沿 AI技术落地。为架构师与开发者提供去噪后的核心技术洞察。',\n    keywords: [\n        \"RSS\", \"技术简报\", \"软件架构\", \"AI趋势\", \"云原生\",\n        \"前端开发\", \"后端工程\", \"分布式系统\", \"Martin Fowler\"\n    ],\n    manifest: '/manifest.json',\n    icons: {\n        icon: '/favicon.ico',\n        apple: '/computer_cat_180.jpeg',\n    },\n    appleWebApp: {\n        capable: true,\n        statusBarStyle: 'default',\n        title: 'Briefing',\n    },\n    openGraph: {\n        type: 'website',\n        locale: 'zh_CN',\n        url: 'https://www.alok-rss.top',\n        siteName: 'RSS Briefing Hub',\n        title: 'RSS Briefing Hub - 全栈技术资讯雷达',\n        description: '一站式全栈技术资讯雷达。深度聚合全球权威技术博客与架构实践，为开发者提供高价值的技术简报。',\n    },\n    verification: {\n        other: {\n            'baidu-site-verification': 'codeva-GgB4Vw1uYR',\n            'msvalidate.01': 'F748D268BBC7001EA01E6B1ECF6BD15B',\n        },\n    },\n};\n\nexport const viewport = {\n    themeColor: '#ffffff',\n};\n\n\n\nimport { fetchAvailableDates, getAvailableFilters, fetchStarredArticleHeaders } from './lib/data';\n\nexport default async function RootLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('site_token');\n    const isAdmin = token?.value === process.env.ACCESS_TOKEN;\n\n    // Parallel Data Fetching for Sidebar SSR\n    const [dates, availableFilters, starredHeaders] = await Promise.all([\n        fetchAvailableDates().catch(() => []),\n        getAvailableFilters().catch(() => ({ tags: [], categories: [] })),\n        fetchStarredArticleHeaders().catch(() => [])\n    ]);\n\n    return (\n        <html lang=\"zh-CN\" className={`${inter.variable} ${playfair.variable}`}>\n            <body className=\"font-sans antialiased\">\n                <Providers>\n                    <MainLayoutClient\n                        isAdmin={isAdmin}\n                        initialDates={dates}\n                        initialAvailableFilters={availableFilters}\n                        initialStarredHeaders={starredHeaders}\n                    >\n                        {children}\n                    </MainLayoutClient>\n                    <GlobalUI />\n                </Providers>\n\n                {!isAdmin && (\n                    <>\n                        <SpeedInsights />\n                        <Analytics />\n                        {/* Microsoft Clarity */}\n                        <script\n                            dangerouslySetInnerHTML={{\n                                __html: `\n                                (function(c,l,a,r,i,t,y){\n                                    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};\n                                    t=l.createElement(r);t.async=1;t.src=\"https://www.clarity.ms/tag/\"+i;\n                                    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);\n                                })(window, document, \"clarity\", \"script\", \"ugwlylpe1l\");\n                                `\n                            }}\n                        />\n                        {/* Cloudflare Web Analytics */}\n                        <script\n                            defer\n                            src='https://static.cloudflareinsights.com/beacon.min.js'\n                            data-cf-beacon='{\"token\": \"134bcf9865674fdd9600e9ce14992b59\"}'\n                        />\n                    </>\n                )}\n            </body>\n        </html>\n    );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/api-utils.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":50,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":50,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2116,2129],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient, SupabaseClient } from '@supabase/supabase-js';\nimport { cookies } from 'next/headers';\n\n// --- Supabase Client (Server-Side Only) ---\nlet supabase: SupabaseClient;\nexport function getSupabaseClient(): SupabaseClient {\n    if (!supabase) {\n        const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\n        const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n        if (!supabaseUrl || !supabaseServiceRoleKey) {\n            throw new Error(\"Supabase environment variables are not configured.\");\n        }\n        supabase = createClient(supabaseUrl, supabaseServiceRoleKey);\n    }\n    return supabase;\n}\n\n// --- FreshRSS Client ---\ninterface FreshRssClient {\n    get: <T>(path: string, params?: Record<string, string>) => Promise<T>;\n    post: <T>(path: string, body: URLSearchParams) => Promise<T>;\n    getActionToken: () => Promise<string>;\n}\n\nlet freshRssClient: FreshRssClient;\nexport function getFreshRssClient(): FreshRssClient {\n    if (!freshRssClient) {\n        const apiUrl = process.env.FRESHRSS_API_URL;\n        const authToken = process.env.FRESHRSS_AUTH_TOKEN;\n        if (!apiUrl || !authToken) {\n            throw new Error(\"FreshRSS environment variables are not configured.\");\n        }\n\n        const headers = {\n            'Authorization': `GoogleLogin auth=${authToken}`,\n        };\n\n        const request = async <T>(path: string, options: RequestInit = {}, params: Record<string, string> = {}): Promise<T> => {\n            const url = new URL(`${apiUrl}/greader.php/reader/api/0${path}`);\n            Object.entries(params).forEach(([key, value]) => url.searchParams.append(key, value));\n\n            const response = await fetch(url.toString(), { ...options, headers });\n            if (!response.ok) {\n                const errorText = await response.text();\n                throw new Error(`FreshRSS API Error: ${response.status} ${errorText}`);\n            }\n            if (response.headers.get('Content-Type')?.includes('application/json')) {\n                return response.json();\n            }\n            // @ts-ignore\n            return response.text();\n        };\n\n        freshRssClient = {\n            get: <T>(path: string, params: Record<string, string> = {}): Promise<T> => {\n                return request<T>(path, {}, params);\n            },\n            post: <T>(path: string, body: URLSearchParams): Promise<T> => {\n                return request<T>(path, {\n                    method: 'POST',\n                    headers: { ...headers, 'Content-Type': 'application/x-www-form-urlencoded' },\n                    body,\n                });\n            },\n            getActionToken: async (): Promise<string> => {\n                const token = await request<string>('/token');\n                return token.trim();\n            }\n        };\n    }\n    return freshRssClient;\n}\n\n// --- Admin Verification Helper ---\nexport function verifyAdmin(cookieStore: Awaited<ReturnType<typeof cookies>>): boolean {\n    const accessToken = process.env.ACCESS_TOKEN;\n    if (!accessToken) return false;\n\n    const siteToken = cookieStore.get('site_token')?.value;\n    return siteToken === accessToken;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/data.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2295,2298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2295,2298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2307,2310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2307,2310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":80,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":80,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2799,2812],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":82,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":82,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2853,2866],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2913,2916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2913,2916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7991,7994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7991,7994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8010,8013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8010,8013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8332,8335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8332,8335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8364,8367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8364,8367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getSupabaseClient, getFreshRssClient } from './api-utils';\nimport { Article, FreshRSSItem, CleanArticleContent } from '../../types';\nimport { removeEmptyParagraphs } from '../../utils/contentUtils';\nimport { toFullId } from '../../utils/idHelpers';\n\nexport async function fetchAvailableDates(): Promise<string[]> {\n    const supabase = getSupabaseClient();\n    const { data, error } = await supabase\n        .from('articles')\n        .select('n8n_processing_date')\n        .order('n8n_processing_date', { ascending: false });\n\n    if (error) {\n        console.error('Supabase error in fetchAvailableDates:', error);\n        return [];\n    }\n\n    const dateSet = new Set<string>();\n    if (data) {\n        const formatter = new Intl.DateTimeFormat('en-CA', {\n            year: 'numeric',\n            month: '2-digit',\n            day: '2-digit',\n            timeZone: 'Asia/Shanghai',\n        });\n\n        data.forEach(item => {\n            if (item.n8n_processing_date) {\n                const date = new Date(item.n8n_processing_date);\n                dateSet.add(formatter.format(date));\n            }\n        });\n    }\n\n    return Array.from(dateSet);\n}\n\nexport function getTodayInShanghai(): string {\n    const formatter = new Intl.DateTimeFormat('en-CA', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        timeZone: 'Asia/Shanghai',\n    });\n    return formatter.format(new Date());\n}\n\nexport async function fetchBriefingData(date: string): Promise<{ [key: string]: Article[] }> {\n    const supabase = getSupabaseClient();\n\n    // Validate date format YYYY-MM-DD\n    if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n        console.error('Invalid date format in fetchBriefingData:', date);\n        return {};\n    }\n\n    const [year, month, day] = date.split('-').map(Number);\n\n    // Shanghai is UTC+8.\n    // We construct the UTC time corresponding to Shanghai's 00:00:00 and 23:59:59.999\n    // 00:00:00 Shanghai = 16:00:00 UTC (previous day) -> handled by -8 hours\n    const startDate = new Date(Date.UTC(year, month - 1, day, 0 - 8, 0, 0, 0));\n    const endDate = new Date(Date.UTC(year, month - 1, day, 23 - 8, 59, 59, 999));\n\n    // Wrap Supabase query with timeout to prevent serverless function hangs\n    const timeoutPromise = new Promise<{ data: any, error: any }>((_, reject) =>\n        setTimeout(() => reject(new Error('Supabase query timed out after 10s')), 10000)\n    );\n\n    const dataPromise = supabase\n        .from('articles')\n        .select('*')\n        .gte('n8n_processing_date', startDate.toISOString())\n        .lte('n8n_processing_date', endDate.toISOString());\n\n    let articles, error;\n    try {\n        const result = await Promise.race([dataPromise, timeoutPromise]);\n        // Supabase returns { data, error } structure\n        // @ts-ignore\n        articles = result.data;\n        // @ts-ignore\n        error = result.error;\n    } catch (e: any) {\n        console.error('Fetch Briefing Data Timeout or Error:', e);\n        return {}; // Start with empty if timeout, or throw? better to throw to trigger error.tsx\n        // Actually, if we return {}, the page renders \"No Articles\", which is better than Error page?\n        // But user said \"Loading...\" persisted. If we return {}, it renders BriefingClient -> \"No Articles\".\n        // Let's return {} for now, but log it.\n        // Wait, if we return {}, BriefingClient renders. This is SAFE.\n    }\n\n    if (error) {\n        console.error('Error fetching from Supabase by date:', error);\n        return {};\n    }\n\n    if (!articles || articles.length === 0) {\n        return {};\n    }\n\n    const uniqueById = new Map<string | number, Article>();\n    articles.forEach((a: Article) => { uniqueById.set(a.id, a); });\n    const deduped = Array.from(uniqueById.values());\n\n    const groupedArticles: { [key: string]: Article[] } = {\n        '重要新闻': [], '必知要闻': [], '常规更新': [],\n    };\n\n    deduped.forEach(article => {\n        const importance = article.verdict?.importance || '常规更新';\n        if (groupedArticles[importance]) {\n            groupedArticles[importance].push(article);\n        } else {\n            // Fallback for unknown importance\n            groupedArticles['常规更新'].push(article);\n        }\n    });\n\n    for (const importance in groupedArticles) {\n        groupedArticles[importance].sort((a, b) => (b.verdict?.score || 0) - (a.verdict?.score || 0));\n    }\n\n    return groupedArticles;\n}\n\n// End of imports clean up\n\n\n\n// 【新增】服务端直接获取文章内容 (用于 SSR / No-JS)\n\n// Helper to strip title - duplicated from ArticleDetail.tsx but needed here for SSR clean\nfunction stripLeadingTitle(contentHtml: string, title: string): string {\n    if (!contentHtml || !title) return contentHtml;\n    try {\n        const h1Match = contentHtml.match(/^\\s*<h1[^>]*>([\\s\\S]*?)<\\/h1>/i);\n        if (h1Match && h1Match[1]) {\n            const h1Text = h1Match[1].replace(/<[^>]+>/g, '').toLowerCase().trim();\n            const titleLower = title.toLowerCase().trim();\n            if (h1Text && (h1Text === titleLower || h1Text.includes(titleLower) || titleLower.includes(h1Text))) {\n                return contentHtml.replace(h1Match[0], '');\n            }\n        }\n        const textStart = contentHtml.replace(/^\\s+/, '');\n        if (textStart.toLowerCase().startsWith(title.toLowerCase().trim())) {\n            return contentHtml.replace(new RegExp('^\\\\s*' + title.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')), '');\n        }\n    } catch (e) {\n        console.error('stripLeadingTitle error', e);\n    }\n    return contentHtml;\n}\n\nexport const fetchArticleContentServer = async (id: string | number): Promise<CleanArticleContent | null> => {\n    try {\n        const freshRss = getFreshRssClient();\n        const apiBody = new URLSearchParams({ i: String(id) });\n        // Use endpoint to get JSON content\n        const data = await freshRss.post<{ items: FreshRSSItem[] }>('/stream/items/contents?output=json', apiBody);\n\n        if (!data.items || data.items.length === 0) {\n            return null;\n        }\n\n        const item = data.items[0];\n        const contentHtml = item.summary?.content || item.content?.content || '';\n        const source = item.origin?.title || (item.canonical?.[0]?.href ? new URL(item.canonical[0].href).hostname : '');\n        const title = item.title;\n\n        // Apply same cleaning as client-side\n        const cleanedHtml = stripLeadingTitle(contentHtml, title || '');\n        const finalHtml = removeEmptyParagraphs(cleanedHtml);\n\n        return {\n            title: title,\n            content: finalHtml,\n            source: source,\n        };\n    } catch (error) {\n        console.error('fetchArticleContentServer error:', error);\n        return null;\n    }\n};\n\nexport async function fetchArticleById(id: string): Promise<Article | null> {\n    const supabase = getSupabaseClient();\n\n    // Try to convert to full ID if it looks like a short ID\n    // This handles cases where the URL provides a short ID (e.g. from routing)\n    const fullId = toFullId(id);\n\n    const { data, error } = await supabase\n        .from('articles')\n        .select('*')\n        .eq('id', fullId)\n        .single();\n\n    if (error) {\n        // If searching by full ID fails, try searching by the raw ID just in case\n        // (though toFullId handles already-full IDs gracefully)\n        if (fullId !== id) {\n            const { data: retryData, error: retryError } = await supabase\n                .from('articles')\n                .select('*')\n                .eq('id', id)\n                .single();\n\n            if (!retryError) return retryData;\n        }\n\n        console.error('Error fetching article by ID:', error);\n        return null;\n    }\n    return data;\n}\n\n// --- New SSR Data Fetchers ---\n\nimport { STAR_TAG } from '../../constants';\n\n// Define Interface locally or import if possible. Let's define safely.\ninterface FreshRssTag {\n    id: string;\n    type: string;\n    count?: number;\n}\n\nexport async function getAvailableFilters(): Promise<{ tags: any[], categories: any[] }> {\n    try {\n        const freshRss = getFreshRssClient();\n\n        // Use the proven endpoint from app/api/list-categories-tags/route.ts\n        const data = await freshRss.get<{ tags: FreshRssTag[] }>('/tag/list', {\n            output: 'json',\n            with_counts: '1'\n        });\n\n        const categories: any[] = [];\n        const tags: any[] = [];\n\n        if (data.tags) {\n            data.tags.forEach((item) => {\n                const label = decodeURIComponent(item.id.split('/').pop() || '');\n\n                if (item.id.includes('/state/com.google/') || item.id.includes('/state/org.freshrss/')) {\n                    return;\n                }\n\n                if (item.type === 'folder') {\n                    categories.push({ id: item.id, label, count: item.count });\n                } else {\n                    tags.push({ id: item.id, label, count: item.count });\n                }\n            });\n        }\n\n        const sortByName = (a: { label: string }, b: { label: string }) => a.label.localeCompare(b.label, 'zh-Hans-CN');\n\n        return {\n            categories: categories.sort(sortByName),\n            tags: tags.sort(sortByName),\n        };\n    } catch (e) {\n        console.error('SERVER Error fetching filters:', e);\n        return { tags: [], categories: [] };\n    }\n}\n\nexport async function fetchStarredArticleHeaders(): Promise<{ id: string | number; title: string; tags: string[] }[]> {\n    try {\n        const freshRss = getFreshRssClient();\n        const params = {\n            n: '50',\n            output: 'json',\n            excludeContent: 'true'\n        };\n\n        // Use the correct endpoint: /stream/contents/{streamId}\n        const safeStreamId = encodeURIComponent(STAR_TAG);\n        const data = await freshRss.get<{ items: FreshRSSItem[] }>(`/stream/contents/${safeStreamId}`, params);\n\n        if (!data.items) return [];\n\n        return data.items.map(item => ({\n            id: item.id,\n            title: item.title || 'Untitled',\n            // Ensure STAR_TAG is present since we fetched from the starred stream\n            tags: Array.from(new Set([...(item.categories || []), STAR_TAG]))\n        }));\n    } catch (e) {\n        console.error('SERVER Error fetching starred headers:', e);\n        return [];\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/server/ssr-helpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1759,1762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1759,1762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getFreshRssClient, getSupabaseClient } from '../api-utils';\nimport { Article, FreshRSSItem } from '../../../types';\n\n// Map FreshRSS item to Article (Logic copied from route.ts to ensure consistency)\nfunction mapFreshItemToMinimalArticle(item: FreshRSSItem): Article {\n    const annotationTags = (item.annotations || [])\n        .map((anno: { id: string }) => anno.id)\n        .filter(Boolean);\n\n    const allTags = [\n        ...(Array.isArray(item.categories) ? item.categories : []),\n        ...annotationTags\n    ];\n\n    return {\n        id: item.id || '',\n        title: item.title || '',\n        link: item.alternate?.[0]?.href || '',\n        sourceName: item.origin?.title || '',\n        created_at: new Date().toISOString(),\n        published: new Date(item.published * 1000).toISOString(),\n        category: '',\n        briefingSection: '',\n        keywords: [],\n        verdict: { type: '', score: 0 },\n        summary: '',\n        tldr: '',\n        highlights: '',\n        critiques: '',\n        marketTake: '',\n        // n8n_processing_date: undefined, \n        tags: allTags,\n    };\n}\n\n// Fetch details from Supabase (Bypassing /api/get-briefings)\nasync function fetchSupabaseDetails(articleIds: (string | number)[]): Promise<Record<string, Article>> {\n    if (articleIds.length === 0) return {};\n    const supabase = getSupabaseClient();\n\n    // We only need specific fields that might be missing from FreshRSS\n    const { data, error } = await supabase\n        .from('articles')\n        .select('*')\n        .in('id', articleIds.map(String));\n\n    if (error || !data) {\n        console.warn('SSR: Failed to fetch Supabase details', error);\n        return {};\n    }\n\n    const map: Record<string, Article> = {};\n    data.forEach((item: any) => {\n        // Map Supabase columns to Article type (Partial)\n        // Note: The Article type in codebase matches Supabase columns mostly\n        map[item.id] = item as Article;\n    });\n    return map;\n}\n\n// Main SSR Function\nexport async function fetchFilteredArticlesSSR(\n    filterValue: string,\n    n: number = 20,\n    merge: boolean = true\n): Promise<{ articles: Article[], continuation?: string }> {\n    console.log(`[SSR] Fetching articles for: ${filterValue} (Merge: ${merge})`);\n\n    // 1. Fetch from FreshRSS directly\n    const freshRss = getFreshRssClient();\n    const safeStreamId = filterValue.replace(/&/g, '%26');\n    const params: Record<string, string> = {\n        output: 'json',\n        excludeContent: '1',\n        n: String(n)\n    };\n\n    let freshArticles: Article[] = [];\n    let continuation: string | undefined;\n\n    try {\n        const data = await freshRss.get<{ items: FreshRSSItem[], continuation?: string }>(`/stream/contents/${safeStreamId}`, params);\n        freshArticles = (data.items || []).map(mapFreshItemToMinimalArticle);\n        continuation = data.continuation;\n    } catch (e) {\n        console.error('[SSR] FreshRSS fetch failed:', e);\n        return { articles: [] };\n    }\n\n    // 2. MergeSupabase details if requested\n    if (merge && freshArticles.length > 0) {\n        const articleIds = freshArticles.map(a => a.id);\n        const supaDetailsMap = await fetchSupabaseDetails(articleIds);\n\n        freshArticles = freshArticles.map(freshArticle => {\n            const supaDetails = supaDetailsMap[freshArticle.id];\n            // Supabase details (AI summary, etc.) must overwrite FreshRSS placeholders\n            return supaDetails ? { ...freshArticle, ...supaDetails } : freshArticle;\n        });\n    }\n\n    return { articles: freshArticles, continuation };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/sitemap-helper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/lib/supabase-client.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":44,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":6,"endColumn":46},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":13,"column":25,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":13,"endColumn":37},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":13,"column":39,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":13,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nexport const getSupabaseBrowserClient = () => {\n    if (!supabaseUrl || !supabaseAnonKey) {\n        console.warn('Supabase environment variables are missing. Please check your .env.local file.');\n        // Return a dummy client or throw, depending on preference. \n        // For now, let's throw to be explicit, but maybe just warn if it's optional.\n        // Given the user's request, let's be strict.\n    }\n    return createClient(supabaseUrl!, supabaseAnonKey!);\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/not-found.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":3,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":3,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link';\n\nexport default function NotFound() {\n    return (\n        <div className=\"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-midnight-bg p-4 text-center\">\n            <h1 className=\"text-6xl font-bold bg-clip-text text-transparent bg-linear-to-r from-indigo-500 via-purple-500 to-pink-500 mb-4\">\n                404\n            </h1>\n            <h2 className=\"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4\">\n                Page Not Found\n            </h2>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-8 max-w-md\">\n                Sorry, the page you are looking for does not exist. It might have been moved or deleted.\n            </p>\n            <div className=\"flex gap-4\">\n                <Link\n                    href=\"/\"\n                    className=\"px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/30\"\n                >\n                    Return Home\n                </Link>\n                <Link\n                    href=\"/trends\"\n                    className=\"px-6 py-2 bg-white text-gray-800 border border-gray-200 rounded-full hover:bg-gray-50 dark:bg-transparent dark:text-gray-200 dark:border-gray-700 dark:hover:bg-midnight-card transition-colors\"\n                >\n                    Explore Trends\n                </Link>\n            </div>\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/page.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":158,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":158,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6983,6986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6983,6986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7418,7421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7418,7421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'briefingDates' is assigned a value but never used.","line":191,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":191,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9000,9003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9000,9003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fetchAvailableDates, fetchBriefingData } from './lib/data';\nimport { fetchFilteredArticlesSSR } from './lib/server/ssr-helpers';\nimport MainContentClient from './components/MainContentClient';\nimport { resolveBriefingImage } from '../services/articleLoader';\nimport { Metadata } from 'next';\nimport { Filter } from '../types';\n\nexport const dynamic = 'force-dynamic';\n\nasync function getLatestBriefingData() {\n    const dates = await fetchAvailableDates();\n    const initialDate = dates.length > 0 ? dates[0] : undefined;\n\n    if (!initialDate) return { initialDate: undefined, articles: [], headerImageUrl: undefined, dates: [] };\n\n    const groupedArticles = await fetchBriefingData(initialDate);\n    const articles = Object.values(groupedArticles).flat();\n    const headerImageUrl = await resolveBriefingImage(initialDate);\n\n    // Return dates as well so we can build the archive schema\n    return { initialDate, articles, headerImageUrl, dates };\n}\n\nexport async function generateMetadata({ searchParams }: { searchParams: Promise<{ [key: string]: string | string[] | undefined }> }): Promise<Metadata> {\n    const params = await searchParams;\n    const filterType = typeof params.filter === 'string' ? params.filter : undefined;\n    const filterValue = typeof params.value === 'string' ? params.value : undefined;\n\n    // 1. Handle \"Date\" Filter explicitly (Match /date/[date] logic)\n    if (filterType === 'date' && filterValue) {\n        // Fetch specific date data\n        const grouped = await fetchBriefingData(filterValue);\n        const dateArticles = Object.values(grouped).flat();\n        const topImage = await resolveBriefingImage(filterValue);\n\n        // If no articles for the date, return a generic fallback for that date\n        if (dateArticles.length === 0) {\n            return {\n                title: `${filterValue} Briefing`,\n                description: `${filterValue} 每日精选简报。汇聚科技新闻与 RSS 订阅精华。`,\n                openGraph: {\n                    title: `${filterValue} Briefing | RSS简报`,\n                    description: `${filterValue} 每日精选简报。汇聚科技新闻与 RSS 订阅精华。`,\n                    images: [{ url: topImage || 'https://www.alok-rss.top/computer_cat_180.jpeg', width: 1600, height: 1200, alt: `${filterValue} Briefing` }],\n                }\n            };\n        }\n\n        // Sorting Logic: Priority > Score\n        const PRIORITY_MAP: Record<string, number> = {\n            '重要新闻': 3,\n            '必知要闻': 2,\n            '常规更新': 1,\n        };\n        const sorted = [...dateArticles].sort((a, b) => {\n            // Get raw importance string\n            const sectionA = a.briefingSection || a.verdict?.importance || '常规更新';\n            const sectionB = b.briefingSection || b.verdict?.importance || '常规更新';\n\n            const pA = PRIORITY_MAP[sectionA] || 0;\n            const pB = PRIORITY_MAP[sectionB] || 0;\n\n            if (pA !== pB) return pB - pA;\n            return (b.verdict?.score || 0) - (a.verdict?.score || 0);\n        });\n\n        const top2 = sorted.slice(0, 2);\n        let dynamicTitle = `${filterValue} `;\n        if (top2.length > 0) {\n            const t1 = top2[0].title.replace(/\\|/g, '-');\n            dynamicTitle += `${t1}`;\n            if (top2.length > 1) {\n                const t2 = top2[1].title.replace(/\\|/g, '-');\n                // Check approximate length (Social/Search limit ~60 chars)\n                // Relaxed limit to 100 to ensure 2nd title shows (User Preference > Strict SEO No-Truncation)\n                if ((dynamicTitle.length + t2.length) < 100) {\n                    dynamicTitle += `、${t2}`;\n                }\n            }\n            // Layout template adds brand suffix\n        } else {\n            dynamicTitle += `Briefing`;\n        }\n\n        const tldrList = dateArticles.slice(0, 10).map((a, i) => `${i + 1}. ${a.tldr || a.title}`).join(' ');\n        const desc = tldrList\n            ? `${filterValue} 每日简报。本期要点：${tldrList}`\n            : `${filterValue} 每日精选简报。汇聚科技新闻与 RSS 订阅精华。`;\n\n        return {\n            title: dynamicTitle,\n            description: desc,\n            alternates: {\n                canonical: `https://www.alok-rss.top/date/${filterValue}`,\n            },\n            openGraph: {\n                title: dynamicTitle,\n                description: desc,\n                type: 'website',\n                url: `https://www.alok-rss.top/date/${filterValue}`,\n                siteName: 'RSS Briefing Hub',\n                images: [{ url: topImage || 'https://www.alok-rss.top/computer_cat_180.jpeg', width: 1600, height: 1200, alt: `${filterValue} Briefing` }],\n            }\n        };\n    }\n\n    // 2. Handle Other Filters (Category/Tag/Search)\n    if (filterType && filterValue) {\n        return {\n            title: `${decodeURIComponent(filterValue)} - Article List`,\n            description: `Articles filtered by ${filterType}: ${decodeURIComponent(filterValue)}`,\n            alternates: {\n                canonical: `https://www.alok-rss.top/?filter=${filterType}&value=${filterValue}`,\n            },\n            openGraph: {\n                title: `${decodeURIComponent(filterValue)} - Article List`,\n                description: `Articles filtered by ${filterType}: ${decodeURIComponent(filterValue)}`,\n                type: 'website',\n                url: `https://www.alok-rss.top/?filter=${filterType}&value=${filterValue}`,\n                siteName: 'RSS Briefing Hub',\n                images: [\n                    {\n                        url: 'https://www.alok-rss.top/computer_cat_180.jpeg', // Generic image for filtered lists\n                        width: 1600,\n                        height: 1200,\n                        alt: `Filtered Articles`,\n                    }\n                ],\n            },\n        };\n    }\n\n    // 3. Default Homepage (No Filters) -> Brand Title\n    const { initialDate, headerImageUrl } = await getLatestBriefingData();\n\n    return {\n        // Title & Description are omitted to inherit from layout.tsx (Brand Strategy)\n        alternates: {\n            canonical: 'https://www.alok-rss.top',\n        },\n        openGraph: {\n            // Inherit Title/Desc from layout.tsx automatically (Next.js Deep Merge)\n            type: 'website',\n            url: 'https://www.alok-rss.top',\n            siteName: 'RSS Briefing Hub',\n            images: [\n                {\n                    url: headerImageUrl || 'https://www.alok-rss.top/computer_cat_180.jpeg',\n                    width: 1600,\n                    height: 1200,\n                    alt: `${initialDate} Briefing Cover`,\n                }\n            ],\n        },\n    };\n}\n\nexport default async function Home(props: { searchParams?: Promise<{ [key: string]: string | string[] | undefined }> }) {\n    const params = await props.searchParams;\n    const filterType = typeof params?.filter === 'string' ? params.filter : undefined;\n    const filterValue = typeof params?.value === 'string' ? params.value : undefined;\n\n    let initialData: any = {};\n    let initialFilter: Filter | null = null;\n    let briefingDates: string[] = [];\n\n    if (filterType && filterValue) {\n        // Category / Tag / Search View\n        const { articles, continuation } = await fetchFilteredArticlesSSR(filterValue, 20, true);\n        initialData = {\n            initialArticles: articles,\n            initialContinuation: continuation\n        };\n        initialFilter = { type: filterType as any, value: filterValue };\n\n        // Use empty dates or fetch distinct dates if needed for UI? MainContentClient handles dates via Sidebar.\n        // Sidebar dates are fetched in MainLayout -> SidebarClient.\n    } else {\n        // Default Briefing View\n        const { initialDate, articles, headerImageUrl, dates } = await getLatestBriefingData();\n        initialData = {\n            initialDate,\n            initialHeaderImageUrl: headerImageUrl,\n            initialArticles: articles,\n            initialContinuation: null\n        };\n        // If initialDate exists, activeFilter should be 'date'\n        if (initialDate) {\n            initialFilter = { type: 'date', value: initialDate };\n        }\n        briefingDates = dates || []; // Use default empty array for dates if undefined\n    }\n\n    const renderSchemas = [];\n    if (initialData.initialDate && initialData.initialArticles?.length > 0) {\n        const date = initialData.initialDate;\n        const articles = initialData.initialArticles;\n        renderSchemas.push({\n            '@context': 'https://schema.org',\n            '@type': 'NewsArticle',\n            headline: `${date} Briefing | 每日简报`,\n            image: {\n                '@type': 'ImageObject',\n                'url': initialData.initialHeaderImageUrl || 'https://www.alok-rss.top/computer_cat_180.jpeg'\n            },\n            description: `Daily Briefing for ${date}`,\n            datePublished: `${date}T08:00:00+08:00`,\n            mainEntity: {\n                '@type': 'ItemList',\n                itemListElement: articles.map((article: any, index: number) => ({\n                    '@type': 'ListItem',\n                    position: index + 1,\n                    url: `https://www.alok-rss.top/article/${article.id}`,\n                    name: article.title\n                }))\n            }\n        });\n    }\n\n    return (\n        <>\n            {renderSchemas.length > 0 && (\n                <script\n                    type=\"application/ld+json\"\n                    dangerouslySetInnerHTML={{ __html: JSON.stringify(renderSchemas) }}\n                />\n            )}\n            <MainContentClient\n                initialDate={initialData.initialDate}\n                initialHeaderImageUrl={initialData.initialHeaderImageUrl}\n                initialArticles={initialData.initialArticles}\n                // New Props\n                initialActiveFilter={initialFilter}\n                initialContinuation={initialData.initialContinuation}\n            />\n        </>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/providers.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":6,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":6,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { useState } from 'react';\n\nexport default function Providers({ children }: { children: React.ReactNode }) {\n    const [queryClient] = useState(() => new QueryClient({\n        defaultOptions: {\n            queries: {\n                staleTime: 60 * 1000,\n            },\n        },\n    }));\n\n    return (\n        <QueryClientProvider client={queryClient}>\n            {children}\n        </QueryClientProvider>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/sentry-example-page/page.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":14,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":14,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Head from \"next/head\";\nimport * as Sentry from \"@sentry/nextjs\";\nimport { useState, useEffect } from \"react\";\n\nclass SentryExampleFrontendError extends Error {\n  constructor(message: string | undefined) {\n    super(message);\n    this.name = \"SentryExampleFrontendError\";\n  }\n}\n\nexport default function Page() {\n  const [hasSentError, setHasSentError] = useState(false);\n  const [isConnected, setIsConnected] = useState(true);\n  \n  useEffect(() => {\n    async function checkConnectivity() {\n      const result = await Sentry.diagnoseSdkConnectivity();\n      setIsConnected(result !== 'sentry-unreachable');\n    }\n    checkConnectivity();\n  }, []);\n\n  return (\n    <div>\n      <Head>\n        <title>sentry-example-page</title>\n        <meta name=\"description\" content=\"Test Sentry for your Next.js app!\" />\n      </Head>\n\n      <main>\n        <div className=\"flex-spacer\" />\n        <svg height=\"40\" width=\"40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M21.85 2.995a3.698 3.698 0 0 1 1.353 1.354l16.303 28.278a3.703 3.703 0 0 1-1.354 5.053 3.694 3.694 0 0 1-1.848.496h-3.828a31.149 31.149 0 0 0 0-3.09h3.815a.61.61 0 0 0 .537-.917L20.523 5.893a.61.61 0 0 0-1.057 0l-3.739 6.494a28.948 28.948 0 0 1 9.63 10.453 28.988 28.988 0 0 1 3.499 13.78v1.542h-9.852v-1.544a19.106 19.106 0 0 0-2.182-8.85 19.08 19.08 0 0 0-6.032-6.829l-1.85 3.208a15.377 15.377 0 0 1 6.382 12.484v1.542H3.696A3.694 3.694 0 0 1 0 34.473c0-.648.17-1.286.494-1.849l2.33-4.074a8.562 8.562 0 0 1 2.689 1.536L3.158 34.17a.611.611 0 0 0 .538.917h8.448a12.481 12.481 0 0 0-6.037-9.09l-1.344-.772 4.908-8.545 1.344.77a22.16 22.16 0 0 1 7.705 7.444 22.193 22.193 0 0 1 3.316 10.193h3.699a25.892 25.892 0 0 0-3.811-12.033 25.856 25.856 0 0 0-9.046-8.796l-1.344-.772 5.269-9.136a3.698 3.698 0 0 1 3.2-1.849c.648 0 1.285.17 1.847.495Z\" fill=\"currentcolor\"/>\n        </svg>\n        <h1>\n          sentry-example-page\n        </h1>\n\n        <p className=\"description\">\n          Click the button below, and view the sample error on the Sentry <a target=\"_blank\" href=\"https://alok-rss.sentry.io/issues/?project=4510530481356800\" rel=\"noreferrer\">Issues Page</a>.\n          For more details about setting up Sentry, <a target=\"_blank\"\n           href=\"https://docs.sentry.io/platforms/javascript/guides/nextjs/\" rel=\"noreferrer\">read our docs</a>.\n        </p>\n\n        <button\n          type=\"button\"\n          onClick={async () => {\n            await Sentry.startSpan({\n              name: 'Example Frontend/Backend Span',\n              op: 'test'\n            }, async () => {\n              const res = await fetch(\"/api/sentry-example-api\");\n              if (!res.ok) {\n                setHasSentError(true);\n              }\n            });\n            throw new SentryExampleFrontendError(\"This error is raised on the frontend of the example page.\");\n          }}\n          disabled={!isConnected}\n        >\n          <span>\n            Throw Sample Error\n          </span>\n        </button>\n\n        {hasSentError ? (\n          <p className=\"success\">\n            Error sent to Sentry.\n          </p>\n        ) : !isConnected ? (\n          <div className=\"connectivity-error\">\n            <p>It looks like network requests to Sentry are being blocked, which will prevent errors from being captured. Try disabling your ad-blocker to complete the test.</p>\n          </div>\n        ) : (\n          <div className=\"success_placeholder\" />\n        )}\n\n        <div className=\"flex-spacer\" />\n      \n      </main>\n\n      <style>{`\n        main {\n          display: flex;\n          min-height: 100vh;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          gap: 16px;\n          padding: 16px;\n          font-family: system-ui, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", sans-serif;\n        }\n\n        h1 {\n          padding: 0px 4px;\n          border-radius: 4px;\n          background-color: rgba(24, 20, 35, 0.03);\n          font-family: monospace;\n          font-size: 20px;\n          line-height: 1.2;\n        }\n\n        p {\n          margin: 0;\n          font-size: 20px;\n        }\n\n        a {\n          color: #6341F0;\n          text-decoration: underline;\n          cursor: pointer;\n\n          @media (prefers-color-scheme: dark) {\n            color: #B3A1FF;\n          }\n        }\n\n        button {\n          border-radius: 8px;\n          color: white;\n          cursor: pointer;\n          background-color: #553DB8;\n          border: none;\n          padding: 0;\n          margin-top: 4px;\n\n          & > span {\n            display: inline-block;\n            padding: 12px 16px;\n            border-radius: inherit;\n            font-size: 20px;\n            font-weight: bold;\n            line-height: 1;\n            background-color: #7553FF;\n            border: 1px solid #553DB8;\n            transform: translateY(-4px);\n          }\n\n          &:hover > span {\n            transform: translateY(-8px);\n          }\n\n          &:active > span {\n            transform: translateY(0);\n          }\n\n          &:disabled {\n\t            cursor: not-allowed;\n\t            opacity: 0.6;\n\t\n\t            & > span {\n\t              transform: translateY(0);\n\t              border: none\n\t            }\n\t          }\n        }\n\n        .description {\n          text-align: center;\n          color: #6E6C75;\n          max-width: 500px;\n          line-height: 1.5;\n          font-size: 20px;\n\n          @media (prefers-color-scheme: dark) {\n            color: #A49FB5;\n          }\n        }\n\n        .flex-spacer {\n          flex: 1;\n        }\n\n        .success {\n          padding: 12px 16px;\n          border-radius: 8px;\n          font-size: 20px;\n          line-height: 1;\n          background-color: #00F261;\n          border: 1px solid #00BF4D;\n          color: #181423;\n        }\n\n        .success_placeholder {\n          height: 46px;\n        }\n\n        .connectivity-error {\n          padding: 12px 16px;\n          background-color: #E50045;\n          border-radius: 8px;\n          width: 500px;\n          color: #FFFFFF;\n          border: 1px solid #A80033;\n          text-align: center;\n          margin: 0;\n        }\n        \n        .connectivity-error a {\n          color: #FFFFFF;\n          text-decoration: underline;\n        }\n      `}</style>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/stream/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[623,626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[623,626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":33,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":33,"endColumn":39},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":48,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":48,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport ArticleListHeader from '@/components/ArticleListHeader';\nimport StreamList from '@/app/components/StreamList';\nimport { fetchFilteredArticlesSSR } from '../../lib/server/ssr-helpers';\nimport { getAvailableFilters } from '../../lib/data';\n\n// Enable ISR (Incremental Static Regeneration)\n// Revalidate every 7 days (604800 seconds), relying on on-demand revalidation for updates\nexport const revalidate = 604800;\nexport const dynamicParams = true; // Allow generating pages for new tags on demand\n\n// Helper to extract top keywords from a list of articles\nfunction getTopKeywords(articles: any[], limit = 10): string[] {\n    const frequency: Record<string, number> = {};\n    articles.forEach(article => {\n        if (Array.isArray(article.keywords)) {\n            article.keywords.forEach((k: string) => {\n                // Normalize: lowercase and trim\n                const cleanKey = k.trim();\n                if (cleanKey) {\n                    frequency[cleanKey] = (frequency[cleanKey] || 0) + 1;\n                }\n            });\n        }\n    });\n\n    return Object.entries(frequency)\n        .sort(([, a], [, b]) => b - a) // Sort by descending frequency\n        .slice(0, limit)\n        .map(([key]) => key);\n}\n\nexport async function generateMetadata({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const decodedId = decodeURIComponent(id);\n    const tagName = decodedId.split('/').pop() || decodedId;\n\n    const { articles } = await fetchFilteredArticlesSSR(decodedId, 20, true);\n    const topKeywords = getTopKeywords(articles, 8);\n\n    return {\n        title: `${tagName} - AI Insights & Briefings`,\n        description: `Explore AI-curated insights for ${tagName}, covering topics like ${topKeywords.join(', ')}. Daily updates, market takes, and critical analysis.`,\n        keywords: topKeywords,\n    };\n}\n\nexport default async function StreamPage({ params }: { params: Promise<{ id: string }> }) {\n    const { id } = await params;\n    const decodedId = decodeURIComponent(id);\n    const tagName = decodedId.split('/').pop() || decodedId;\n\n    // Parallel fetch for efficiency\n    const [articlesData, filtersData] = await Promise.all([\n        fetchFilteredArticlesSSR(decodedId, 20, true),\n        getAvailableFilters()\n    ]);\n\n    const { articles, continuation } = articlesData;\n    const { categories } = filtersData;\n\n    // Extract keywords for UI\n    const relatedTopics = getTopKeywords(articles, 8); // Reduced to 8 for cleaner header\n\n    // Determine if this is a Category by checking the API source of truth\n    // Categories are defined as folders in FreshRSS\n    const isCategory = categories.some(cat => cat.id === decodedId);\n\n    return (\n        <div className=\"max-w-4xl mx-auto px-4 py-8\">\n            <ArticleListHeader\n                title={tagName}\n                count={articles.length}\n                showCount={!isCategory}\n                description={relatedTopics.length > 0 ? relatedTopics.join(', ') : undefined}\n            />\n\n            <StreamList\n                filterValue={decodedId}\n                initialArticles={articles}\n                initialContinuation={continuation}\n            />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/app/trends/page.tsx","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":11,"column":16,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":11,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport TrendsView from '../../components/TrendsView';\n\nexport const dynamic = 'force-static';\n\nexport const metadata = {\n    title: 'Trends - Briefing Hub',\n    description: 'Explore the latest technology trends and industry updates.',\n};\n\nexport default function TrendsPage() {\n    return (\n        <div className=\"min-h-screen bg-gray-50 dark:bg-midnight-bg\">\n            <TrendsView />\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/ArticleCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useMemo' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":5,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"react/prop-types","severity":2,"message":"'className' is missing in props validation","line":66,"column":60,"nodeType":"Property","messageId":"missingPropType","endLine":66,"endColumn":69},{"ruleId":"react/prop-types","severity":2,"message":"'className' is missing in props validation","line":69,"column":61,"nodeType":"Property","messageId":"missingPropType","endLine":69,"endColumn":70},{"ruleId":"react/prop-types","severity":2,"message":"'title' is missing in props validation","line":79,"column":49,"nodeType":"Property","messageId":"missingPropType","endLine":79,"endColumn":54},{"ruleId":"react/prop-types","severity":2,"message":"'content' is missing in props validation","line":79,"column":56,"nodeType":"Property","messageId":"missingPropType","endLine":79,"endColumn":63},{"ruleId":"react/prop-types","severity":2,"message":"'article' is missing in props validation","line":91,"column":61,"nodeType":"Property","messageId":"missingPropType","endLine":91,"endColumn":68},{"ruleId":"react/prop-types","severity":2,"message":"'onReaderModeRequest' is missing in props validation","line":91,"column":70,"nodeType":"Property","messageId":"missingPropType","endLine":91,"endColumn":89},{"ruleId":"react/prop-types","severity":2,"message":"'onStateChange' is missing in props validation","line":91,"column":91,"nodeType":"Property","messageId":"missingPropType","endLine":91,"endColumn":104},{"ruleId":"react/prop-types","severity":2,"message":"'className' is missing in props validation","line":91,"column":106,"nodeType":"Property","messageId":"missingPropType","endLine":91,"endColumn":115},{"ruleId":"react/prop-types","severity":2,"message":"'article.id' is missing in props validation","line":105,"column":41,"nodeType":"Identifier","messageId":"missingPropType","endLine":105,"endColumn":43},{"ruleId":"react/prop-types","severity":2,"message":"'article.link' is missing in props validation","line":158,"column":38,"nodeType":"Identifier","messageId":"missingPropType","endLine":158,"endColumn":42},{"ruleId":"react/prop-types","severity":2,"message":"'article.link' is missing in props validation","line":198,"column":38,"nodeType":"Identifier","messageId":"missingPropType","endLine":198,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isStarred' is assigned a value but never used.","line":224,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":224,"endColumn":22}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/ArticleCard.tsx\n\nimport React, { useState, useMemo, memo } from 'react';\nimport Link from 'next/link';\nimport { Article, Tag } from '../types';\nimport TagPopover from './TagPopover';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\nimport { getRandomColorClass } from '../utils/colorUtils';\nimport { toShortId } from '../utils/idHelpers';\nimport { STAR_TAG, READ_TAG } from '../constants';\nimport ArticleTitleStar from '../app/components/ArticleTitleStar';\n\n// 1. 【修改】将所有辅助组件和常量移至文件顶层，使其不随 ArticleCard 的渲染而重新创建\n\nconst CALLOUT_THEMES = { '一句话总结': { icon: '📝', color: 'pink' }, '技术洞察': { icon: '🔬', color: 'blue' }, '值得注意': { icon: '⚠️', color: 'brown' }, '市场观察': { icon: '📈', color: 'green' } } as const;\nconst calloutCardClasses = {\n    pink: { bg: 'bg-pink-100 dark:bg-midnight-callout-pink-bg', title: 'text-pink-950 dark:text-midnight-callout-pink-title', body: 'text-pink-900 dark:text-midnight-callout-pink-body', emphasis: 'font-bold text-violet-700' },\n    blue: { bg: 'bg-blue-100 dark:bg-midnight-callout-blue-bg', title: 'text-blue-950 dark:text-midnight-callout-blue-title', body: 'text-blue-900 dark:text-midnight-callout-blue-body', emphasis: 'font-bold text-violet-700' },\n    brown: { bg: 'bg-orange-100 dark:bg-midnight-callout-orange-bg', title: 'text-orange-950 dark:text-midnight-callout-orange-title', body: 'text-orange-900 dark:text-midnight-callout-orange-body', emphasis: 'font-bold text-violet-700' },\n    green: { bg: 'bg-green-100 dark:bg-midnight-callout-green-bg', title: 'text-green-950 dark:text-midnight-callout-green-title', body: 'text-green-900 dark:text-midnight-callout-green-body', emphasis: 'font-bold text-violet-700' }\n};\nconst parseFormattedText = (text: string, emphasisClass: string = 'font-semibold text-current') => {\n    if (!text) return '';\n    const parts = text.split(/(\\*\\*.*?\\*\\*|`.*?`)/g);\n    return parts.map((part, i) => {\n        if (i % 2 === 1) {\n            if (part.startsWith('**') && part.endsWith('**')) {\n                return <strong key={i} className={emphasisClass}>{part.slice(2, -2)}</strong>;\n            } else if (part.startsWith('`') && part.endsWith('`')) {\n                return <code key={i} className=\"text-orange-900 bg-orange-100 px-1.5 py-0.5 rounded-sm font-semibold font-mono text-[0.9em] mx-0.5\">{part.slice(1, -1)}</code>;\n            }\n        }\n        return part;\n    });\n};\n\nconst formatArticleForClipboard = (article: Article): string => {\n    const publishedDate = new Date(article.published).toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });\n    const keywords = article.keywords.join('\\n');\n\n    return [\n        article.title,\n        `${article.sourceName} • 发布于 ${publishedDate}`,\n        `${article.verdict.type} • ${article.category} • 评分: ${article.verdict.score}/10`,\n        keywords,\n        '',\n        '【一句话总结】',\n        article.summary || '',\n        '',\n        '【技术洞察】',\n        article.highlights,\n        '',\n        '【值得注意】',\n        article.critiques,\n        '',\n        '【市场观察】',\n        article.marketTake\n    ].join('\\n');\n};\n\n// --- 外部化的组件定义 ---\n\nconst SpinnerIcon: React.FC = memo(() => (<svg className=\"animate-spin size-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle><path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>));\nSpinnerIcon.displayName = 'SpinnerIcon';\n\nconst IconCopy: React.FC<{ className?: string }> = memo(({ className }) => (<svg xmlns=\"http://www.w3.org/2000/svg\" className={`size-5 ${className || ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" /></svg>));\nIconCopy.displayName = 'IconCopy';\n\nconst IconCheck: React.FC<{ className?: string }> = memo(({ className }) => (<svg xmlns=\"http://www.w3.org/2000/svg\" className={`size-5 ${className || ''}`} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" /></svg>));\nIconCheck.displayName = 'IconCheck';\n\nconst IconCheckCircle: React.FC = memo(() => (<svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" /></svg>));\nIconCheckCircle.displayName = 'IconCheckCircle';\n\nconst IconCircle: React.FC = memo(() => (<svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>));\nIconCircle.displayName = 'IconCircle';\n\ninterface CalloutProps { title: keyof typeof CALLOUT_THEMES; content: string; }\nconst Callout: React.FC<CalloutProps> = memo(({ title, content }) => { const theme = CALLOUT_THEMES[title]; const colors = calloutCardClasses[theme.color]; return (<aside className={`rounded-2xl p-6 ${colors.bg}`}><div className=\"flex items-center gap-x-3 mb-3\"><span className=\"text-2xl\">{theme.icon}</span><h4 className={`text-lg font-bold ${colors.title}`}>{title}</h4></div><div className={`${colors.body} text-[15px] leading-relaxed font-medium`}>{parseFormattedText(content, colors.emphasis)}</div></aside>); });\nCallout.displayName = 'Callout';\n\ninterface ActionButtonsProps {\n    article: Article;\n    onReaderModeRequest: (article: Article) => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n    className?: string;\n}\n\nimport { useUIStore } from '../store/uiStore';\n\nconst ActionButtons: React.FC<ActionButtonsProps> = memo(({ article, onReaderModeRequest, onStateChange, className }) => {\n    const { isStarred, isRead, userTagLabels: displayedUserTags } = useArticleMetadata(article);\n    const isAdmin = useUIStore(state => state.isAdmin);\n\n    const [isTagPopoverOpen, setIsTagPopoverOpen] = useState(false);\n    const [isLoading, setIsLoading] = useState<'star' | 'read' | null>(null);\n\n    const handleToggleState = async (action: 'star' | 'read') => {\n        setIsLoading(action);\n        const tag = action === 'star' ? STAR_TAG : READ_TAG;\n        const isActive = action === 'star' ? isStarred : isRead;\n        try {\n            const tagsToAdd = isActive ? [] : [tag];\n            const tagsToRemove = isActive ? [tag] : [];\n            await onStateChange(article.id, tagsToAdd, tagsToRemove);\n        } finally {\n            setIsLoading(null);\n        }\n    };\n\n    const actionButtonClass = \"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 active:scale-95 disabled:opacity-75\";\n    const mobileActionButtonClass = \"flex flex-col items-center justify-center h-16 w-16 text-xs font-medium rounded-full p-1 gap-1 transition-transform active:scale-95\";\n\n    return (\n        <div className={`relative mt-6 md:mt-8 ${className || ''}`}>\n            {/* Desktop Buttons */}\n            <div className=\"hidden md:flex flex-col\">\n                <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <button onClick={() => onReaderModeRequest(article)} className={`${actionButtonClass} bg-blue-800 hover:bg-blue-900 text-white cursor-pointer`}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" /></svg>\n                            <span className=\"cursor-pointer\">阅读</span>\n                        </button>\n                        {isAdmin && (\n                            <>\n                                <button\n                                    onClick={() => handleToggleState('star')}\n                                    disabled={!!isLoading}\n                                    className={`${actionButtonClass} ${isStarred ? 'bg-amber-400 text-amber-950' : 'bg-amber-200 hover:bg-amber-300 text-amber-900'} ${isLoading ? 'cursor-wait' : 'cursor-pointer'}`}\n                                >\n                                    {isLoading === 'star' ? <SpinnerIcon /> : <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 cursor-pointer\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>}\n                                    <span className=\"cursor-pointer\">{isStarred ? '已收藏' : '收藏'}</span>\n                                </button>\n                                <button\n                                    onClick={() => handleToggleState('read')}\n                                    disabled={!!isLoading}\n                                    className={`${actionButtonClass} ${isRead ? 'bg-emerald-400 text-emerald-950 hover:bg-emerald-500' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} ${isLoading ? 'cursor-wait' : 'cursor-pointer'}`}\n                                >\n                                    {isLoading === 'read' ? <SpinnerIcon /> : (isRead ? <IconCheckCircle /> : <IconCircle />)}\n                                    <span className=\"cursor-pointer\">{isRead ? '已读' : '标记已读'}</span>\n                                </button>\n                                <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                                    <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className={`${actionButtonClass} bg-sky-200 hover:bg-sky-300 text-sky-900 cursor-pointer`}>\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                                        <span className=\"cursor-pointer\">标签</span>\n                                    </button>\n                                    {isTagPopoverOpen && <TagPopover article={article} onClose={() => setIsTagPopoverOpen(false)} onStateChange={onStateChange} />}\n                                </div>\n                            </>\n                        )}\n                        {displayedUserTags.length > 0 && (\n                            <div className=\"hidden md:flex flex-wrap gap-2 items-center\">\n                                <div className=\"border-l border-stone-300 h-6 mx-1\"></div>\n                                {displayedUserTags.map(tagLabel => (tagLabel && <span key={tagLabel} className={`text-xs font-semibold inline-block py-1 px-2.5 rounded-full ${getRandomColorClass(tagLabel)}`}>{tagLabel}</span>))}\n                            </div>\n                        )}\n                    </div>\n                    <a href={article.link} target=\"_blank\" rel=\"noopener noreferrer\" className={`${actionButtonClass} bg-stone-200 hover:bg-stone-300 text-stone-800 w-fit cursor-pointer`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-4 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" /><path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" /></svg>\n                        <span className=\"cursor-pointer\">原文</span>\n                    </a>\n                </div>\n            </div>\n            {/* Mobile Buttons */}\n            <div className=\"md:hidden mt-8\">\n                <div className=\"flex justify-around items-center\">\n                    <button onClick={() => onReaderModeRequest(article)} className={`${mobileActionButtonClass} text-blue-600 cursor-pointer`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-7 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" /></svg>\n                        <span className=\"text-xs sr-only cursor-pointer\">阅读</span>\n                    </button>\n                    {isAdmin && (\n                        <>\n                            <button\n                                onClick={() => handleToggleState('star')}\n                                disabled={!!isLoading}\n                                className={`${mobileActionButtonClass} ${isStarred ? 'text-amber-500' : 'text-gray-600'} ${isLoading ? 'cursor-wait' : 'cursor-pointer'}`}\n                            >\n                                {isLoading === 'star' ? <SpinnerIcon /> : <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-7 cursor-pointer\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>}\n                                <span className=\"text-xs sr-only cursor-pointer\">{isStarred ? '已收藏' : '收藏'}</span>\n                            </button>\n                            <button\n                                onClick={() => handleToggleState('read')}\n                                disabled={!!isLoading}\n                                className={`${mobileActionButtonClass} ${isRead ? 'text-emerald-600' : 'text-gray-600'} ${isLoading ? 'cursor-wait' : 'cursor-pointer'}`}\n                            >\n                                {isLoading === 'read' ? <SpinnerIcon /> : (isRead ? <IconCheckCircle /> : <IconCircle />)}\n                                <span className=\"text-xs sr-only cursor-pointer\">{isRead ? '已读' : '标记已读'}</span>\n                            </button>\n                            <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                                <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className={`${mobileActionButtonClass} text-sky-600 cursor-pointer`}>\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-7 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                                    <span className=\"text-xs sr-only cursor-pointer\">标签</span>\n                                </button>\n                                {isTagPopoverOpen && <TagPopover article={article} onClose={() => setIsTagPopoverOpen(false)} onStateChange={onStateChange} />}\n                            </div>\n                        </>\n                    )}\n                    <a href={article.link} target=\"_blank\" rel=\"noopener noreferrer\" className={`${mobileActionButtonClass} text-gray-600 cursor-pointer`}>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"size-7 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" /><path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" /></svg>\n                        <span className=\"text-xs sr-only cursor-pointer\">原文</span>\n                    </a>\n                </div>\n                {displayedUserTags.length > 0 && (\n                    <div className=\"flex flex-wrap gap-2 items-center justify-center mt-2 pt-2 border-t border-gray-200\">\n                        {displayedUserTags.map(tagLabel => (tagLabel && <span key={tagLabel} className={`text-xs font-semibold inline-block py-1 px-2.5 rounded-full ${getRandomColorClass(tagLabel)}`}>{tagLabel}</span>))}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n});\nActionButtons.displayName = 'ActionButtons';\n\n\ninterface ArticleCardProps {\n    article: Article;\n    onReaderModeRequest: (article: Article) => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n    showActions?: boolean;\n}\n\nconst ArticleCard: React.FC<ArticleCardProps> = ({ article, onReaderModeRequest, onStateChange, showActions = true }) => {\n    // 2. 【删除】内部组件定义已全部移出\n    const { isStarred } = useArticleMetadata(article);\n    const publishedDate = new Date(article.published).toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });\n    const allKeywords = [...article.keywords];\n    const [isCopied, setIsCopied] = useState(false);\n\n    const handleCopy = async () => {\n        const text = formatArticleForClipboard(article);\n        try {\n            await navigator.clipboard.writeText(text);\n            setIsCopied(true);\n            setTimeout(() => setIsCopied(false), 2000);\n        } catch (err) {\n            console.error('Failed to copy:', err);\n        }\n    };\n\n    return (\n        <article className=\"@container py-2 transition-opacity duration-300\">\n            <header className=\"mb-10\">\n                <h3 className=\"text-2xl lg:text-2xl font-bold font-serif text-stone-900 dark:text-midnight-text-title mb-6 leading-tight\">\n                    <ArticleTitleStar article={article} className=\"inline-block size-6 mr-2 relative top-[3px]\" />\n                    {/* SEO-Only Link: Behaves like text for users (preventDefault), but href remains for crawlers */}\n                    <Link\n                        href={`/article/${toShortId(String(article.id))}`}\n                        onClick={(e) => e.preventDefault()}\n                        onDragStart={(e) => e.preventDefault()}\n                        draggable={false}\n                        className=\"align-middle cursor-text hover:no-underline transition-colors select-text\"\n                    >\n                        {article.title}\n                    </Link>\n                    <button\n                        onClick={handleCopy}\n                        className={`inline-block ml-3 align-middle transition-all duration-200 p-1 rounded-sm ${isCopied ? 'text-green-500' : 'text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-white/5'} cursor-pointer`}\n                        title={isCopied ? \"复制成功\" : \"复制文章内容\"}\n                    >\n                        {isCopied ? <IconCheck className=\"cursor-pointer\" /> : <IconCopy className=\"cursor-pointer\" />}\n                    </button>\n                </h3>\n                <div className=\"bg-gray-100 dark:bg-midnight-metadata-bg p-6 rounded-lg border border-gray-200 dark:border-midnight-badge space-y-3\">\n                    <div className=\"text-sm text-black flex items-center flex-wrap gap-x-4\">\n                        <span>{article.sourceName}</span>\n                        <span>&bull;</span>\n                        <span>发布于 {publishedDate}</span>\n                    </div>\n                    <div className=\"text-sm text-stone-600 flex items-center flex-wrap\">\n                        <span className=\"font-medium mr-2\">{article.verdict.type}</span>\n                        <span className=\"mr-2\">&bull;</span>\n                        <span className=\"font-medium mr-2\">{article.category}</span>\n                        <span className=\"mr-2\">&bull;</span>\n                        <span className={`font-semibold ${article.verdict.score >= 8 ? 'text-green-600' : article.verdict.score >= 6 ? 'text-amber-600' : 'text-red-600'}`}>\n                            评分: {article.verdict.score}/10\n                        </span>\n                    </div>\n                    {allKeywords && allKeywords.length > 0 && (\n                        <div className=\"flex flex-wrap gap-2 pt-1\">\n                            {allKeywords.map(tag => (\n                                <span key={tag} className={`text-xs font-semibold inline-block py-1 px-2.5 rounded-full ${getRandomColorClass(tag)}`}>\n                                    {tag}\n                                </span>\n                            ))}\n                        </div>\n                    )}\n                </div>\n            </header>\n\n            <div className=\"grid grid-cols-1 @min-[35rem]:grid-cols-2 gap-8 mt-6\">\n                <Callout title=\"一句话总结\" content={article.summary || ''} />\n                <Callout title=\"技术洞察\" content={article.highlights} />\n                <Callout title=\"值得注意\" content={article.critiques} />\n                <Callout title=\"市场观察\" content={article.marketTake} />\n            </div>\n            {showActions && <ActionButtons article={article} onReaderModeRequest={onReaderModeRequest} onStateChange={onStateChange} />}\n        </article>\n    );\n};\n\nexport default memo(ArticleCard);\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/ArticleDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":4,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onClose' is defined but never used.","line":41,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":72},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4849,4852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4849,4852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/ArticleDetail.tsx\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport { Article, CleanArticleContent, Tag } from '../types'; // 导入 Tag\nimport { getCleanArticleContent } from '../services/api';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\nimport { getRandomColorClass } from '../utils/colorUtils';\nimport ArticleTitleStar from '../app/components/ArticleTitleStar';\n\ninterface ArticleDetailProps {\n  article: Article;\n  onClose?: () => void;\n  initialContent?: CleanArticleContent | null;\n}\n\n\n\nimport { removeEmptyParagraphs } from '../utils/contentUtils';\n\nfunction stripLeadingTitle(contentHtml: string, title: string): string {\n  if (!contentHtml || !title) return contentHtml;\n  try {\n    const h1Match = contentHtml.match(/^\\s*<h1[^>]*>([\\s\\S]*?)<\\/h1>/i);\n    if (h1Match && h1Match[1]) {\n      const h1Text = h1Match[1].replace(/<[^>]+>/g, '').toLowerCase().trim();\n      const titleLower = title.toLowerCase().trim();\n      if (h1Text && (h1Text === titleLower || h1Text.includes(titleLower) || titleLower.includes(h1Text))) {\n        return contentHtml.replace(h1Match[0], '');\n      }\n    }\n    const textStart = contentHtml.replace(/^\\s+/, '');\n    if (textStart.toLowerCase().startsWith(title.toLowerCase().trim())) {\n      return contentHtml.replace(new RegExp('^\\\\s*' + title.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')), '');\n    }\n  } catch (e) {\n    console.error('stripLeadingTitle error', e);\n  }\n  return contentHtml;\n}\n\nconst ArticleDetail: React.FC<ArticleDetailProps> = ({ article, onClose, initialContent }) => {\n  const [isLoading, setIsLoading] = useState<boolean>(!initialContent);\n  const [content, setContent] = useState<CleanArticleContent | null>(initialContent || null);\n  const [error, setError] = useState<string | null>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = async () => {\n    if (!content || !contentRef.current) return;\n    try {\n      const text = contentRef.current.innerText;\n      const fullText = `${content.title || article.title}\\n\\n${text}`;\n      await navigator.clipboard.writeText(fullText);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy text:', err);\n    }\n  };\n\n  const isSentinel = article.link === 'about:blank' || String(article.id).startsWith('empty-');\n\n  // 【新增】调用辅助函数获取标签文本\n  const { userTagLabels } = useArticleMetadata(article);\n\n\n  useEffect(() => {\n    // 【增】添加键盘事件监听器\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if ((event.metaKey || event.ctrlKey) && event.key === 'a') {\n        if (contentRef.current) {\n          event.preventDefault();\n          const range = document.createRange();\n          range.selectNodeContents(contentRef.current);\n          const selection = window.getSelection();\n          if (selection) {\n            selection.removeAllRanges();\n            selection.addRange(range);\n          }\n        }\n      }\n    };\n    // 【增】组件挂载时添加监听，卸载时移除\n    document.addEventListener('keydown', handleKeyDown);\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, []); // 【查】空依赖数组确保只在挂载和卸载时运行\n\n\n  useEffect(() => {\n    let mounted = true;\n    const load = async () => {\n      if (isSentinel) {\n        if (!mounted) return;\n        setIsLoading(false);\n        setError(null);\n        setContent(null);\n        return;\n      }\n\n      // 【核心修改】如果由服务端（或父组件）传入了 initialContent，直接使用，不再 Fetch\n      // 注意：这里假设 initialContent 确实是当前 article 的内容。\n      // 在 ArticlePage (Server) -> ArticleDetailClient 流程中，这是保证的。\n      if (initialContent) {\n        if (!mounted) return;\n        setContent(initialContent);\n        setIsLoading(false);\n        setError(null);\n        return;\n      }\n\n      setIsLoading(true);\n      setError(null);\n      setContent(null);\n      try {\n        const url = article.link;\n        const data = await getCleanArticleContent({ ...article, link: url });\n        if (!mounted) return;\n\n        let contentHtml = (data && data.content) || '';\n        const hasUsefulContent = contentHtml && contentHtml.trim().length > 40;\n\n        if (!hasUsefulContent) {\n          if (article.summary && article.summary.trim().length > 0) {\n            contentHtml = article.summary;\n          } else {\n            contentHtml = `<p>无法从目标站点提取可读内容。您可以点击下面的链接查看原文：</p><p><a href=\"${article.link}\" target=\"_blank\" rel=\"noopener noreferrer\">打开原文</a></p>`;\n          }\n        }\n\n        const cleanedHtml = stripLeadingTitle(contentHtml, (data && data.title) || article.title || '');\n        const finalHtml = removeEmptyParagraphs(cleanedHtml);\n        setContent({ title: (data && data.title) || article.title, source: (data && data.source) || article.sourceName, content: finalHtml });\n      } catch (e: any) {\n        console.error('ArticleDetail fetch error', e);\n        if (mounted) setError(e.message || 'Failed to load article');\n      } finally {\n        if (mounted) setIsLoading(false);\n      }\n    };\n    load();\n    return () => { mounted = false; };\n  }, [article, isSentinel, initialContent]);\n\n  // Determine display data: prefer fetched content, fallback to prop article\n  const displayTitle = (content && content.title) || article.title;\n  const displaySource = (content && content.source) || article.sourceName;\n  const displayContent = (content && content.content);\n\n  return (\n    <div className=\"p-2 md:p-8\">\n      <article>\n        <header className=\"mb-3 border-b pb-3 md:mb-6 md:pb-6\">\n\n          <h1 className=\"text-3xl md:text-4xl font-bold font-serif text-gray-900 dark:text-midnight-text-reader mb-2\">\n            <ArticleTitleStar article={article} className=\"inline-block w-8 h-8 mr-2 relative top-[3px]\" />\n            <span className=\"align-middle\">{displayTitle}</span>\n          </h1>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">来源: {displaySource}</p>\n\n          {/* 【核心修改】在这里渲染标签 */}\n          {userTagLabels.length > 0 && (\n            <div className=\"mt-4 flex flex-wrap gap-2\">\n              {userTagLabels.map(label => (\n                <span key={label} className={`text-sm font-semibold inline-block py-1 px-3 rounded-full ${getRandomColorClass(label)}`}>\n                  #{label}\n                </span>\n              ))}\n            </div>\n          )}\n          <div className=\"mt-4 flex justify-end gap-3\">\n\n            <button\n              onClick={handleCopy}\n              className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 dark:hover:bg-stone-600 text-stone-800 dark:text-stone-200 transition-colors cursor-pointer\"\n              title=\"复制全文\"\n            >\n              {copied ? (\n                <>\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-green-600 dark:text-green-400 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                  </svg>\n                  <span className=\"text-green-600 dark:text-green-400 cursor-pointer\">已复制</span>\n                </>\n              ) : (\n                <>\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                    <path d=\"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z\" />\n                    <path d=\"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z\" />\n                  </svg>\n                  <span className=\"cursor-pointer\">复制</span>\n                </>\n              )}\n            </button>\n            <a\n              href={article.link}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 dark:hover:bg-stone-600 text-stone-800 dark:text-stone-200 transition-colors cursor-pointer\"\n              title=\"打开原文\"\n            >\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" />\n                <path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" />\n              </svg>\n              <span className=\"cursor-pointer\">原文</span>\n            </a>\n          </div>\n        </header>\n\n        {/* Body content section */}\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-80\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n          </div>\n        ) : error ? (\n          <div className=\"p-8 text-center text-red-600\">\n            <p>无法加载文章内容：{error}</p>\n          </div>\n        ) : displayContent ? (\n          <div id=\"article-detail-content\" ref={contentRef} className=\"prose md:prose-lg max-w-none break-words text-gray-800 dark:text-midnight-text-reader dark:prose-invert leading-relaxed mt-6 select-text\" dangerouslySetInnerHTML={{ __html: displayContent }} />\n        ) : (\n          <div className=\"text-gray-500 py-10\">\n            <p>正在获取全文内容...</p>\n            <p className=\"text-sm mt-2\">如果长时间未加载，请尝试点击上方“原文”按钮。</p>\n          </div>\n        )}\n      </article>\n    </div>\n  );\n};\n\nexport default ArticleDetail;","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/ArticleGroup.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":4,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/ArticleGroup.tsx\n\nimport React,{memo}from 'react';\nimport { Article, Tag } from '../types';\nimport ArticleCard from './ArticleCard';\n\nconst DecorativeDivider = () => (\n    <div className=\"flex items-center justify-center my-8\">\n        <span className=\"h-px w-20 bg-stone-500\"></span>\n        <span className=\"mx-4 text-stone-500 text-lg\">◆</span>\n        <span className=\"h-px w-20 bg-stone-500\"></span>\n    </div>\n);\n\ninterface ArticleGroupProps {\n    importance: string;\n    articles: Article[];\n    onReaderModeRequest: (article: Article) => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n}\n\nconst ArticleGroup: React.FC<ArticleGroupProps> = ({ importance, articles,onReaderModeRequest, onStateChange }) => {\n    if (!articles || articles.length === 0) {\n        return null;\n    }\n\n    const sectionId = `importance-${importance.replace(/\\s+/g, '-')}`;\n\n    return (\n        <section id={sectionId} className=\"mb-12\">\n<header className=\"sticky top-0 z-20 mb-4\"> \n<div className=\"backdrop-blur-sm px-4 py-3  border-b-2 border-transparent [border-image:linear-gradient(to_right,#c8b382,#b9975d,#e7d8ac)_1]\">\n    <h2 className=\"font-serif font-bold text-[1.35rem] leading-tight text-[#7a1e16]\"> \n    {importance} \n    </h2> \n    </div> \n</header>\n\n            <div className=\"flex flex-col\">\n                {articles.map((article, index) => (\n                    <React.Fragment key={article.id}>\n                        <div id={`article-${article.id}`}>\n                            <ArticleCard\n                                article={article}\n                                onReaderModeRequest={onReaderModeRequest}\n                                onStateChange={onStateChange}\n                            />\n                        </div>\n                        {index < articles.length - 1 && (\n                            <DecorativeDivider />\n                        )}\n                    </React.Fragment>\n                ))}\n            </div>\n        </section>\n    );\n};\n\nexport default memo(ArticleGroup);","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/ArticleListHeader.tsx","messages":[{"ruleId":"react/prop-types","severity":2,"message":"'title' is missing in props validation","line":18,"column":69,"nodeType":"Property","messageId":"missingPropType","endLine":18,"endColumn":74},{"ruleId":"react/prop-types","severity":2,"message":"'count' is missing in props validation","line":18,"column":76,"nodeType":"Property","messageId":"missingPropType","endLine":18,"endColumn":81},{"ruleId":"react/prop-types","severity":2,"message":"'description' is missing in props validation","line":18,"column":83,"nodeType":"Property","messageId":"missingPropType","endLine":18,"endColumn":94},{"ruleId":"react/prop-types","severity":2,"message":"'showCount' is missing in props validation","line":18,"column":96,"nodeType":"Property","messageId":"missingPropType","endLine":18,"endColumn":112},{"ruleId":"react/prop-types","severity":2,"message":"'title.split' is missing in props validation","line":22,"column":28,"nodeType":"Identifier","messageId":"missingPropType","endLine":22,"endColumn":33}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useMemo } from 'react';\n\nconst GRADIENTS = [\n    'from-rose-100 via-rose-200 to-orange-100 dark:from-rose-900/40 dark:via-fuchsia-900/40 dark:to-indigo-900/40',\n    'from-emerald-100 via-teal-200 to-cyan-100 dark:from-emerald-900/40 dark:via-teal-900/40 dark:to-cyan-900/40',\n    'from-amber-100 via-orange-200 to-yellow-100 dark:from-amber-900/40 dark:via-orange-900/40 dark:to-red-900/40',\n    'from-sky-100 via-indigo-200 to-blue-100 dark:from-sky-900/40 dark:via-indigo-900/40 dark:to-blue-900/40',\n    'from-fuchsia-100 via-purple-200 to-pink-100 dark:from-fuchsia-900/40 dark:via-purple-900/40 dark:to-pink-900/40'\n];\n\ninterface ArticleListHeaderProps {\n    title: string;\n    count: number;\n    description?: React.ReactNode;\n    showCount?: boolean;\n}\n\nconst ArticleListHeader: React.FC<ArticleListHeaderProps> = memo(({ title, count, description, showCount = true }) => {\n    // Generate deterministic gradient based on title char codes\n    const randomGradient = useMemo(() => {\n        if (!title) return GRADIENTS[0];\n        const hash = title.split('').reduce((acc, char) => char.charCodeAt(0) + ((acc << 5) - acc), 0);\n        return GRADIENTS[Math.abs(hash) % GRADIENTS.length];\n    }, [title]);\n\n    return (\n        <header className={`relative mb-8 overflow-hidden rounded-2xl bg-linear-to-br ${randomGradient} shadow-xs`}>\n            <div className=\"absolute inset-0 bg-[url('/paper-texture.png')] opacity-30 mix-blend-overlay pointer-events-none\"></div>\n            <div className=\"relative px-6 py-6 md:px-10 md:py-8\">\n                <h1 className=\"text-3xl md:text-4xl font-serif font-bold text-gray-900 dark:text-white tracking-tight drop-shadow-xs\">\n                    {title}\n                </h1>\n\n                {showCount && (\n                    <div className=\"mt-3 flex items-center gap-2 text-gray-700 dark:text-gray-200 font-medium opacity-80\">\n                        <span className=\"uppercase tracking-widest text-xs\">Collection</span>\n                        <span className=\"w-8 h-px bg-current opacity-50\"></span>\n                        <span className=\"text-sm\">{count} Articles</span>\n                    </div>\n                )}\n\n                {description && (\n                    <div className=\"mt-6 pt-4 border-t border-black/5 dark:border-white/10 text-sm\">\n                        <div className=\"flex flex-wrap items-baseline gap-x-2 gap-y-1\">\n                            <span className=\"font-bold text-gray-900 dark:text-white shrink-0\">Related:</span>\n                            <div className=\"text-gray-700 dark:text-gray-200 leading-relaxed font-medium opacity-90\">\n                                {description}\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </header>\n    );\n});\n\nArticleListHeader.displayName = 'ArticleListHeader';\n\nexport default ArticleListHeader;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/Briefing.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":4,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":4,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useUIStore' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"react/prop-types","severity":2,"message":"'report' is missing in props validation","line":20,"column":61,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":67},{"ruleId":"react/prop-types","severity":2,"message":"'onReaderModeRequest' is missing in props validation","line":20,"column":69,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":88},{"ruleId":"react/prop-types","severity":2,"message":"'onStateChange' is missing in props validation","line":20,"column":90,"nodeType":"Property","messageId":"missingPropType","endLine":20,"endColumn":103},{"ruleId":"react/prop-types","severity":2,"message":"'report.articles' is missing in props validation","line":39,"column":51,"nodeType":"Identifier","messageId":"missingPropType","endLine":39,"endColumn":59},{"ruleId":"react/prop-types","severity":2,"message":"'report.articles' is missing in props validation","line":67,"column":49,"nodeType":"Identifier","messageId":"missingPropType","endLine":67,"endColumn":57},{"ruleId":"react/prop-types","severity":2,"message":"'report.articles[].length' is missing in props validation","line":68,"column":51,"nodeType":"Identifier","messageId":"missingPropType","endLine":68,"endColumn":57},{"ruleId":"react/prop-types","severity":2,"message":"'report.articles[].map' is missing in props validation","line":81,"column":43,"nodeType":"Identifier","messageId":"missingPropType","endLine":81,"endColumn":46},{"ruleId":"react/prop-types","severity":2,"message":"'report.articles' is missing in props validation","line":111,"column":42,"nodeType":"Identifier","messageId":"missingPropType","endLine":111,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onReportSelect' is defined but never used.","line":146,"column":92,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":106},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSidebarCollapsed' is defined but never used.","line":146,"column":162,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":180},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onToggleSidebar' is defined but never used.","line":146,"column":182,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":197},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'articleCount' is defined but never used.","line":146,"column":199,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":211},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedReport' is assigned a value but never used.","line":164,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":164,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'randomGradient' is assigned a value but never used.","line":166,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":25}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/Briefing.tsx\n\nimport React, { useMemo, memo } from 'react';\nimport { Article, BriefingReport, Tag, Filter, GroupedArticles } from '../types';\nimport ArticleGroup from './ArticleGroup';\nimport { useArticleStore } from '../store/articleStore';\nimport { useUIStore } from '../store/uiStore';\nimport LoadingSpinner from './LoadingSpinner';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { getRandomGradient } from '../utils/colorUtils';\nimport { TimeSlot } from '../types';\n\ninterface ReportContentProps {\n    report: BriefingReport;\n    onReaderModeRequest: (article: Article) => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n}\n\nconst ReportContent: React.FC<ReportContentProps> = memo(({ report, onReaderModeRequest, onStateChange }) => {\n    const importanceOrder = ['重要新闻', '必知要闻', '常规更新'];\n\n    const handleJump = (e: React.MouseEvent<HTMLAnchorElement>, targetId: string) => {\n        e.preventDefault();\n        const element = document.getElementById(targetId);\n        if (element) {\n            // Buffer for sticky headers (Importance Header + potentially Navbar)\n            const headerOffset = 50;\n            const elementPosition = element.getBoundingClientRect().top;\n            const offsetPosition = elementPosition + window.scrollY - headerOffset;\n\n            window.scrollTo({\n                top: offsetPosition,\n                behavior: 'smooth'\n            });\n        }\n    };\n\n    const allArticlesCount = Object.values(report.articles).reduce((acc, articles) => acc + articles.length, 0);\n\n    if (allArticlesCount === 0) {\n        return (\n            <div className=\"text-center py-20\">\n                <p className=\"text-2xl font-semibold text-stone-600\">此时间段内暂无文章。</p>\n            </div>\n        );\n    }\n\n    return (\n        <div>\n            {/* Table of Contents & Summary Section */}\n            <div className=\"bg-white dark:bg-gray-900 p-6 rounded-3xl border border-stone-200 dark:border-white/10 shadow-lg shadow-stone-200/50 dark:shadow-none mb-10 transition-all hover:shadow-xl hover:shadow-stone-200/60 duration-500\">\n                <div className=\"md:hidden\">\n                    <h2 className=\"text-2xl font-bold font-serif text-stone-800 dark:text-white flex items-center\">\n                        <span>📚 目录</span>\n                        <span className=\"text-stone-400 mx-2 font-light\">/</span>\n                        <span>📝 摘要</span>\n                    </h2>\n                </div>\n                <div className=\"hidden md:grid grid-cols-2 gap-x-6\">\n                    <h2 className=\"text-2xl font-bold font-serif text-stone-800 dark:text-white\">📚 目录</h2>\n                    <h2 className=\"text-2xl font-bold font-serif text-stone-800 dark:text-white\">📝 摘要</h2>\n                </div>\n\n                <div className=\"mt-3\">\n                    {importanceOrder.map(importance => {\n                        const articles = report.articles[importance];\n                        if (!articles || articles.length === 0) return null;\n                        const sectionId = `importance-${importance.replace(/\\s+/g, '-')}`;\n                        return (\n                            <div key={importance}>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 border-b border-stone-200 dark:border-white/10 my-0 pb-0.5\">\n                                    <div className=\"py-0.5\">\n                                        <a href={`#${sectionId}`} onClick={(e) => handleJump(e, sectionId)} className=\"font-semibold text-base text-rose-800 dark:text-rose-400 hover:underline\">\n                                            <span className=\"mr-2\"></span>\n                                            {importance}\n                                        </a>\n                                    </div>\n                                    <div className=\"hidden md:block py-2\"></div>\n                                </div>\n                                {articles.map(article => (\n                                    <div key={article.id}>\n                                        <div className=\"md:hidden py-3\">\n                                            <a href={`#article-${article.id}`} onClick={(e) => handleJump(e, `article-${article.id}`)} className=\"text-sky-600 dark:text-blue-400 hover:text-blue-300 dark:hover:text-sky-200 font-medium leading-tight\">\n                                                {article.title}\n                                            </a>\n                                            <p className=\"mt-2 text-base text-stone-600 dark:text-gray-50 leading-tight\">{article.tldr}</p>\n                                        </div>\n                                        <div className=\"hidden md:grid grid-cols-2 gap-x-6\">\n                                            <div className=\"py-2 flex items-start\">\n                                                <a href={`#article-${article.id}`} onClick={(e) => handleJump(e, `article-${article.id}`)} className=\"text-sky-600 dark:text-blue-400 hover:text-blue-300 dark:hover:text-sky-200 hover:underline font-medium leading-tight decoration-sky-300 decoration-2\">\n                                                    {article.title}\n                                                </a>\n                                            </div>\n                                            <div className=\"py-2 text-base text-stone-600 dark:text-gray-50 leading-tight flex items-start\">{article.tldr}</div>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        );\n                    })}\n                </div>\n            </div>\n\n            {/* Articles Section - Now uses ArticleGroup */}\n            <div className=\"\">\n                {importanceOrder.map(importance => (\n                    <ArticleGroup\n                        key={importance}\n                        importance={importance}\n                        articles={report.articles[importance]}\n                        onReaderModeRequest={onReaderModeRequest}\n                        onStateChange={onStateChange}\n                    />\n                ))}\n            </div>\n        </div>\n    );\n});\nReportContent.displayName = 'ReportContent';\n\n\n\ninterface BriefingProps {\n    articleIds: (string | number)[];\n    date: string; // 【新增】接收日期\n    timeSlot: TimeSlot | null;\n    selectedReportId: number | null;\n    onReportSelect: (id: number) => void;\n    onReaderModeRequest: (article: Article) => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n    onTimeSlotChange: (slot: TimeSlot | null) => void;\n    isSidebarCollapsed: boolean;\n    onToggleSidebar: () => void;\n    articleCount: number;\n    isLoading?: boolean;\n\n    headerImageUrl?: string; // 【新增】接收预解析的图片 URL\n    articles?: Article[]; // 【新增】用于 SSR/Hydration 的初始文章数据\n    isToday: boolean;\n    prevDate?: string | null;\n    nextDate?: string | null;\n    disableAutoTimeSlot?: boolean; // New prop to control auto-selection behavior\n}\n\nconst Briefing: React.FC<BriefingProps> = ({ articleIds, date, timeSlot, selectedReportId, onReportSelect, onReaderModeRequest, onStateChange, onTimeSlotChange, isSidebarCollapsed, onToggleSidebar, articleCount, isLoading, headerImageUrl, articles, isToday, prevDate, nextDate, disableAutoTimeSlot = false }) => {\n    // 1. 【新增】内部订阅文章数据\n    const articlesById = useArticleStore(state => state.articlesById);\n    // const activeFilter = useUIStore(state => state.activeFilter); // No longer needed for date logic\n\n    // 2. 【新增】内部生成 reports\n    const reports: BriefingReport[] = useMemo(() => {\n        if (!articleIds || articleIds.length === 0) return [];\n        const articlesForReport = articleIds.map(id => articlesById[id] || articles?.find(a => a.id === id)).filter(Boolean) as Article[];\n        const groupedArticles = articlesForReport.reduce((acc, article) => {\n            const group = article.briefingSection || '常规更新';\n            if (!acc[group]) acc[group] = [];\n            acc[group].push(article);\n            return acc;\n        }, {} as GroupedArticles);\n        return [{ id: 1, title: \"Daily Briefing\", articles: groupedArticles }];\n    }, [articleIds, articlesById, articles]);\n\n    const selectedReport = reports.find(r => r.id === selectedReportId);\n\n    const randomGradient = useMemo(() => {\n        // Use the date string as the key\n        return getRandomGradient(date);\n    }, [date]);\n\n    // Strategy: Initialize with Shanghai time (likely match) to prevent specific \"Flash\" for main users.\n    // Then use useEffect to update to local time for global users.\n    const getShanghaiHour = () => {\n        const dateString = new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai', hour12: false });\n        const hourString = dateString.split(', ')[1].split(':')[0];\n        return parseInt(hourString, 10);\n    };\n\n    // Initialize state with Shanghai hour to match Server SSR\n    const [currentHour, setCurrentHour] = React.useState<number | null>(getShanghaiHour());\n\n    React.useEffect(() => {\n        // After mount, check local time\n        const localHour = new Date().getHours();\n        // Only update (trigger re-render) if local time differs from Shanghai assumption\n        if (localHour !== currentHour) {\n            setCurrentHour(localHour);\n        }\n    }, []);\n\n    const getGreeting = () => {\n        const hour = currentHour ?? getShanghaiHour();\n        if (hour >= 23 || hour < 3) return '深夜好';\n        if (hour >= 3 && hour < 5) return '凌晨好';\n        if (hour >= 5 && hour < 9) return '早上好';\n        if (hour >= 9 && hour < 11) return '上午好';\n        if (hour >= 11 && hour < 14) return '中午好';\n        if (hour >= 14 && hour < 17) return '下午好';\n        if (hour >= 17 && hour < 19) return '傍晚好';\n        return '晚上好';\n    };\n\n    const renderHeader = () => {\n        if (date) {\n            const dateObj = new Date(date + 'T00:00:00');\n            const datePart = dateObj.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });\n            const weekdayPart = dateObj.toLocaleDateString('zh-CN', { weekday: 'long' });\n\n            // Use the date string as a seed for the random image to ensure it stays the same for that date\n            const seed = date;\n            const bgImage = headerImageUrl || `https://picsum.photos/seed/${seed}/1600/1200`;\n\n            const getCurrentTimeSlot = (): TimeSlot => {\n                const hour = currentHour ?? getShanghaiHour();\n                if (hour >= 0 && hour < 12) return 'morning';\n                if (hour >= 12 && hour < 19) return 'afternoon';\n                return 'evening';\n            };\n\n            // Auto-select slot if today. Since we align to Shanghai time, this is consistent during SSR.\n            // We verify isToday first (which relies on props, usually calculated via Shanghai time globally).\n            // disableAutoTimeSlot allows Archive Pages to force \"Show All\" without auto-selecting.\n            const autoSelectedSlot = (isToday && !disableAutoTimeSlot) ? getCurrentTimeSlot() : null;\n\n            return (\n                <header className=\"relative mb-8 overflow-hidden rounded-2xl shadow-md transition-all duration-500 hover:shadow-xl group\">\n                    {/* Background Image with Overlay */}\n                    <div className=\"absolute inset-0 z-0\">\n                        <Image\n                            src={bgImage}\n                            alt=\"Daily Background\"\n                            fill\n                            priority\n                            unoptimized={process.env.NODE_ENV === 'development'}\n                            sizes=\"(max-width: 768px) 100vw, (max-width: 1536px) 80vw, 1152px\"\n                            className=\"object-cover transition-transform duration-700 group-hover:scale-105 will-change-transform backface-hidden\"\n                        />\n                        {/* Dark Gradient Overlay for Text Readability */}\n                        <div className=\"absolute inset-0 bg-linear-to-t from-black/90 via-black/40 to-black/20\"></div>\n                    </div>\n\n                    <div className=\"relative z-10 px-6 py-8 md:px-8 md:py-11 flex flex-col gap-4 md:gap-8\">\n                        {/* Top Row: Date & Time Slot Selector */}\n                        <div className=\"flex flex-col md:flex-row md:justify-between md:items-start gap-6\">\n                            {/* Left: Date - Structured Layout (White Text) */}\n                            <div className=\"flex flex-col gap-2 text-white\">\n                                <h1 className=\"sr-only\">{date} 每日AI全栈架构技术简报</h1>\n                                <div aria-hidden=\"true\" className=\"text-5xl md:text-6xl font-serif font-medium tracking-tight leading-none drop-shadow-md mb-2 text-balance\">\n                                    {isToday ? '今天' : datePart}\n                                </div>\n                                <div className=\"flex items-center gap-2 text-sm md:text-base text-white/95 drop-shadow-xs bg-white/20 px-4 py-1.5 rounded-full self-start\">\n                                    {isToday && (\n                                        <>\n                                            <span>{datePart}</span>\n                                            <span className=\"size-1 rounded-full bg-white/60\"></span>\n                                        </>\n                                    )}\n                                    <span>{weekdayPart}</span>\n                                </div>\n                            </div>\n\n                            {/* Right: Time Slot Selector - More Visible */}\n                            {/* Right: Time Slot Selector */}\n                            {date && (\n                                <div className=\"flex items-center gap-3 self-start\">\n                                    {(['morning', 'afternoon', 'evening'] as const).map(slotOption => {\n                                        const labelMap: Record<TimeSlot, string> = { morning: '早', afternoon: '中', evening: '晚' };\n                                        const titleMap: Record<TimeSlot, string> = { morning: '早上', afternoon: '中午', evening: '晚上' };\n\n                                        // Toggle logic: Use manual timeSlot if available, otherwise fallback to autoSelectedSlot\n                                        const isSelected = timeSlot === slotOption || (timeSlot === null && autoSelectedSlot === slotOption);\n                                        return (\n                                            <button\n                                                key={slotOption}\n                                                onClick={() => onTimeSlotChange(isSelected ? null : slotOption)}\n                                                className={`\n                                                    size-10 rounded-full flex items-center justify-center text-sm font-serif transition-all duration-300 border border-white/20\n                                                    ${isSelected\n                                                        ? 'bg-white text-black shadow-[0_0_15px_rgba(255,255,255,0.5)] scale-110 border-white dark:bg-amber-100 dark:text-amber-900 dark:shadow-[0_0_15px_rgba(251,191,36,0.6)] dark:border-amber-100'\n                                                        : 'bg-black/20 text-white/90 hover:bg-white/20 hover:border-white/40 backdrop-blur-md'\n                                                    } cursor-pointer\n                                                `}\n                                                title={titleMap[slotOption]}\n                                            >\n                                                {labelMap[slotOption]}\n                                            </button>\n                                        );\n                                    })}\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Bottom Row: Greeting & Count - Unified (White Text) with Separator */}\n                        <div className=\"pt-2 md:pt-4 border-t border-white/20\">\n                            <p className=\"text-base md:text-lg text-white/95 leading-relaxed font-serif drop-shadow-xs\">\n                                {isToday ? (\n                                    <span>{getGreeting()}，欢迎阅读今日简报</span>\n                                ) : (\n                                    <span>欢迎阅读本期简报</span>\n                                )}\n                                {reports.length > 0 && (\n                                    <span>\n                                        ，共 <span className=\"font-variant-numeric tabular-nums\">{reports.reduce((acc, r) => acc + Object.values(r.articles).flat().length, 0)}</span> 篇文章。\n                                    </span>\n                                )}\n                            </p>\n                        </div>\n                    </div>\n                </header>\n            );\n        }\n        return null;\n    };\n\n    return (\n        <main className=\"flex-1 px-2 pt-0 md:px-8 md:pt-0 md:pb-10 lg:px-10 lg:pt-2\">\n            <div className=\"max-w-6xl mx-auto\">\n                {renderHeader()}\n\n                {isLoading ? (\n                    <div className=\"py-20 h-64\">\n                        <LoadingSpinner />\n                    </div>\n                ) : reports.length > 0 ? (\n                    <div className=\"space-y-10\">\n                        {reports.map(report => (\n                            <ReportContent\n                                key={report.id}\n                                report={report}\n                                onReaderModeRequest={onReaderModeRequest}\n                                onStateChange={onStateChange}\n                            />\n                        ))}\n                    </div>\n                ) : (\n                    <div className=\"text-center py-20\">\n                        <p className=\"text-2xl font-semibold text-stone-600\">\n                            {isToday\n                                ? '暂无简报，请稍后查看。'\n                                : '该日期下没有简报。'\n                            }\n                        </p>\n                    </div>\n                )}\n\n                {/* Internal Linking Navigation (SEO & UX) */}\n                <div className=\"mt-16 pt-8 border-t border-stone-200 dark:border-white/10 flex justify-between items-center font-serif\">\n                    {prevDate ? (\n                        <Link href={`/date/${prevDate}`} className=\"group flex items-center transition-colors\">\n                            <span className=\"mr-3 text-lg text-black transform transition-transform group-hover:-translate-x-1 group-hover:text-indigo-600\">←</span>\n                            <div>\n                                <span className=\"block text-sm font-bold uppercase tracking-wider opacity-100 text-black mb-0.5\">上一篇</span>\n                                <span className=\"text-xl font-extrabold text-black group-hover:text-indigo-600 transition-colors\">{prevDate}</span>\n                            </div>\n                        </Link>\n                    ) : (\n                        <div></div> // Spacer\n                    )}\n\n                    {nextDate ? (\n                        <Link href={`/date/${nextDate}`} className=\"group flex items-center text-right transition-colors\">\n                            <div>\n                                <span className=\"block text-sm font-bold uppercase tracking-wider opacity-100 text-black mb-0.5\">下一篇</span>\n                                <span className=\"text-xl font-extrabold text-black group-hover:text-indigo-600 transition-colors\">{nextDate}</span>\n                            </div>\n                            <span className=\"ml-3 text-lg text-black transform transition-transform group-hover:translate-x-1 group-hover:text-indigo-600\">→</span>\n                        </Link>\n                    ) : (\n                        <div></div> // Spacer\n                    )}\n                </div>\n            </div>\n        </main>\n    );\n};\n\nexport default memo(Briefing);","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/FloatingActionButtons.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Article' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":4,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useUIStore' is defined but never used.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":20}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/FloatingActionButtons.tsx\n\nimport React, { useState } from 'react';\nimport { Article, Tag } from '../types';\nimport TagPopover from './TagPopover';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\nimport { useArticleStore } from '../store/articleStore';\nimport { READ_TAG, STAR_TAG } from '../constants';\n\ninterface FloatingActionButtonsProps {\n    selectedArticleId: string | number | null; // 【修改】接收 ID\n    articleIdsInView: (string | number)[]; // 【新增】接收当前视图中的所有文章 ID\n    isBriefingFetching: boolean;\n    isUpdatingArticle: boolean;\n    isMarkingAsRead: boolean;\n    // hasUnreadInView: boolean; // 【移除】内部计算\n    onArticleStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<void>;\n    onMarkAllClick: () => void;\n    onRefreshToHome: () => void;\n    isAdmin: boolean;\n}\n\nimport { useUIStore } from '../store/uiStore';\n\n// ... (imports remain the same)\n\nconst FloatingActionButtons: React.FC<FloatingActionButtonsProps> = ({\n    selectedArticleId,\n    articleIdsInView,\n    isBriefingFetching,\n    isUpdatingArticle,\n    isMarkingAsRead,\n    onArticleStateChange,\n    onMarkAllClick,\n    onRefreshToHome,\n    isAdmin,\n}) => {\n    const [isTagPopoverOpen, setIsTagPopoverOpen] = useState(false);\n    // const isAdmin = useUIStore(state => state.isAdmin); // Removed in favor of prop\n\n    // 1. 【新增】内部订阅：获取选中的文章对象\n    const selectedArticle = useArticleStore(state =>\n        selectedArticleId ? state.articlesById[selectedArticleId] : null\n    );\n\n    // 2. 【新增】内部订阅：计算是否有未读文章\n    const hasUnreadInView = useArticleStore(state => {\n        return articleIdsInView.some(id => {\n            const article = state.articlesById[id];\n            return article && !article.tags?.includes(READ_TAG);\n        });\n    });\n\n    const { isStarred } = useArticleMetadata(selectedArticle);\n\n    // 【改】使用单一 return 语句，结构更清晰\n    return (\n        <div className=\"fixed bottom-8 right-8 z-20 flex flex-col-reverse items-center gap-y-3\">\n            {/* --- 共享按钮：始终显示 --- */}\n            <button\n                onClick={onRefreshToHome}\n                disabled={isBriefingFetching}\n                className=\"p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-950 transition-all cursor-pointer\"\n                aria-label=\"Back to today's briefing\"\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z\" />\n                    <polyline points=\"9 22 9 12 15 12 15 22\"></polyline>\n                </svg>\n            </button>\n\n            {/* --- 条件渲染块：根据是否有选中文章来显示不同的按钮 --- */}\n            {isAdmin && (\n                selectedArticle ? (\n                    <>\n                        {/* 仅在有选中文章时显示：标签和收藏按钮 */}\n                        <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                            <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className=\"p-3 bg-sky-600 text-white rounded-full shadow-lg hover:bg-sky-700 transition-all cursor-pointer\" aria-label=\"Tag article\">\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                            </button>\n                            {isTagPopoverOpen && (\n                                <TagPopover\n                                    article={selectedArticle}\n                                    onClose={() => setIsTagPopoverOpen(false)}\n                                    onStateChange={onArticleStateChange}\n                                />\n                            )}\n                        </div>\n                        <button\n                            onClick={() => {\n                                onArticleStateChange(selectedArticle.id, isStarred ? [] : [STAR_TAG], isStarred ? [STAR_TAG] : []);\n                            }}\n                            disabled={isUpdatingArticle}\n                            className={`p-3 text-white rounded-full shadow-lg transition-all disabled:bg-gray-500 cursor-pointer ${isStarred ? 'bg-amber-500 hover:bg-amber-600' : 'bg-gray-800 hover:bg-gray-950'\n                                }`}\n                            aria-label={isStarred ? 'Remove from favorites' : 'Add to favorites'}\n                        >\n                            {isStarred ? (\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" /></svg>\n                            ) : (\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" /></svg>\n                            )}\n                        </button>\n                    </>\n                ) : (\n                    <>\n                        {/* 仅在没有选中文章时显示：全部标记已读按钮 */}\n                        <button\n                            onClick={onMarkAllClick}\n                            disabled={isMarkingAsRead || !hasUnreadInView}\n                            className={`p-3 text-white rounded-full shadow-lg transition-all disabled:bg-gray-500 disabled:cursor-not-allowed bg-gray-800 hover:bg-gray-950 cursor-pointer`}\n                            aria-label=\"Mark all as read\"\n                        >\n                            {isMarkingAsRead ? (\n                                <svg className=\"animate-spin h-6 w-6 cursor-pointer\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle><path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>\n                            ) : (\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>\n                            )}\n                        </button>\n                    </>\n                )\n            )}\n\n            {/* --- 共享按钮：始终显示 --- */}\n            <button onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className=\"p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-950 transition-all cursor-pointer\" aria-label=\"Back to top\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 cursor-pointer\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 11l7-7 7 7M12 19V4\" />\n                </svg>\n            </button>\n        </div>\n    );\n};\n\nexport default FloatingActionButtons;","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/ReaderView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/SearchList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Filter' is defined but never used.","line":2,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useMemo } from 'react';\nimport { Article, Filter } from '../types';\nimport { useUIStore } from '../store/uiStore';\nimport { useArticleStore } from '../store/articleStore';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\nimport ArticleTitleStar from '../app/components/ArticleTitleStar';\nimport { getRandomColorClass } from '../utils/colorUtils';\n\ninterface ArticleListProps {\n  articleIds: (string | number)[];\n  onOpenArticle?: (article: Article) => void;\n  isLoading: boolean;\n  fetchNextPage?: () => void;\n  hasNextPage?: boolean;\n  isFetchingNextPage?: boolean;\n}\n\n// Internal customized card for SearchList only\nconst SearchListItem: React.FC<{ articleId: string | number }> = ({ articleId }) => {\n  const openModal = useUIStore(state => state.openModal);\n  const article = useArticleStore(state => state.articlesById[articleId]);\n\n  if (!article) return null;\n\n  const { userTagLabels } = useArticleMetadata(article);\n\n  return (\n    <div\n      onClick={() => openModal(article.id)}\n      className=\"group relative flex flex-col md:flex-row gap-6 p-6 rounded-2xl bg-white dark:bg-midnight-card ring-1 ring-stone-200 dark:ring-white/10 hover:ring-2 hover:ring-black dark:hover:ring-white transition-all cursor-pointer shadow-sm hover:shadow-xl\"\n    >\n      <div className=\"flex-1 min-w-0 flex flex-col justify-between\">\n        <div>\n          <h3 className=\"text-xl font-medium text-stone-900 dark:text-white mb-2 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\">\n            <ArticleTitleStar article={article} className=\"size-5 inline-block mr-2 -mt-1 text-amber-400\" />\n            {article.title}\n          </h3>\n\n          <div className=\"flex items-center gap-3 text-xs font-bold uppercase tracking-wider text-stone-500 mb-4\">\n            <span className=\"text-stone-700 dark:text-stone-300\">{article.sourceName}</span>\n            <span className=\"size-1 rounded-full bg-stone-300\"></span>\n            <span>{new Date(article.published).toLocaleDateString('zh-CN')}</span>\n          </div>\n\n          {userTagLabels.length > 0 && (\n            <div className=\"flex flex-wrap gap-2\">\n              {userTagLabels.map(tag => (\n                <span key={tag} className={`text-xs font-semibold px-2.5 py-1 rounded-full ${getRandomColorClass(tag)}`}>\n                  {tag}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Right Side: Summary (Vertical Centered) */}\n      <div className=\"md:w-1/3 shrink-0 flex flex-col justify-center border-t md:border-t-0 md:border-l border-stone-300 dark:border-white/20 pt-4 md:pt-0 md:pl-6\">\n        <p className=\"text-sm font-medium text-stone-600 dark:text-stone-400 leading-relaxed line-clamp-4 opacity-80 group-hover:opacity-100 transition-opacity\">\n          {article.tldr || article.summary}\n        </p>\n        <div className=\"mt-4 flex justify-end\">\n          <svg className=\"size-5 text-stone-300 group-hover:text-black dark:group-hover:text-white transition-colors\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}>\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M17 8l4 4m0 0l-4 4m4-4H3\" />\n          </svg>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst SearchList: React.FC<ArticleListProps> = ({\n  articleIds,\n  isLoading,\n  fetchNextPage,\n  hasNextPage,\n  isFetchingNextPage\n}) => {\n  const activeFilter = useUIStore((state) => state.activeFilter);\n\n  const filterLabel = useMemo(() => {\n    if (!activeFilter) return '搜索结果';\n    if (activeFilter.type === 'search') return `\"${decodeURIComponent(activeFilter.value)}\"`;\n    const parts = activeFilter.value.split('/');\n    return decodeURIComponent(parts[parts.length - 1]);\n  }, [activeFilter]);\n\n  if (isLoading) return <div className=\"py-20 text-center\">Loading...</div>;\n\n  if (articleIds.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-stone-400\">\n        <div className=\"text-6xl mb-4 grayscale\">📂</div>\n        <p className=\"font-serif text-xl\">No articles found.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-12 md:px-8\">\n      {/* Editorial Header */}\n      <div className=\"mb-16\">\n        <h2 className=\"text-5xl md:text-7xl font-serif font-black text-stone-900 dark:text-white mb-4 tracking-tight\">\n          {filterLabel}\n        </h2>\n        <div className=\"h-2 w-24 bg-blue-600 dark:bg-blue-400 mb-6\"></div>\n        <p className=\"text-stone-500 font-medium uppercase tracking-widest text-sm\">\n          Found {articleIds.length} Articles\n        </p>\n      </div>\n\n      <div className=\"space-y-8\">\n        {articleIds.map((id) => (\n          <SearchListItem key={id} articleId={id} />\n        ))}\n      </div>\n\n      {hasNextPage && (\n        <div className=\"mt-20 text-center\">\n          <button\n            onClick={() => fetchNextPage?.()}\n            disabled={isFetchingNextPage}\n            className=\"inline-flex items-center gap-3 px-8 py-4 bg-stone-100 dark:bg-stone-800 rounded-full font-bold hover:bg-stone-200 dark:hover:bg-stone-700 transition-colors disabled:opacity-50\"\n          >\n            {isFetchingNextPage ? 'Loading...' : 'View More Archives'}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(SearchList);\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/Sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useArticleStore' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25},{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":34,"column":17,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":212,"endColumn":3},{"ruleId":"react/prop-types","severity":2,"message":"'isInitialLoading' is missing in props validation","line":35,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":35,"endColumn":21},{"ruleId":"react/prop-types","severity":2,"message":"'isRefreshingFilters' is missing in props validation","line":36,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":36,"endColumn":24},{"ruleId":"react/prop-types","severity":2,"message":"'availableMonths' is missing in props validation","line":37,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":37,"endColumn":20},{"ruleId":"react/prop-types","severity":2,"message":"'selectedMonth' is missing in props validation","line":38,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":38,"endColumn":18},{"ruleId":"react/prop-types","severity":2,"message":"'onMonthChange' is missing in props validation","line":39,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":39,"endColumn":18},{"ruleId":"react/prop-types","severity":2,"message":"'onRefresh' is missing in props validation","line":40,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":40,"endColumn":14},{"ruleId":"react/prop-types","severity":2,"message":"'datesForMonth' is missing in props validation","line":41,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":41,"endColumn":18},{"ruleId":"react/prop-types","severity":2,"message":"'dailyStatuses' is missing in props validation","line":42,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":42,"endColumn":18},{"ruleId":"react/prop-types","severity":2,"message":"'onToggleDailyStatus' is missing in props validation","line":43,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":43,"endColumn":24},{"ruleId":"react/prop-types","severity":2,"message":"'onOpenArticle' is missing in props validation","line":44,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":44,"endColumn":18},{"ruleId":"react/prop-types","severity":2,"message":"'initialStarredHeaders' is missing in props validation","line":45,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":45,"endColumn":26},{"ruleId":"react/prop-types","severity":2,"message":"'availableFilters' is missing in props validation","line":46,"column":5,"nodeType":"Property","messageId":"missingPropType","endLine":46,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isSettingsOpen' is assigned a value but never used.","line":110,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":110,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsSettingsOpen' is assigned a value but never used.","line":110,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":110,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'theme' is assigned a value but never used.","line":111,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":111,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setTheme' is assigned a value but never used.","line":112,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fontSize' is assigned a value but never used.","line":113,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setFontSize' is assigned a value but never used.","line":114,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'lineHeight' is assigned a value but never used.","line":115,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setLineHeight' is assigned a value but never used.","line":116,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":24}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/Sidebar.tsx\n\nimport React, { memo, useState } from 'react';\nimport Image from 'next/image';\nimport { useRouter } from 'next/navigation';\nimport { Article, Filter, AvailableFilters } from '../types';\nimport { useSidebar } from '../hooks/useSidebar';\nimport { useArticleStore } from '../store/articleStore';\nimport { useUIStore } from '../store/uiStore';\n\n// Import extracted components\nimport SidebarSearch from './sidebar/SidebarSearch';\nimport SidebarTrends from './sidebar/SidebarTrends';\nimport SidebarBriefing from './sidebar/SidebarBriefing';\nimport SidebarStarred from './sidebar/SidebarStarred';\nimport SidebarExplore from './sidebar/SidebarExplore';\nimport { Fireflies } from './sidebar/Fireflies';\n\ninterface SidebarProps {\n    isInitialLoading: boolean;\n    isRefreshingFilters: boolean;\n    availableMonths: string[];\n    selectedMonth: string;\n    onMonthChange: (month: string) => void;\n    onOpenArticle?: (article: Article) => void;\n    onRefresh?: () => Promise<void>;\n    datesForMonth: string[];\n    dailyStatuses: Record<string, boolean>;\n    onToggleDailyStatus: (date: string, currentStatus: boolean) => void;\n    initialStarredHeaders?: { id: string | number; title: string; tags: string[] }[];\n    availableFilters: AvailableFilters; // Add prop\n}\n\nconst Sidebar = React.memo<SidebarProps>(({\n    isInitialLoading,\n    isRefreshingFilters,\n    availableMonths,\n    selectedMonth,\n    onMonthChange,\n    onRefresh,\n    datesForMonth,\n    dailyStatuses,\n    onToggleDailyStatus,\n    onOpenArticle,\n    initialStarredHeaders,\n    availableFilters // Destructure\n}) => {\n    const router = useRouter();\n    const activeFilter = useUIStore(state => state.activeFilter);\n    // Removed internal store subscription\n    const setActiveFilter = useUIStore(state => state.setActiveFilter);\n    const [searchQuery, setSearchQuery] = useState('');\n    const selectedArticleId = useUIStore(state => state.selectedArticleId);\n    const setSelectedArticleId = useUIStore(state => state.setSelectedArticleId);\n\n    const {\n        activeTab,\n        setActiveTab,\n        starredExpanded,\n        toggleStarred,\n        starredArticles,\n        isLoadingStarred,\n        refreshStarred,\n        starredCount,\n    } = useSidebar({ initialStarredHeaders }); // Pass to hook\n\n    const handleSearchSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        const trimmedQuery = searchQuery.trim();\n        if (trimmedQuery) {\n            setActiveFilter({ type: 'search', value: trimmedQuery });\n            setSelectedArticleId(null);\n            router.push('/');\n        }\n    };\n\n    const isLoading = isInitialLoading || isRefreshingFilters || isLoadingStarred;\n\n    const handleRefreshClick = async () => {\n        const refreshFiltersPromise = onRefresh ? onRefresh() : Promise.resolve();\n        const refreshStarredPromise = refreshStarred();\n        await Promise.all([refreshFiltersPromise, refreshStarredPromise]);\n    };\n\n    const handleFilterSelect = (filter: Filter) => {\n        setActiveFilter(filter);\n        setSelectedArticleId(null);\n\n        if (filter.type === 'category' || filter.type === 'tag') {\n            router.push(`/?filter=${filter.type}&value=${encodeURIComponent(filter.value)}`);\n        } else if (filter.type === 'search') {\n            router.push(`/?filter=search&value=${encodeURIComponent(filter.value)}`);\n        } else if (filter.type === 'date') {\n            router.push(`/date/${filter.value}`);\n        } else if (filter.type === 'trends') {\n            router.push('/trends');\n        } else {\n            router.push('/');\n        }\n    };\n\n    const handleDateSelect = (date: string) => {\n        setActiveFilter({ type: 'date', value: date });\n        setSelectedArticleId(null);\n        router.push(`/date/${date}`);\n    };\n\n    const tabButtonClass = (isActive: boolean) => `flex-1 text-sm font-medium transition-all duration-200 focus:outline-hidden rounded-md py-2.5 ${isActive ? 'bg-white shadow-xs text-gray-900 dark:bg-midnight-selected dark:text-white' : 'text-gray-500 hover:text-gray-700 dark:text-white/70 dark:hover:text-white'} cursor-pointer`;\n\n    const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n    const theme = useUIStore(state => state.theme);\n    const setTheme = useUIStore(state => state.setTheme);\n    const fontSize = useUIStore(state => state.fontSize);\n    const setFontSize = useUIStore(state => state.setFontSize);\n    const lineHeight = useUIStore(state => state.lineHeight);\n    const setLineHeight = useUIStore(state => state.setLineHeight);\n\n    return (\n        <aside className=\"flex flex-col shrink-0 bg-gray-50 dark:bg-midnight-sidebar w-full h-full md:w-80 px-4 pt-4 pb-2 space-y-6 relative border-r border-gray-200 dark:border-midnight-border\">\n            <Fireflies />\n            <div className=\"flex justify-between items-center px-1\">\n                <div className=\"flex items-center gap-3\">\n                    <Image src=\"/computer_cat_180.jpeg\" alt=\"Logo\" width={48} height={48} className=\"w-12 h-12 rounded-full object-cover shadow-xs\" priority />\n                    <div className=\"text-xl font-bold bg-clip-text text-transparent bg-linear-to-r from-indigo-500 via-purple-500 via-pink-500 to-orange-500 leading-tight tracking-tight\">\n                        RSS Briefing<br />Hub\n                    </div>\n                </div>\n                <div className=\"flex items-center gap-1 relative\">\n                    <button\n                        onClick={handleRefreshClick}\n                        disabled={isLoading}\n                        className=\"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-midnight-card transition-colors disabled:cursor-wait text-gray-500 dark:text-gray-400 cursor-pointer\"\n                        title=\"刷新内容\"\n                        aria-label=\"刷新内容\"\n                    >\n                        <svg className={`h-5 w-5 ${isLoading ? 'animate-spin' : ''}`} xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582A7.962 7.962 0 0112 4.062a8.002 8.002 0 018 8.002 8.002 8.002 0 01-8 8.002A7.962 7.962 0 014.582 15H4v5\" />\n                        </svg>\n                    </button>\n                </div>\n            </div>\n\n            {useUIStore(state => state.isAdmin) && (\n                <SidebarSearch\n                    searchQuery={searchQuery}\n                    setSearchQuery={setSearchQuery}\n                    onSearch={handleSearchSubmit}\n                />\n            )}\n\n            <div className=\"bg-linear-to-r from-blue-100/80 to-indigo-100/80 dark:from-transparent dark:to-transparent dark:bg-transparent p-1 rounded-lg flex\">\n                <button className={`cursor-pointer ${tabButtonClass(activeTab === 'filters')}`} onClick={() => setActiveTab('filters')}>\n                    <div className=\"flex justify-center items-center gap-2\"><span>🏷️</span><span>分类</span></div>\n                </button>\n                <button className={`cursor-pointer ${tabButtonClass(activeTab === 'calendar')}`} onClick={() => setActiveTab('calendar')}>\n                    <div className=\"flex justify-center items-center gap-2\"><span>📅</span><span>日历</span></div>\n                </button>\n            </div>\n\n            <div className=\"grow overflow-hidden\">\n                <div className={activeTab === 'filters' ? 'block h-full space-y-2 overflow-y-auto' : 'hidden'}>\n                    <SidebarStarred\n                        isExpanded={starredExpanded}\n                        onToggle={toggleStarred}\n                        isLoading={isLoadingStarred}\n                        articles={starredArticles}\n                        onArticleClick={(article) => onOpenArticle?.(article)}\n                        starredCount={starredCount}\n                        activeFilter={activeFilter}\n                        selectedArticleId={selectedArticleId}\n                        onSelect={() => {\n                            if (activeFilter?.type === 'trends') {\n                                setActiveFilter(null);\n                                setSelectedArticleId(null);\n                                router.push('/');\n                            }\n                        }}\n                    />\n                    <SidebarExplore\n                        availableFilters={availableFilters}\n                        activeFilter={activeFilter}\n                        onFilterSelect={handleFilterSelect}\n                        selectedArticleId={selectedArticleId}\n                    />\n                </div>\n                <div className={activeTab === 'calendar' ? 'block h-full' : 'hidden'}>\n                    <SidebarBriefing\n                        isInitialLoading={isInitialLoading}\n                        availableMonths={availableMonths}\n                        selectedMonth={selectedMonth}\n                        onMonthChange={onMonthChange}\n                        datesForMonth={datesForMonth}\n                        dailyStatuses={dailyStatuses}\n                        onToggleDailyStatus={onToggleDailyStatus}\n                        activeFilter={activeFilter}\n                        onDateSelect={handleDateSelect}\n                        selectedArticleId={selectedArticleId}\n                    />\n                </div>\n            </div>\n\n            <SidebarTrends\n                isActive={activeFilter?.type === 'trends' && !selectedArticleId}\n                onClick={() => {\n                    setActiveFilter({ type: 'trends', value: '' });\n                    setSelectedArticleId(null);\n                    router.push('/trends');\n                }}\n            />\n        </aside>\n    );\n});\n\nexport default memo(Sidebar);\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/StreamArticleListItem.tsx","messages":[{"ruleId":"react/prop-types","severity":2,"message":"'articleId' is missing in props validation","line":28,"column":77,"nodeType":"Property","messageId":"missingPropType","endLine":28,"endColumn":86},{"ruleId":"react/prop-types","severity":2,"message":"'initialArticle' is missing in props validation","line":28,"column":88,"nodeType":"Property","messageId":"missingPropType","endLine":28,"endColumn":102}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo } from 'react';\nimport { Article } from '../types';\nimport { useArticleStore } from '../store/articleStore';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\nimport { getRandomColorClass } from '../utils/colorUtils';\nimport ArticleTitleStar from '../app/components/ArticleTitleStar';\nimport { useUIStore } from '../store/uiStore';\n\ninterface StreamArticleListItemProps {\n    articleId: string | number;\n    initialArticle?: Article; // Fallback if not in store\n}\n\n// 隐藏的一句话总结等内容，用于SEO\nconst HiddenSEOContent: React.FC<{ article: Article }> = ({ article }) => {\n    return (\n        <div style={{ display: 'none' }}>\n            <h2>{article.title}</h2>\n            <div>{article.summary}</div>\n            <div>{article.highlights}</div>\n            <div>{article.critiques}</div>\n            <div>{article.marketTake}</div>\n            <a href={article.link}>原文链接</a>\n        </div>\n    );\n};\n\nconst StreamArticleListItem: React.FC<StreamArticleListItemProps> = memo(({ articleId, initialArticle }) => {\n    const storeArticle = useArticleStore(state => state.articlesById[articleId]);\n    const article = storeArticle || initialArticle;\n    const openModal = useUIStore(state => state.openModal);\n\n    if (!article) return null;\n\n    const { userTagLabels: displayedUserTags } = useArticleMetadata(article);\n\n    return (\n        <>\n            {/* Visual Item - Matches ArticleList.tsx EXACTLY */}\n            <div\n                className=\"group relative bg-white dark:bg-midnight-card rounded-xl p-5 transition-all duration-300 hover:shadow-lg hover:-translate-y-1 cursor-pointer overflow-hidden will-change-transform backface-hidden ring-1 ring-black/5 dark:ring-white/10 shadow-sm\"\n                onClick={() => openModal(article.id)}\n            >\n                <div className=\"absolute inset-0 bg-linear-to-r from-transparent via-transparent to-stone-50/50 dark:to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none\" />\n\n                <div className=\"relative z-10\">\n                    <div className=\"flex items-start justify-between gap-4 mb-2\">\n                        <h3 className=\"text-xl font-serif font-bold text-gray-900 dark:text-midnight-text-primary leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors\">\n                            <ArticleTitleStar article={article} className=\"size-5 mr-1.5 inline-block align-middle -translate-y-[2px]\" />\n                            <span>{article.title}</span>\n                        </h3>\n                    </div>\n\n                    <div className=\"flex items-center gap-3 text-xs font-medium text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-4\">\n                        <span className=\"text-gray-600 dark:text-midnight-text-secondary\">{article.sourceName}</span>\n                        <span className=\"size-1 rounded-full bg-gray-300 dark:bg-gray-600\" />\n                        <span>{new Date(article.published).toLocaleDateString('zh-CN')}</span>\n                    </div>\n\n                    {displayedUserTags.length > 0 && (\n                        <div className=\"flex flex-wrap gap-2\">\n                            {displayedUserTags.map(tagLabel => (\n                                tagLabel && (\n                                    <span\n                                        key={tagLabel}\n                                        className={`text-xs font-semibold inline-block py-1 px-3 rounded-full ${getRandomColorClass(tagLabel)}`}\n                                    >\n                                        #{tagLabel}\n                                    </span>\n                                )\n                            ))}\n                        </div>\n                    )}\n                </div>\n\n                {/* SEO Content Embedded Inside the Clickable Card (Invisible) */}\n                <HiddenSEOContent article={article} />\n            </div>\n        </>\n    );\n});\n\nStreamArticleListItem.displayName = 'StreamArticleListItem';\n\nexport default StreamArticleListItem;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/StreamList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Article' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo } from 'react';\nimport { Article } from '../types';\nimport StreamArticleListItem from './StreamArticleListItem';\n\ninterface StreamListProps {\n    articleIds: (string | number)[];\n    isLoading: boolean;\n    fetchNextPage?: () => void;\n    hasNextPage?: boolean;\n    isFetchingNextPage?: boolean;\n}\n\nconst StreamList: React.FC<StreamListProps> = ({\n    articleIds,\n    isLoading,\n    fetchNextPage,\n    hasNextPage,\n    isFetchingNextPage\n}) => {\n    if (isLoading) return <div className=\"py-20 text-center\">Loading...</div>;\n\n    if (articleIds.length === 0) {\n        return (\n            <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-stone-400\">\n                <div className=\"text-6xl mb-4 grayscale\">📭</div>\n                <p className=\"font-serif text-xl\">No articles found in this stream.</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"max-w-4xl mx-auto px-4 py-8 md:px-8\">\n            {/* Single Column Layout (Stream View) */}\n            <div className=\"flex flex-col gap-4\">\n                {articleIds.map((id) => (\n                    <StreamArticleListItem key={id} articleId={id} />\n                ))}\n            </div>\n\n            {hasNextPage && (\n                <div className=\"mt-12 text-center\">\n                    <button\n                        onClick={() => fetchNextPage?.()}\n                        disabled={isFetchingNextPage}\n                        className=\"inline-flex items-center gap-2 px-6 py-3 bg-white dark:bg-white/5 border border-stone-200 dark:border-white/10 rounded-full font-medium hover:bg-stone-50 dark:hover:bg-white/10 transition-colors disabled:opacity-50\"\n                    >\n                        {isFetchingNextPage ? 'Loading...' : 'Load More'}\n                    </button>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default memo(StreamList);\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/TagPopover.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Tag' is defined but never used.","line":4,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/TagPopover.tsx\n\nimport React, { useState, useMemo, useRef, useEffect } from 'react';\nimport { Article, Tag } from '../types';\nimport { useArticleStore } from '../store/articleStore';\n\ninterface TagPopoverProps {\n    article: Article;\n    onClose: () => void;\n    // 【核心修改】让 onStateChange 返回 Promise<any> 或 Promise<void>\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<any>;\n}\n\nconst TagPopover: React.FC<TagPopoverProps> = ({ article, onClose, onStateChange }) => {\n    const availableUserTags = useArticleStore(state => state.availableFilters.tags);\n    const validUserTagIds = useMemo(() => new Set(availableUserTags.map(t => t.id)), [availableUserTags]);\n    const originalUserTags = useMemo(() => new Set((article.tags || []).filter(tagOnArticle => validUserTagIds.has(tagOnArticle))), [article.tags, validUserTagIds]);\n\n    const [selectedTags, setSelectedTags] = useState<Set<string>>(originalUserTags);\n    const [isSaving, setIsSaving] = useState(false); // 我们将使用这个状态来控制按钮的 loading\n    const popoverRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        setSelectedTags(originalUserTags);\n    }, [originalUserTags]);\n\n    const handleTagChange = (tagId: string) => {\n        setSelectedTags(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(tagId)) newSet.delete(tagId);\n            else newSet.add(tagId);\n            return newSet;\n        });\n    };\n\n    const handleConfirm = async () => {\n        setIsSaving(true); // 开始 loading\n        const tagsToAdd = [...selectedTags].filter(t => !originalUserTags.has(t));\n        const tagsToRemove = [...originalUserTags].filter(t => !selectedTags.has(t));\n\n        try {\n            // 【核心修复】现在 await 会真正等待 API 调用完成（或失败）\n            await onStateChange(article.id, tagsToAdd, tagsToRemove);\n            // 只有在 await 成功后，才关闭弹窗\n            onClose();\n        } catch (error) {\n            console.error(\"Failed to save tags\", error);\n            // 失败时，可以让弹窗保持打开，以便用户重试\n        } finally {\n            setIsSaving(false); // 结束 loading\n        }\n    };\n\n    return (\n        <div ref={popoverRef} className=\"absolute bottom-full mb-2 w-64 bg-white rounded-lg shadow-2xl border border-gray-200 z-50 right-0 transition-all duration-200 opacity-100 scale-100 starting:opacity-0 starting:scale-95 origin-bottom-right\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"p-4 border-b\"><h4 className=\"font-semibold text-gray-800\">编辑标签</h4></div>\n            {(!availableUserTags || availableUserTags.length === 0) ? (\n                <div className=\"p-4 text-center text-gray-500\">暂无可用标签。</div>\n            ) : (\n                <div className=\"p-4 max-h-60 overflow-y-auto\">\n                    <div className=\"space-y-3\">\n                        {availableUserTags.map(tag => (\n                            <label key={tag.id} className=\"flex items-center space-x-3 cursor-pointer\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={selectedTags.has(tag.id)}\n                                    onChange={() => handleTagChange(tag.id)}\n                                    className=\"h-4 w-4 rounded-sm border-gray-300 text-blue-600 focus:ring-blue-500\"\n                                />\n                                <span className=\"text-gray-700\">{tag.label}</span>\n                            </label>\n                        ))}\n                    </div>\n                </div>\n            )}\n            <div className=\"p-3 bg-gray-50 flex justify-end space-x-2 rounded-b-lg\">\n                <button onClick={onClose} className=\"px-3 py-1.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50\">取消</button>\n                {/* 【核心修复】按钮现在会根据 isSaving 状态显示 loading */}\n                <button onClick={handleConfirm} disabled={isSaving} className=\"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:bg-blue-300 w-20 text-center\">\n                    {isSaving ? '保存中...' : '确认'}\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default TagPopover;","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/TrendsView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/UnifiedArticleModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// components/UnifiedArticleModal.tsx\n\n\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { Article, CleanArticleContent } from '../types';\nimport { getCleanArticleContent, getArticlesDetails } from '../services/api';\nimport { useArticleStore } from '../store/articleStore';\nimport { useArticleMetadata } from '../hooks/useArticleMetadata';\n\n// Import sub-components\nimport ArticleModalHeader from './article-modal/ArticleModalHeader';\nimport ArticleReaderView from './article-modal/ArticleReaderView';\nimport ArticleBriefingView from './article-modal/ArticleBriefingView';\nimport ArticleModalActions from './article-modal/ArticleModalActions';\n\ninterface UnifiedArticleModalProps {\n    article: Article;\n    onClose: () => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<any>;\n    initialMode?: 'briefing' | 'reader';\n}\n\nconst UnifiedArticleModal: React.FC<UnifiedArticleModalProps> = ({ article, onClose, onStateChange, initialMode = 'briefing' }) => {\n    const [viewMode, setViewMode] = useState<'briefing' | 'reader'>(initialMode);\n    // 原文内容状态\n    const [readerContent, setReaderContent] = useState<CleanArticleContent | null>(null);\n    const [isLoadingReader, setIsLoadingReader] = useState(false);\n\n    // 简报数据加载状态\n    const [isLoadingBriefing, setIsLoadingBriefing] = useState(false);\n    // 1. 【新增】标记是否已经尝试过获取简报数据，防止死循环\n    const [hasAttemptedFetch, setHasAttemptedFetch] = useState(false);\n\n    const updateArticle = useArticleStore(state => state.updateArticle);\n\n    const [isTagPopoverOpen, setIsTagPopoverOpen] = useState(false);\n    const { isStarred, userTagLabels } = useArticleMetadata(article);\n\n    // 判断是否拥有简报数据\n    const hasBriefingData = useMemo(() => {\n        return !!((article.summary && article.summary.length > 0) ||\n            (article.verdict && article.verdict.score > 0) ||\n            (article.briefingSection && article.briefingSection !== ''));\n    }, [article]);\n\n    // 2. 【新增】当文章 ID 变化时，重置尝试状态\n    useEffect(() => {\n        setHasAttemptedFetch(false);\n        setIsLoadingBriefing(false);\n        setReaderContent(null);\n        setViewMode(initialMode);\n        setReaderContent(null);\n    }, [article.id, initialMode]);\n\n    // 3. 【修改】获取 Supabase 数据逻辑\n    useEffect(() => {\n        // 增加 !hasAttemptedFetch 条件，确保只请求一次\n        if (viewMode === 'briefing' && !hasBriefingData && !isLoadingBriefing && !hasAttemptedFetch) {\n            const fetchBriefingData = async () => {\n                setIsLoadingBriefing(true);\n                try {\n                    const detailsMap = await getArticlesDetails([article.id]);\n                    const details = detailsMap[article.id];\n\n                    if (details) {\n                        const mergedArticle = {\n                            ...article,\n                            ...details,\n                            tags: article.tags\n                        };\n                        updateArticle(mergedArticle);\n                    }\n                    // 即使 details 为空，我们也什么都不做，因为 finally 会标记已尝试\n                } catch (error) {\n                    console.error(\"Failed to fetch briefing details\", error);\n                } finally {\n                    setIsLoadingBriefing(false);\n                    // 4. 【关键】无论成功失败，标记为已尝试，防止死循环\n                    setHasAttemptedFetch(true);\n                }\n            };\n            fetchBriefingData();\n        }\n    }, [viewMode, hasBriefingData, isLoadingBriefing, hasAttemptedFetch, article, updateArticle]);\n\n    // Keyboard event listener for Escape\n    useEffect(() => {\n        const handleKeyDown = (event: KeyboardEvent) => {\n            if (event.key === 'Escape') onClose();\n        };\n        document.addEventListener('keydown', handleKeyDown);\n        document.body.style.overflow = 'hidden';\n        return () => {\n            document.removeEventListener('keydown', handleKeyDown);\n            document.body.style.overflow = 'auto';\n        };\n    }, [onClose]);\n\n    // ... (切换到原文模式的 useEffect 保持不变) ...\n    useEffect(() => {\n        if (viewMode === 'reader' && !readerContent && !isLoadingReader) {\n            const fetchContent = async () => {\n                setIsLoadingReader(true);\n                try {\n                    const data = await getCleanArticleContent(article);\n                    setReaderContent(data);\n                } catch (error) {\n                    console.error(\"Failed to fetch article content\", error);\n                } finally {\n                    setIsLoadingReader(false);\n                }\n            };\n            fetchContent();\n        }\n    }, [viewMode, article, readerContent, isLoadingReader]);\n\n    // ...\n\n    // Update document title when modal is open\n    useEffect(() => {\n        const originalTitle = document.title;\n        document.title = `${article.title} - RSS Briefing Hub`;\n        return () => {\n            document.title = originalTitle;\n        };\n    }, [article.title]);\n\n    return (\n        <>\n            <div onClick={onClose} className=\"fixed inset-0 bg-black/60 z-30 transition-opacity duration-300 animate-fadeIn\" />\n            <div className=\"fixed top-0 right-0 h-full w-full max-w-2xl bg-neutral-50 dark:bg-midnight-bg bg-paper-texture dark:bg-none shadow-2xl z-40 transform transition-transform duration-300 animate-slideInRight flex flex-col\">\n\n                {/* Unified Close Button - Original Style Restored */}\n                <button\n                    onClick={onClose}\n                    className=\"absolute top-4 right-4 z-50 p-2 text-gray-500 dark:text-gray-400 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors cursor-pointer\"\n                    title=\"关闭\"\n                >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                </button>\n\n                <ArticleModalHeader\n                    viewMode={viewMode}\n                    setViewMode={setViewMode}\n                    onClose={onClose}\n                />\n\n                {/* Content Body */}\n                <div className=\"grow overflow-y-auto bg-neutral-50 dark:bg-midnight-bg\">\n                    {viewMode === 'briefing' ? (\n                        <ArticleBriefingView\n                            article={article}\n                            isLoading={isLoadingBriefing}\n                            hasBriefingData={hasBriefingData}\n                            onReaderModeRequest={() => setViewMode('reader')}\n                            onStateChange={onStateChange}\n                        />\n                    ) : (\n                        <ArticleReaderView\n                            article={article}\n                            readerContent={readerContent}\n                            isLoading={isLoadingReader}\n                            userTagLabels={userTagLabels}\n                        />\n                    )}\n                </div>\n\n                <ArticleModalActions\n                    article={article}\n                    isStarred={isStarred}\n                    onStateChange={onStateChange}\n                    isTagPopoverOpen={isTagPopoverOpen}\n                    setIsTagPopoverOpen={setIsTagPopoverOpen}\n                />\n            </div>\n        </>\n    );\n};\n\nexport default UnifiedArticleModal;","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/article-modal/ArticleBriefingView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[411,414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[411,414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Article } from '../../types';\nimport LoadingSpinner from '../LoadingSpinner';\nimport ArticleCard from '../ArticleCard';\n\ninterface ArticleBriefingViewProps {\n    article: Article;\n    isLoading: boolean;\n    hasBriefingData: boolean;\n    onReaderModeRequest: () => void;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<any>;\n}\n\nconst ArticleBriefingView: React.FC<ArticleBriefingViewProps> = ({ article, isLoading, hasBriefingData, onReaderModeRequest, onStateChange }) => {\n    if (isLoading) {\n        return (\n            <div className=\"flex flex-col items-center justify-center h-64 space-y-4\">\n                <LoadingSpinner />\n                <p className=\"text-gray-500 text-sm\">正在抓取智能简报...</p>\n            </div>\n        );\n    }\n\n    if (!hasBriefingData) {\n        return (\n            <div className=\"flex flex-col items-center justify-center h-64 p-8 text-center animate-fadeIn\">\n                <div className=\"bg-gray-100 p-4 rounded-full mb-4\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                    </svg>\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">暂无智能简报</h3>\n                <p className=\"text-gray-500 mb-6\">该文章尚未完成 AI 分析，请直接阅读原文。</p>\n                <button\n                    onClick={onReaderModeRequest}\n                    className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors shadow-xs cursor-pointer\"\n                >\n                    切换到原文阅读\n                </button>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"p-4 md:p-6\">\n            <ArticleCard\n                article={article}\n                showActions={false}\n                onReaderModeRequest={onReaderModeRequest}\n                onStateChange={onStateChange}\n            />\n        </div>\n    );\n};\n\nexport default ArticleBriefingView;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/article-modal/ArticleModalActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[338,341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[338,341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Article } from '../../types';\nimport { STAR_TAG } from '../../constants';\nimport TagPopover from '../TagPopover';\n\ninterface ArticleModalActionsProps {\n    article: Article;\n    isStarred: boolean;\n    onStateChange: (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => Promise<any>;\n    isTagPopoverOpen: boolean;\n    setIsTagPopoverOpen: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nimport { useUIStore } from '../../store/uiStore';\n\nconst ArticleModalActions: React.FC<ArticleModalActionsProps> = ({ article, isStarred, onStateChange, isTagPopoverOpen, setIsTagPopoverOpen }) => {\n    const isAdmin = useUIStore(state => state.isAdmin);\n\n    if (!isAdmin) return null;\n\n    return (\n        <div className=\"absolute bottom-8 right-8 z-50 flex flex-col-reverse items-center gap-y-3\">\n            <div className=\"relative\" onClick={(e) => e.stopPropagation()}>\n                <button onClick={() => setIsTagPopoverOpen(prev => !prev)} className=\"p-3 bg-sky-600 text-white rounded-full shadow-lg hover:bg-sky-700 transition-all\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path fillRule=\"evenodd\" d=\"M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a1 1 0 011-1h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" /></svg>\n                </button>\n                {isTagPopoverOpen && (\n                    <TagPopover\n                        article={article}\n                        onClose={() => setIsTagPopoverOpen(false)}\n                        onStateChange={onStateChange}\n                    />\n                )}\n            </div>\n            <button\n                onClick={() => {\n                    onStateChange(article.id, isStarred ? [] : [STAR_TAG], isStarred ? [STAR_TAG] : []);\n                }}\n                className={`p-3 text-white rounded-full shadow-lg transition-all ${isStarred ? 'bg-amber-500 hover:bg-amber-600' : 'bg-gray-800 hover:bg-gray-950'\n                    }`}\n            >\n                {isStarred ? (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" viewBox=\"0 0 20 20\" fill=\"currentColor\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" /></svg>\n                ) : (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth=\"2\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" /></svg>\n                )}\n            </button>\n        </div>\n    );\n};\n\nexport default ArticleModalActions;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/article-modal/ArticleModalHeader.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onClose' is defined but never used.","line":9,"column":89,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":96}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\n\ninterface ArticleModalHeaderProps {\n    viewMode: 'briefing' | 'reader';\n    setViewMode: (mode: 'briefing' | 'reader') => void;\n    onClose: () => void;\n}\n\nconst ArticleModalHeader: React.FC<ArticleModalHeaderProps> = ({ viewMode, setViewMode, onClose }) => {\n    return (\n        <div className=\"flex items-center gap-3 p-3 border-b border-stone-100 dark:border-white/10 bg-white/80 dark:bg-midnight-sidebar backdrop-blur-xl z-10\">\n            <div className=\"flex bg-gray-200/80 dark:bg-gray-800/80 p-1 rounded-lg\">\n                <button\n                    onClick={() => setViewMode('briefing')}\n                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 cursor-pointer ${viewMode === 'briefing' ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-xs' : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\n                        }`}\n                >\n                    📊 智能简报\n                </button>\n                <button\n                    onClick={() => setViewMode('reader')}\n                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all duration-200 cursor-pointer ${viewMode === 'reader' ? 'bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-xs' : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\n                        }`}\n                >\n                    📄 原文阅读\n                </button>\n            </div>\n        </div>\n    );\n};\n\nexport default ArticleModalHeader;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/article-modal/ArticleReaderView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/Fireflies.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/ReloadPWAButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/SidebarBriefing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/SidebarExplore.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/SidebarSearch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/SidebarStarred.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isFilterActive' is assigned a value but never used.","line":29,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":60,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":44}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport Link from 'next/link';\nimport { Article, Filter } from '../../types';\nimport { toShortId } from '../../utils/idHelpers';\n\ninterface SidebarStarredProps {\n    isExpanded: boolean;\n    onToggle: () => void;\n    isLoading: boolean;\n    articles: Article[];\n    onArticleClick: (article: Article) => void;\n    starredCount: number;\n    activeFilter: Filter | null;\n    selectedArticleId: string | number | null;\n    onSelect?: () => void;\n}\n\nconst SidebarStarred: React.FC<SidebarStarredProps> = ({\n    isExpanded,\n    onToggle,\n    isLoading,\n    articles,\n    onArticleClick,\n    starredCount,\n    activeFilter,\n    selectedArticleId,\n    onSelect\n}) => {\n    const isFilterActive = activeFilter?.type === 'starred';\n    const listItemButtonClass = (isActive: boolean) => `w-full text-left px-3 py-2 rounded-md transition-all duration-200 flex items-center gap-3 text-sm font-medium ${isActive ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-midnight-text-secondary dark:hover:bg-midnight-card dark:hover:text-gray-200'} cursor-pointer`;\n\n    return (\n        <nav className=\"flex flex-col\">\n            <button onClick={() => { onToggle(); onSelect?.(); }} className=\"w-full text-left px-2 py-1 flex items-center justify-between text-base font-bold text-gray-600 dark:text-gray-300 mb-1 hover:text-gray-900 dark:hover:text-white transition-colors cursor-pointer\">\n                <div className=\"flex items-center gap-2\">\n                    <span>⭐ 我的收藏</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    {starredCount > 0 && (\n                        <span className=\"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-400 min-w-5 h-5 flex items-center justify-center rounded-full text-[10px] px-1\">\n                            {starredCount}\n                        </span>\n                    )}\n                    <svg className={`h-4 w-4 transition-transform duration-200 ${isExpanded ? 'rotate-90' : ''}`} xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n                    </svg>\n                </div>\n            </button>\n            <div className={`space-y-0.5 ml-3 pl-3 border-l-2 border-gray-100 dark:border-gray-800 ${isExpanded ? 'block' : 'hidden'}`}>\n                {isLoading && articles.length === 0 ? (\n                    <div className=\"space-y-2 px-2\">{[...Array(3)].map((_, i) => <div key={i} className=\"h-8 bg-gray-100 dark:bg-midnight-card rounded-sm animate-pulse\"></div>)}</div>\n                ) : (\n                    articles.length === 0 ? (\n                        <div className=\"px-2 py-2 text-xs text-gray-400 italic\">No favorites yet</div>\n                    ) : (\n                        articles.map(article => (\n                            <Link\n                                key={article.id}\n                                href={`/article/${toShortId(String(article.id))}?view=page`}\n                                onClick={(e) => {\n                                    // Optional: update store but let Link handle nav\n                                    onArticleClick(article);\n                                }}\n                                className={listItemButtonClass(selectedArticleId === article.id)}\n                            >\n                                <span className=\"truncate\">{article.title}</span>\n                            </Link>\n                        ))\n                    )\n                )}\n            </div>\n        </nav>\n    );\n};\n\nexport default SidebarStarred;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/components/sidebar/SidebarTrends.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useAppToast.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":3,"column":31,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":3,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useToastStore } from '../store/toastStore';\n\nexport const useAppToast = () => {\n    const toast = useToastStore();\n\n    return {\n        toast,\n        showToast: toast.showToast,\n        hideToast: toast.hideToast\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useArticleActions.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":8,"column":37,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":8,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updatedArticle' is defined but never used.","line":34,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":37,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":28}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\nimport { Article } from '../types';\nimport { useArticleStore } from '../store/articleStore';\nimport { useUIStore } from '../store/uiStore';\nimport { useUpdateArticleState, useMarkAllAsRead } from './useArticles';\nimport { useToastStore } from '../store/toastStore';\n\nexport const useArticleActions = () => {\n    const showToast = useToastStore(state => state.showToast);\n    const setSelectedArticleId = useUIStore(state => state.setSelectedArticleId);\n    const openModal = useUIStore(state => state.openModal);\n    const addArticles = useArticleStore(state => state.addArticles);\n\n    const { mutateAsync: updateArticleState, isPending: isUpdatingArticle } = useUpdateArticleState();\n    const { mutate: markAllAsRead, isPending: isMarkingAsRead } = useMarkAllAsRead();\n\n    const handleOpenFromList = useCallback((article: Article) => {\n        addArticles([article]);\n        openModal(article.id, 'briefing');\n    }, [addArticles, openModal]);\n\n    const handleOpenFromBriefingCard = useCallback((article: Article) => {\n        addArticles([article]);\n        openModal(article.id, 'reader');\n    }, [addArticles, openModal]);\n\n    const handleOpenMainDetail = useCallback((article: Article) => {\n        setSelectedArticleId(article.id);\n        addArticles([article]);\n    }, [setSelectedArticleId, addArticles]);\n\n    const handleArticleStateChange = async (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]) => {\n        await updateArticleState({ articleId, tagsToAdd, tagsToRemove }, {\n            onSuccess: (updatedArticle) => {\n                // Success handling if needed\n            },\n            onError: (error) => {\n                showToast('标签更新失败', 'error');\n            }\n        });\n    };\n\n    const handleMarkAllClick = (articleIdsInView: (string | number)[]) => {\n        if (articleIdsInView.length > 0) {\n            markAllAsRead(articleIdsInView);\n        } else {\n            showToast('没有需要标记的文章', 'info');\n        }\n    };\n\n    return {\n        handleOpenFromList,\n        handleOpenFromBriefingCard,\n        handleOpenMainDetail,\n        handleArticleStateChange,\n        handleMarkAllClick,\n        isUpdatingArticle,\n        isMarkingAsRead\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useArticleMetadata.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":14,"column":73,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":14,"endColumn":75}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useArticleMetadata.ts\n\nimport { useMemo } from 'react';\nimport { Article } from '../types';\nimport { useArticleStore } from '../store/articleStore';\nimport { STAR_TAG, READ_TAG } from '../constants';\n\n/**\n * 一个健壮的自定义 Hook，用于从 article 对象中派生出常用的元数据。\n * 无论输入的 article 是否为 null 或 undefined，它始终返回一个包含默认值的有效对象。\n * @param article - 需要计算元数据的文章对象，可以是 null 或 undefined。\n * @returns 返回一个包含 isStarred (boolean), isRead (boolean), 和 userTagLabels (string[]) 的对象。\n */\nexport const useArticleMetadata = (article: Article | null | undefined) => {\n    const availableUserTags = useArticleStore(state => state.availableFilters.tags);\n\n    // 【改】将所有计算逻辑包裹在单个 useMemo 中，以确保原子性和健壮性。\n    // 无论 article 是否存在，这个 Hook 都会返回一个结构完整的对象。\n    return useMemo(() => {\n        // 1. 定义默认返回值，这是防止 a.length 错误的关键\n        const defaults = {\n            isStarred: false,\n            isRead: false,\n            userTagLabels: [],\n        };\n\n        // 2. 如果没有文章或文章没有标签，立即返回默认值\n        if (!article?.tags) {\n            return defaults;\n        }\n\n        // 3. 如果有文章，则进行计算\n        const tags = article.tags;\n\n        const isStarred = tags.includes(STAR_TAG);\n        const isRead = tags.includes(READ_TAG);\n\n        let userTagLabels: string[] = [];\n        // 确保 availableUserTags 也已加载\n        if (availableUserTags && availableUserTags.length > 0) {\n            const availableUserTagMap = new Map(availableUserTags.map(t => [t.id, t.label]));\n            userTagLabels = tags\n                .filter(tagId => availableUserTagMap.has(tagId))\n                .map(tagId => availableUserTagMap.get(tagId))\n                .filter(Boolean) as string[];\n        }\n\n        return {\n            isStarred,\n            isRead,\n            userTagLabels,\n        };\n    }, [article, availableUserTags]); // 依赖项是 article 对象本身和标签列表\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useArticleState.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":65,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":7,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useArticleState.ts\n\nimport { useState, useEffect } from 'react';\nimport { Article } from '../types';\n\n// 这个 Hook 现在只负责管理一个文章对象的本地状态，不再执行 API 调用。\nexport const useArticleState = (initialArticle: Article | null) => {\n    const [article, setArticle] = useState(initialArticle);\n\n    useEffect(() => {\n        setArticle(initialArticle);\n    }, [initialArticle]);\n\n    // 它只返回状态，不再返回更新函数，因为更新由 App.tsx 的 handleArticleStateChange 统一处理。\n    return {\n        article,\n    };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useArticles.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fetchStarredArticleHeaders' is defined but never used.","line":8,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":31},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":15,"column":114,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":15,"endColumn":116},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2139,2142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2139,2142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Argument 'initialData' should be typed with a non-any type.","line":55,"column":65,"nodeType":"Identifier","messageId":"anyTypedArg","endLine":55,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2251,2254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2251,2254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":55,"column":84,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":55,"endColumn":86},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":83,"column":108,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":83,"endColumn":110},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5043,5046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5043,5046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":128,"column":41,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":128,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5617,5620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5617,5620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":200,"column":36,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":200,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'queryClient' is assigned a value but never used.","line":201,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":201,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'articlesById' is assigned a value but never used.","line":204,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":204,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'variables' is defined but never used.","line":213,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'context' is defined but never used.","line":213,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":42},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":222,"column":56,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":222,"endColumn":58}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useArticles.ts\n\nimport { useQuery, useMutation, useQueryClient, useInfiniteQuery } from '@tanstack/react-query';\nimport {\n    fetchBriefingArticles,\n    fetchFilteredArticles,\n    fetchSearchResults,\n    fetchStarredArticleHeaders\n} from '../services/articleLoader'; // 1. 【核心修改】从新的加载器导入\nimport { getRawStarredArticles, editArticleTag, editArticleState, markAllAsRead as apiMarkAllAsRead } from '../services/api';\nimport { useArticleStore } from '../store/articleStore';\nimport { getTodayInShanghai } from '../services/api';\n// --- Query Hooks (现在变得非常简洁) ---\n\nexport const useBriefingArticles = (date: string | null, slot: string | null, initialData?: (string | number)[]) => {\n    const today = getTodayInShanghai();\n    const addArticles = useArticleStore(state => state.addArticles);\n    return useQuery({\n        // 【核心修复 #2】\n        // 当 slot 为 null 时，我们给它一个明确的字符串 'all'。\n        // 这可以确保 react-query 将 ['briefing', date, null] 和 ['briefing', date, 'all'] 视为两个不同的缓存条目。\n        queryKey: ['briefing', date, slot || 'all'],\n        queryFn: async () => {\n            if (!date) return [];\n            // queryFn 接收的仍然是原始的 slot (可以是 null)\n            const completeArticles = await fetchBriefingArticles(date, slot);\n            addArticles(completeArticles);\n            return completeArticles.map(a => a.id);\n        },\n        enabled: !!date,\n        // 【核心修复 #3】\n        // initialData (SSR 数据) 通常是全天的数据。\n        // 如果我们正在请求特定的 slot (例如 'morning')，我们需要忽略 initialData，\n        // 强制 react-query 去获取该 slot 的特定数据。\n        // 否则，我们会把全天的数据误作为 'morning' 的数据展示。\n        initialData: (!slot || slot === 'all') ? initialData : undefined,\n\n        // --- 【核心优化】 ---\n        // 动态设置 staleTime\n        staleTime: (() => {\n            // 如果查询的日期是今天，我们使用一个较短的 staleTime (例如 5 分钟)，\n            // 因为今天的数据是会变化的。\n            if (date === today) {\n                return 1000 * 60 * 5; // 5 minutes\n            }\n            // 如果查询的是历史日期，我们告诉 react-query 这个数据是“永不过期”的。\n            // Infinity 意味着只要缓存存在，就永远不要认为它是 stale 的，\n            // 也就永远不会自动去 refetch。\n            return Infinity;\n        })(),\n        placeholderData: (previousData: any) => previousData,\n    });\n};\n\nexport const useFilteredArticles = (filterValue: string | null, initialData?: any) => {\n    const addArticles = useArticleStore(state => state.addArticles);\n\n    return useInfiniteQuery({\n        queryKey: ['articles', filterValue],\n        queryFn: async ({ pageParam }) => {\n            if (!filterValue) return { articles: [], continuation: undefined };\n\n            // pageParam is the continuation token\n            const result = await fetchFilteredArticles(filterValue, pageParam as string | undefined);\n\n            // Add articles to the store\n            addArticles(result.articles);\n\n            // Return structure expected by infinite query\n            return {\n                articles: result.articles.map(a => a.id), // We only need IDs for the UI list\n                continuation: result.continuation\n            };\n        },\n        initialPageParam: undefined as string | undefined,\n        getNextPageParam: (lastPage) => lastPage.continuation, // Use the continuation token for the next page\n        enabled: !!filterValue,\n        initialData: initialData,\n    });\n};\n\n// Update useStarredArticles signature\nexport const useStarredArticles = (initialData?: { id: string | number; title: string; tags: string[] }[]) => {\n    const setStarredArticleIds = useArticleStore(state => state.setStarredArticleIds);\n    return useQuery({\n        queryKey: ['starredHeaders'],\n        queryFn: async () => {\n            // 【改】直接调用最底层的 API 函数，获取 FreshRSS 的原始数据\n            const freshArticles = await getRawStarredArticles();\n\n            // 我们只更新 starredArticleIds 列表\n            setStarredArticleIds(freshArticles.map(a => a.id));\n\n            // 返回头部信息给 useSidebar Hook\n            return freshArticles.map(a => ({\n                id: a.id,\n                title: a.title,\n                link: a.link,\n                sourceName: a.sourceName,\n                published: a.published,\n                tags: a.tags,\n                // Fill in missing properties with defaults to satisfy Article interface\n                created_at: new Date().toISOString(),\n                category: '',\n                briefingSection: '',\n                keywords: [],\n                verdict: { type: '', score: 0 },\n                summary: '',\n                tldr: '',\n                highlights: '',\n                critiques: '',\n                marketTake: '',\n                n8n_processing_date: undefined\n            }));\n        },\n        // Hydrate with initial data if provided. \n        // Note: initialData from SSR might be partial (id, title), so we cast or adapt if needed.\n        // Actually, SidebarStarred only strictly needs id and title for the list, \n        // but it might access other props safely or default them.\n        // Let's assume initialData is sufficient for hydration to avoid \"Loading...\".\n        initialData: initialData as any,\n    });\n};\n\n// --- Mutation Hooks ---\n\n// 4. 更新文章状态 (标签、收藏、已读) - 非乐观更新版本\nexport const useUpdateArticleState = () => {\n    const queryClient = useQueryClient();\n    const updateArticle = useArticleStore((state) => state.updateArticle);\n    const articlesById = useArticleStore((state) => state.articlesById);\n\n    return useMutation({\n        mutationFn: async ({ articleId, tagsToAdd, tagsToRemove }: { articleId: string | number, tagsToAdd: string[], tagsToRemove: string[] }) => {\n            // 2. 【增加】创建一个数组来收集所有需要执行的 promise\n            const apiPromises: Promise<any>[] = [];\n\n            // --- 处理状态标签 (收藏/已读) ---\n            const stateTagsToAdd = tagsToAdd.filter(t => t.startsWith('user/-/state'));\n            const stateTagsToRemove = tagsToRemove.filter(t => t.startsWith('user/-/state'));\n\n            for (const tag of stateTagsToAdd) {\n                if (tag.includes('starred')) apiPromises.push(editArticleState(articleId, 'star', true));\n                if (tag.includes('read')) apiPromises.push(editArticleState(articleId, 'read', true));\n            }\n            for (const tag of stateTagsToRemove) {\n                if (tag.includes('starred')) apiPromises.push(editArticleState(articleId, 'star', false));\n                if (tag.includes('read')) apiPromises.push(editArticleState(articleId, 'read', false));\n            }\n\n            // --- 处理用户自定义标签 ---\n            const userTagsToAdd = tagsToAdd.filter(t => !t.startsWith('user/-/state'));\n            const userTagsToRemove = tagsToRemove.filter(t => !t.startsWith('user/-/state'));\n\n            if (userTagsToAdd.length > 0 || userTagsToRemove.length > 0) {\n                apiPromises.push(editArticleTag(articleId, userTagsToAdd, userTagsToRemove));\n            }\n\n            // 3. 【修改】使用 Promise.all 来并行执行所有 API 请求\n            // 只有当所有请求都成功时，才会继续往下执行\n            await Promise.all(apiPromises);\n\n\n\n            // API 成功后，计算并返回最新的文章对象\n            const articleToUpdate = articlesById[articleId];\n            if (!articleToUpdate) throw new Error(\"Article not found in store\");\n\n            const finalTagsSet = new Set(articleToUpdate.tags || []);\n            tagsToAdd.forEach(tag => finalTagsSet.add(tag));\n            tagsToRemove.forEach(tag => finalTagsSet.delete(tag));\n            return { ...articleToUpdate, tags: Array.from(finalTagsSet) };\n        },\n        onSuccess: (updatedArticle, variables) => {\n            updateArticle(updatedArticle);\n\n            // 【Active Revalidation】\n            // When tags change, immediately trigger revalidation for those tag streams.\n            // This ensures SEO pages are fresh without waiting for ISR cycle.\n            const touchedTags = new Set([...variables.tagsToAdd, ...variables.tagsToRemove]);\n            touchedTags.forEach(tag => {\n                // Don't block UI updates, fire and forget\n                fetch(`/api/revalidate?tag=${encodeURIComponent(tag)}`).catch(err =>\n                    console.warn(`[Revalidate] Failed to trigger for ${tag}`, err)\n                );\n            });\n        },\n        onError: (err) => {\n            console.error(\"Failed to update article state:\", err);\n        },\n        onSettled: () => {\n            // 告诉 react-query，所有与“收藏”相关的查询数据都可能已经过时了。\n            // 下一次 useStarredArticles Hook 渲染时，它会自动重新获取最新的头部信息。\n            queryClient.invalidateQueries({ queryKey: ['starredHeaders'] });\n        },\n    });\n};\n\n// 5. 批量标记已读\nexport const useMarkAllAsRead = () => {\n    const queryClient = useQueryClient();\n    // 2. 【增加】获取新的批量更新 action\n    const markArticlesAsRead = useArticleStore((state) => state.markArticlesAsRead);\n    const articlesById = useArticleStore((state) => state.articlesById); // 保持不变，可能未来需要\n    return useMutation({\n        mutationFn: apiMarkAllAsRead,\n        onSuccess: (markedIds) => {\n            // markedIds 是从 apiMarkAllAsRead 成功返回的 ID 列表\n            if (!markedIds || markedIds.length === 0) return;\n            // 用一次调用替代整个 forEach 循环\n            markArticlesAsRead(markedIds);\n        },\n        onError: (err, variables, context) => {\n            console.error(\"Failed to mark as read:\", err);\n        },\n    });\n};\n\n\n\n// 2. 【增加】在文件末尾添加新的 useSearchResults Hook\nexport const useSearchResults = (query: string | null) => {\n    const addArticles = useArticleStore(state => state.addArticles);\n    return useQuery({\n        queryKey: ['search', query],\n        queryFn: async () => {\n            if (!query) return [];\n            const completeArticles = await fetchSearchResults(query);\n            addArticles(completeArticles);\n            return completeArticles.map(a => a.id);\n        },\n        enabled: !!query, // 只有当 query 存在时才执行\n    });\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useDailyStatus.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":57,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":7,"endColumn":59},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":34,"column":40,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":34,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useDailyStatus.ts\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { getDailyStatuses, updateDailyStatus, showToast } from '../services/api';\n// --- Query Hook ---\n// 用于获取指定月份的每日完成状态\nexport const useDailyStatusesForMonth = (month: string) => {\n    // month 格式为 'YYYY-MM'\n    const queryKey = ['dailyStatuses', month];\n\n    return useQuery({\n        queryKey: queryKey,\n        queryFn: async () => {\n            if (!month) return {};\n            const startDate = `${month}-01`;\n            const date = new Date(parseInt(month.substring(0, 4)), parseInt(month.substring(5, 7)), 0);\n            const endDate = `${month}-${date.getDate()}`;\n            return getDailyStatuses(startDate, endDate);\n        },\n        enabled: !!month, // 只有当 month 有效时才执行查询\n        // 策略调整: \n        // 1. 每次打开 APP (冷启动/刷新) -> 内存缓存为空 -> 发起请求\n        // 2. 切换标签/最小化 (热启动) -> 内存缓存存在且未过期 (Infinity) -> 不发起请求\n        // 3. 组件重渲染 -> 不发起请求\n        staleTime: Infinity,\n        refetchOnWindowFocus: false,\n        refetchOnMount: false,\n        refetchOnReconnect: false,\n    });\n};\n\n// --- Mutation Hook ---\n// 用于更新单个日期的完成状态（采用乐观更新）\nexport const useUpdateDailyStatus = () => {\n    const queryClient = useQueryClient();\n\n    return useMutation({\n        mutationFn: ({ date, isCompleted }: { date: string, isCompleted: boolean }) =>\n            updateDailyStatus(date, isCompleted),\n\n        // --- 乐观更新 ---\n        onMutate: async ({ date, isCompleted }) => {\n            const month = date.substring(0, 7);\n            const queryKey = ['dailyStatuses', month];\n\n            // 1. 取消任何可能冲突的进行中查询\n            await queryClient.cancelQueries({ queryKey });\n\n            // 2. 获取当前状态的快照\n            const previousStatuses = queryClient.getQueryData<Record<string, boolean>>(queryKey) || {};\n\n            // 3. 立即更新缓存中的数据，让 UI 瞬间响应\n            queryClient.setQueryData<Record<string, boolean>>(queryKey, (old) => ({\n                ...old,\n                [date]: isCompleted,\n            }));\n\n            // 4. 返回包含快照的上下文\n            return { previousStatuses, queryKey };\n        },\n        // --- 【核心修改】在 onSuccess 中显示 Toast 并确认状态 ---\n        onSuccess: (data, variables) => {\n            const { date, isCompleted } = variables;\n            const dateObj = new Date(date + 'T00:00:00');\n            const displayDate = dateObj.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric' });\n\n            const message = isCompleted\n                ? `${displayDate} 简报已标记为完成`\n                : `${displayDate} 简报已标记为未完成`;\n\n            showToast(message, 'success');\n\n            // 【核心修复】使用服务器返回的确认数据更新缓存\n            // 这比 invalidateQueries 更安全，因为它不会触发可能返回旧数据的重新获取\n            if (data && data.success) {\n                const month = date.substring(0, 7);\n                const queryKey = ['dailyStatuses', month];\n\n                queryClient.setQueryData<Record<string, boolean>>(queryKey, (old) => ({\n                    ...old,\n                    [data.date]: data.is_completed,\n                }));\n            }\n        },\n        // --- 错误处理 ---\n        onError: (err, variables, context) => {\n            console.error(\"Failed to update daily status:\", err);\n            // 回滚 UI\n            if (context?.previousStatuses) {\n                queryClient.setQueryData(context.queryKey, context.previousStatuses);\n            }\n            // 【增】在出错时也显示 Toast\n            showToast('状态更新失败，请重试', 'error');\n        },\n        // 【核心修复】移除 onSettled 中的 invalidateQueries\n        // onSettled: (data, error, variables) => { ... } \n    });\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useFilters.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":18,"column":93,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":18,"endColumn":95},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'activeFilter' is assigned a value but never used.","line":41,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isLoadingStatuses' is assigned a value but never used.","line":62,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":62}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useFilters.ts\n\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport { Filter, AvailableFilters } from '../types';\nimport { getAvailableDates, getAvailableFilters, getTodayInShanghai } from '../services/api';\nimport { useArticleStore } from '../store/articleStore';\nimport { useUIStore } from '../store/uiStore';\nimport { useDailyStatusesForMonth, useUpdateDailyStatus } from './useDailyStatus';\n\nconst CACHE_KEY_ACTIVE_FILTER = 'cachedActiveFilter';\nconst CACHE_KEY_SELECTED_MONTH = 'cachedSelectedMonth';\n\ninterface UseFiltersProps {\n    initialDates?: string[];\n    initialAvailableFilters?: AvailableFilters;\n}\n\nexport const useFilters = ({ initialDates, initialAvailableFilters }: UseFiltersProps = {}) => {\n    const [dates, setDates] = useState<string[]>(initialDates || []);\n    // Initializing selectedMonth with initialDates if available\n    const [selectedMonth, setSelectedMonth] = useState<string>(() => {\n        if (typeof window !== 'undefined') {\n            const cached = sessionStorage.getItem(CACHE_KEY_SELECTED_MONTH);\n            if (cached) {\n                try {\n                    return JSON.parse(cached);\n                } catch (e) {\n                    console.error('Failed to parse cached selected month', e);\n                }\n            }\n        }\n        // Improve default month logic: if initialDates has data, use the latest month from there\n        if (initialDates && initialDates.length > 0) {\n            return initialDates[0].substring(0, 7);\n        }\n        return getTodayInShanghai().substring(0, 7);\n    });\n    // If we have initial data, we are not loading initially.\n    const [isInitialLoad, setIsInitialLoad] = useState(!initialDates || initialDates.length === 0);\n\n    const activeFilter = useUIStore(state => state.activeFilter);\n    const setActiveFilter = useUIStore(state => state.setActiveFilter);\n    const storeAvailableFilters = useArticleStore(state => state.availableFilters);\n    // Use initial data if store is empty (SSR/Hydration)\n    const availableFilters = (storeAvailableFilters.tags.length > 0 || storeAvailableFilters.categories.length > 0)\n        ? storeAvailableFilters\n        : (initialAvailableFilters || { tags: [], categories: [] });\n    // const setAvailableFilters = useArticleStore(state => state.setAvailableFilters); // Keep this but remove the 'availableFilters' const definition line 43\n    const setAvailableFilters = useArticleStore(state => state.setAvailableFilters);\n    const [isRefreshing, setIsRefreshing] = useState(false);\n\n    // Initialize store with initial filters if provided and store is empty\n    useEffect(() => {\n        if (initialAvailableFilters && availableFilters.tags.length === 0) {\n            setAvailableFilters(initialAvailableFilters);\n        }\n    }, [initialAvailableFilters, setAvailableFilters, availableFilters.tags.length]);\n\n\n    // --- 【核心集成】 ---\n    // 1. 【增】使用 useDailyStatusesForMonth Hook 获取状态数据\n    const { data: dailyStatuses, isLoading: isLoadingStatuses } = useDailyStatusesForMonth(selectedMonth);\n\n    // 2. 【增】使用 useUpdateDailyStatus Hook 获取更新函数\n    const { mutate: updateStatus } = useUpdateDailyStatus();\n\n    const handleToggleDailyStatus = useCallback((date: string, currentStatus: boolean) => {\n        // 封装一下，方便 UI 调用\n        updateStatus({ date, isCompleted: !currentStatus });\n    }, [updateStatus]);\n    // --- 结束集成 ---\n\n\n\n    // 在 useEffect 中，我们只负责设置 filter，不再需要自己计算 timeSlot\n    useEffect(() => {\n        // If we have initial data (both dates and tags), we skip the initial fetch.\n        // If only dates are present but tags are missing (e.g. SSR error), we should proceed to fetch to self-heal.\n        const hasDates = initialDates && initialDates.length > 0;\n        const hasTags = initialAvailableFilters && initialAvailableFilters.tags.length > 0;\n\n        if (hasDates && hasTags) return;\n\n        const fetchInitialFilterData = async () => {\n            const today = getTodayInShanghai();\n\n            // Check if URL has a date\n            const dateMatch = window.location.pathname.match(/^\\/date\\/(\\d{4}-\\d{2}-\\d{2})\\/?$/);\n\n            if (dateMatch) {\n                const urlDate = dateMatch[1];\n                const dateFilter = { type: 'date' as const, value: urlDate };\n                setActiveFilter(dateFilter);\n                setSelectedMonth(urlDate.substring(0, 7));\n                sessionStorage.setItem(CACHE_KEY_ACTIVE_FILTER, JSON.stringify(dateFilter));\n                sessionStorage.setItem(CACHE_KEY_SELECTED_MONTH, JSON.stringify(urlDate.substring(0, 7)));\n            } else if (today) {\n                const initialFilter = { type: 'date' as const, value: today };\n\n                // Only set default filter if we are at root (homepage)\n                if (window.location.pathname === '/') {\n                    setActiveFilter(initialFilter);\n                    sessionStorage.setItem(CACHE_KEY_ACTIVE_FILTER, JSON.stringify(initialFilter));\n                    // selectedMonth is already initialized correctly via useState lazy init\n                }\n            }\n\n            try {\n                const [availableDates, filters] = await Promise.all([\n                    getAvailableDates(),\n                    getAvailableFilters()\n                ]);\n                setDates(availableDates.sort((a, b) => new Date(b).getTime() - new Date(a).getTime()));\n                setAvailableFilters(filters);\n            } catch (error) {\n                console.error(\"Failed to fetch initial filter data\", error);\n            } finally {\n                setIsInitialLoad(false);\n            }\n        };\n        fetchInitialFilterData();\n    }, [setAvailableFilters, setActiveFilter, initialDates]);\n\n    const refreshFilters = useCallback(async () => {\n        setIsRefreshing(true); // 开始刷新\n        sessionStorage.removeItem(CACHE_KEY_ACTIVE_FILTER);\n        sessionStorage.removeItem(CACHE_KEY_SELECTED_MONTH);\n        try {\n            const [availableDatesNew, filtersNew] = await Promise.all([\n                getAvailableDates(),\n                getAvailableFilters()\n            ]);\n            setDates(availableDatesNew.sort((a, b) => new Date(b).getTime() - new Date(a).getTime()));\n            setAvailableFilters(filtersNew);\n            const today = getTodayInShanghai();\n            if (today) {\n                const resetFilter = { type: 'date' as const, value: today };\n                setActiveFilter(resetFilter);\n                setSelectedMonth(today.substring(0, 7));\n                sessionStorage.setItem(CACHE_KEY_ACTIVE_FILTER, JSON.stringify(resetFilter));\n                sessionStorage.setItem(CACHE_KEY_SELECTED_MONTH, JSON.stringify(today.substring(0, 7)));\n            }\n        } catch (error) {\n            console.error('Failed to refresh sidebar data', error);\n        } finally {\n            setIsRefreshing(false); // 结束刷新\n        }\n    }, [setActiveFilter, setAvailableFilters]);\n\n    const availableMonths = useMemo(() => {\n        const monthSet = new Set<string>();\n        dates.forEach(date => monthSet.add(date.substring(0, 7)));\n        return Array.from(monthSet).sort((a, b) => b.localeCompare(a));\n    }, [dates]);\n\n    const datesForMonth = useMemo(() => {\n        return dates.filter(date => date.startsWith(selectedMonth));\n    }, [dates, selectedMonth]);\n\n    const handleFilterChange = (filter: Filter | null) => {\n        setActiveFilter(filter);\n        if (filter) {\n            sessionStorage.setItem(CACHE_KEY_ACTIVE_FILTER, JSON.stringify(filter));\n            if (filter.type === 'date') {\n                const newMonth = filter.value.substring(0, 7);\n                setSelectedMonth(newMonth);\n                sessionStorage.setItem(CACHE_KEY_SELECTED_MONTH, JSON.stringify(newMonth));\n            }\n        } else {\n            sessionStorage.removeItem(CACHE_KEY_ACTIVE_FILTER);\n        }\n    };\n\n    const handleResetFilter = () => {\n        const today = getTodayInShanghai();\n        if (!today) return;\n        const resetFilter = { type: 'date' as const, value: today };\n        setActiveFilter(resetFilter);\n        setSelectedMonth(today.substring(0, 7));\n        sessionStorage.setItem(CACHE_KEY_ACTIVE_FILTER, JSON.stringify(resetFilter));\n        sessionStorage.setItem(CACHE_KEY_SELECTED_MONTH, JSON.stringify(today.substring(0, 7)));\n    };\n\n    return {\n        isInitialLoad: isInitialLoad,\n        isRefreshing,\n        datesForMonth,\n        availableFilters,\n        selectedMonth,\n        setSelectedMonth,\n        availableMonths,\n        handleFilterChange,\n        handleResetFilter,\n        refreshFilters,\n        dailyStatuses: dailyStatuses || {}, // 确保始终返回一个对象\n        handleToggleDailyStatus\n    };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useReader.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":42},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":7,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'readerArticle' is assigned a value but never used.","line":10,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setReaderArticle' is assigned a value but never used.","line":10,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'selectedArticleId' is assigned a value but never used.","line":13,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":45,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":23},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":45,"column":25,"nodeType":"BlockStatement","messageId":"unexpected","endLine":46,"endColumn":10,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2043,2052],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react';\nimport { Article, CleanArticleContent } from '../types';\nimport { getCleanArticleContent } from '../services/api';\nimport { useArticleStore } from '../store/articleStore'; // 【新增】导入 Zustand store\nimport { useUIStore } from '../store/uiStore';\n\nexport const useReader = () => {\n    const [readerContent, setReaderContent] = useState<CleanArticleContent | null>(null);\n    const [isReaderLoading, setIsReaderLoading] = useState(false);\n    const [readerArticle, setReaderArticle] = useState<Article | null>(null);\n    const articlesById = useArticleStore((state) => state.articlesById); // 【新增】从 store 获取全局文章\n\n    const selectedArticleId = useUIStore(state => state.selectedArticleId);\n    const setSelectedArticleId = useUIStore(state => state.setSelectedArticleId);\n\n    // Map reader actions to modal actions\n    const openModal = useUIStore(state => state.openModal);\n    const closeModal = useUIStore(state => state.closeModal);\n    const modalArticleId = useUIStore(state => state.modalArticleId);\n    const modalInitialMode = useUIStore(state => state.modalInitialMode);\n\n    const isReaderVisible = !!modalArticleId && modalInitialMode === 'reader';\n\n    const openReader = useCallback(() => {\n        // This will be handled in handleOpenReader with the ID\n    }, []);\n\n    const closeReader = closeModal;\n\n    const addArticles = useArticleStore(state => state.addArticles);\n\n    const [readerArticleId, setReaderArticleId] = useState<string | number | null>(null);\n\n    const articleForReader = readerArticleId ? articlesById[readerArticleId] : null;\n    const handleOpenReader = useCallback(async (article: Article) => {\n        addArticles([article]);\n        // 【改】设置当前正在阅读的文章 ID。\n        setReaderArticleId(article.id);\n        openModal(article.id, 'reader');\n        setIsReaderLoading(true);\n        setReaderContent(null);\n        try {\n            const content = await getCleanArticleContent(article);\n            setReaderContent(content);\n        } catch (error) {\n        } finally {\n            setIsReaderLoading(false);\n        }\n    }, [openReader, addArticles]);\n\n    const handleShowArticleInMain = useCallback((article: Article) => {\n        addArticles([article]);\n        setSelectedArticleId(article.id);\n        // setActiveFilter(null); // 移除此行\n        closeReader();\n    }, [addArticles, setSelectedArticleId, closeReader, articlesById]);\n\n    const handleCloseArticleDetail = useCallback(() => {\n        setSelectedArticleId(null);\n    }, [setSelectedArticleId]);\n\n\n    const handleCloseReader = useCallback(() => {\n        closeReader();\n        setReaderArticleId(null);\n    }, [closeReader]);\n\n    return {\n        readerContent,\n        isReaderLoading,\n        isReaderVisible,\n        articleForReader,\n        handleOpenReader,\n        handleShowArticleInMain,\n        handleCloseReader,\n        handleCloseArticleDetail,\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useSidebar.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Article' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getArticlesDetails' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getStarredArticles' is defined but never used.","line":6,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":48},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":17,"column":77,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":17,"endColumn":79}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// hooks/useSidebar.ts\n\nimport { usePathname } from 'next/navigation';\nimport { useState, useCallback, useMemo, useEffect } from 'react';\nimport { Article } from '../types';\nimport { getArticlesDetails, getStarredArticles } from '../services/api'; // getStarredArticles might be needed if you keep the old structure.\nimport { useStarredArticles } from './useArticles'; // 导入新的 Hook\nimport { useUIStore } from '../store/uiStore';\n\nexport type ActiveTab = 'filters' | 'calendar';\n\n// Update useSidebar signature\ninterface UseSidebarProps {\n    initialStarredHeaders?: { id: string | number; title: string; tags: string[] }[];\n}\n\nexport const useSidebar = ({ initialStarredHeaders }: UseSidebarProps = {}) => {\n    const pathname = usePathname();\n    const [activeTab, setActiveTab] = useState<ActiveTab>(() => {\n        if (pathname?.includes('/stream/') || pathname?.includes('/search/') || pathname === '/trends') {\n            return 'filters';\n        }\n        return 'calendar';\n    });\n    const [starredExpanded, setStarredExpanded] = useState<boolean>(false);\n    const activeFilter = useUIStore(state => state.activeFilter);\n\n    // Sync activeTab with activeFilter\n    useEffect(() => {\n        if (activeFilter?.type === 'date') {\n            setActiveTab('calendar');\n        } else if (activeFilter?.type === 'category' || activeFilter?.type === 'tag') {\n            setActiveTab('filters');\n        }\n    }, [activeFilter]);\n\n    // 1. 【核心修改】从 useStarredArticles 中解构 isFetching，传入 initialStarredHeaders\n    const { data: starredArticlesData, isLoading, isFetching, refetch: refreshStarred } = useStarredArticles(initialStarredHeaders);\n\n    // 2. 【核心修改】isLoadingStarred 现在应该同时考虑 isLoading 和 isFetching\n    // isLoading 用于初始加载的骨架屏，isFetching 用于刷新按钮的旋转动画\n    const isLoadingStarred = isLoading || isFetching;\n\n\n    const toggleStarred = useCallback(() => {\n        setStarredExpanded(prev => !prev);\n    }, []);\n\n    // 【改】starredArticles 现在直接使用 useStarredArticles 返回的数据\n    const starredArticles = useMemo(() => {\n        return starredArticlesData || [];\n    }, [starredArticlesData]);\n\n\n    // 【核心修改】在这里新增一行\n    const starredCount = starredArticles.length || 0;\n\n\n    return {\n        activeTab,\n        setActiveTab,\n        starredExpanded,\n        toggleStarred,\n        starredArticles,\n        isLoadingStarred, // 这个状态现在能正确反映刷新动作了\n        refreshStarred,\n        starredCount, // 返回收藏文章数量\n    };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/hooks/useSingleArticle.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":5,"column":88,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":5,"endColumn":90}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery } from '@tanstack/react-query';\nimport { Article } from '../types';\nimport { getArticleStates, getArticlesDetails } from '../services/api';\n\nexport const useSingleArticle = (articleId: string | undefined, initialData?: Article) => {\n    return useQuery({\n        queryKey: ['article', articleId],\n        queryFn: async (): Promise<Article | null> => {\n            if (!articleId) return null;\n\n            // 1. Fetch state (tags, etc.) from FreshRSS\n            // We use getArticleStates which takes an array of IDs\n            const statesMap = await getArticleStates([articleId]);\n            const tags = statesMap[articleId] || [];\n\n            // 2. Fetch details from Supabase\n            // We use getArticlesDetails which takes an array of IDs\n            const detailsMap = await getArticlesDetails([articleId]);\n            const details = detailsMap[articleId];\n\n            // 3. Construct the article object\n            // Even if Supabase has no data (details is undefined), we return a minimal object\n            // so the modal can at least try to render or show a \"not found\" state.\n            // However, without a title, it's hard.\n            // Let's assume if we have an ID, we can at least show the reader view if we fetch content later.\n\n            return {\n                ...details, // Spread Supabase details first\n                id: articleId,\n                title: details?.title || 'Loading...', // Placeholder\n                tags: tags,\n            } as Article;\n        },\n        enabled: !!articleId,\n        initialData: initialData,\n        // Article content (body, title) is immutable.\n        // Metadata (tags, state) is managed via optimistic updates in the store.\n        // Therefore, we can cache the fetch result indefinitely to avoid unnecessary network requests.\n        staleTime: Infinity,\n    });\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/instrumentation-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/instrumentation.ts","messages":[{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":3,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":3,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as Sentry from '@sentry/nextjs';\n\nexport async function register() {\n  if (process.env.NEXT_RUNTIME === 'nodejs') {\n    await import('./sentry.server.config');\n  }\n\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    await import('./sentry.edge.config');\n  }\n}\n\nexport const onRequestError = Sentry.captureRequestError;\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/next.config.mjs","messages":[{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":81,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":81,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {withSentryConfig} from '@sentry/nextjs';\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n    productionBrowserSourceMaps: false,\n    reactStrictMode: true,\n    // experimental: {\n    //     reactCompiler: true,\n    // },\n    images: {\n        formats: ['image/avif', 'image/webp'],\n        remotePatterns: [\n            {\n                protocol: 'https',\n                hostname: 'picsum.photos',\n            },\n        ],\n    },\n    async headers() {\n        return [\n            {\n                source: '/((?!widget/).*)', // Apply security headers to everything EXCEPT /widget/\n                headers: [\n                    {\n                        key: 'X-Frame-Options',\n                        value: 'DENY',\n                    },\n                    {\n                        key: 'X-Content-Type-Options',\n                        value: 'nosniff',\n                    },\n                    {\n                        key: 'Referrer-Policy',\n                        value: 'strict-origin-when-cross-origin',\n                    },\n                ],\n            },\n            {\n                source: '/widget/:path*', // Explicitly allow framing for widget\n                headers: [\n                    {\n                        // 修正 2: 必须添加这个！覆盖掉可能的全局 DENY 或默认限制\n                        key: 'X-Frame-Options',\n                        value: 'ALLOWALL',\n                    },\n                    {\n                        key: 'Access-Control-Allow-Origin',\n                        value: '*', // Allow CORS for fonts/assets\n                    }\n                ],\n            },\n            {\n                source: '/(.*).(jpg|jpeg|png|webp|avif|ico|svg)',\n                headers: [\n                    {\n                        key: 'Cache-Control',\n                        value: 'public, max-age=31536000, immutable',\n                    },\n                ],\n            },\n        ];\n    },\n    async rewrites() {\n        return [\n            {\n                source: '/sitemap.xml',\n                destination: '/api/sitemap',\n            },\n        ];\n    },\n};\n\nexport default withSentryConfig(nextConfig, {\n  // For all available options, see:\n  // https://www.npmjs.com/package/@sentry/webpack-plugin#options\n\n  org: \"alok-rss\",\n\n  project: \"sentry-amber-house\",\n\n  // Only print logs for uploading source maps in CI\n  silent: !process.env.CI,\n\n  // For all available options, see:\n  // https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/\n\n  // Upload a larger set of source maps for prettier stack traces (increases build time)\n  widenClientFileUpload: true,\n\n  // Route browser requests to Sentry through a Next.js rewrite to circumvent ad-blockers.\n  // This can increase your server load as well as your hosting bill.\n  // Note: Check that the configured route will not match with your Next.js middleware, otherwise reporting of client-\n  // side errors will fail.\n  tunnelRoute: \"/monitoring\",\n\n  // Automatically tree-shake Sentry logger statements to reduce bundle size\n  disableLogger: true,\n\n  // Enables automatic instrumentation of Vercel Cron Monitors. (Does not yet work with App Router route handlers.)\n  // See the following for more information:\n  // https://docs.sentry.io/product/crons/\n  // https://vercel.com/docs/cron-jobs\n  automaticVercelMonitors: true,\n});","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/proxy.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":3,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":3,"endColumn":37,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[45,81],"text":"// @ts-expect-error Vercel 会在边缘环境中自动提供全局类型"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":4,"column":8,"nodeType":"FunctionDeclaration","messageId":"missingReturnType","endLine":4,"endColumn":22},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":113,"column":54,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":113,"endColumn":55,"suggestions":[{"messageId":"removeEscape","fix":{"range":[4464,4465],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[4464,4464],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\n\n// @ts-ignore Vercel 会在边缘环境中自动提供全局类型\nexport function proxy(request: Request) {\n\n    const url = new URL(request.url);\n    const userAgent = request.headers.get('user-agent') || '';\n\n    // 0. Anti-Scraping: Block specific AI bots and scrapers\n    const BLOCKED_AGENTS = [\n        'GPTBot',\n        'ChatGPT-User',\n        'CCBot',\n        'anthropic-ai',\n        'Claude-Web',\n        'Google-Extended'\n    ];\n\n    // Priority 0: Explicitly ALLOW Search Engine Bots (Whitelist)\n    // This ensures sitemap and verify requests always get through our logic.\n    // Note: If Vercel Protection is on, this won't bypass it, but it prevents *our* code from blocking.\n    const ALLOWED_BOTS = ['Bingbot', 'Googlebot', 'Baiduspider', 'bingbot', 'googlebot', 'baiduspider'];\n    if (ALLOWED_BOTS.some(bot => userAgent.includes(bot))) {\n        return NextResponse.next();\n    }\n\n    if (BLOCKED_AGENTS.some(agent => userAgent.includes(agent))) {\n        return new Response('Access Denied: Automated access is not permitted.', {\n            status: 403,\n            headers: { 'Content-Type': 'text/plain' }\n        });\n    }\n\n    const accessToken = process.env.ACCESS_TOKEN;\n\n    if (!accessToken) {\n        // If no access token is configured, allow access (or maybe block? assuming allow for now based on \"public access\")\n        // But strictly speaking, if it's not configured, maybe we should just proceed.\n        return NextResponse.next();\n    }\n\n    const urlToken = url.searchParams.get('token');\n\n    // 1. URL Token 鉴权 (Admin Login)\n    if (urlToken === accessToken) {\n        // Remove token from URL but keep path and other params\n        url.searchParams.delete('token');\n        const redirectUrl = url.toString();\n\n        const isSecure = url.protocol === 'https:';\n\n        const response = NextResponse.redirect(redirectUrl);\n        response.cookies.set('site_token', accessToken, {\n            path: '/',\n            httpOnly: true,\n            secure: isSecure,\n            sameSite: 'lax',\n            maxAge: 60 * 60 * 24 * 90\n        });\n        return response;\n    }\n\n    // 2. Cookie 鉴权 (Check if already logged in as Admin)\n    // We don't strictly need to block if cookie is missing/invalid anymore, \n    // because we want to allow public access.\n    // The API routes will handle the strict checks for write operations.\n\n    // However, if the user explicitly visits without a token (and maybe wants to logout/view as guest),\n    // we might want to clear the cookie if the token param is present but wrong? \n    // Or just let the cookie persist until it expires?\n\n    // User complaint: \"I enter without a token, and it didn't restrict me.\"\n    // This implies they expect to be treated as a guest if they don't provide the token in the URL,\n    // even if they were previously logged in.\n    // To support this \"switch to guest\" behavior, we can check:\n    // If NO token in URL -> Do nothing (respect existing cookie).\n    // If token in URL is WRONG -> Clear cookie? No, that's weird.\n\n    // Actually, maybe the user wants: \"If I visit the root URL without ?token=..., I should be a guest.\"\n    // But that would mean every time they refresh the page (which usually clears URL params), they would be logged out.\n    // That's bad UX.\n\n    // Let's assume the user has a STALE cookie and doesn't know it.\n    // I will add a special `?logout=true` handler or just tell the user to clear cookies.\n\n    // But wait, the user said \"Please re-check middleware\".\n    // Maybe they think the middleware should BLOCK access if no token?\n    // \"Implement read-only public access\" -> So NO blocking.\n\n    // Let's try to be stricter: If the user visits with `?token=logout`, clear the cookie.\n    if (url.searchParams.get('logout') === 'true') {\n        const response = new Response(null, {\n            status: 307,\n            headers: {\n                'Location': url.origin,\n                'Set-Cookie': `site_token=; Path=/; HttpOnly; Secure; SameSite=Strict; Max-Age=0`,\n            },\n        });\n        return response;\n    }\n\n    // So, we just let the request proceed.\n    return NextResponse.next();\n}\n\n// 高性能 + 高安全性的 Matcher\n// 它只匹配“页面路由”（不含 . ），而不匹配静态文件\n// 高性能 + 高安全性的 Matcher\n// 它只匹配\"页面路由\"（不含 . ），而不匹配静态文件\n// 排除: api/, _vercel/, sitemap.xml, robots.txt, 以及所有带扩展名的文件（如 .env, .js, .css 等）\nexport const config = {\n    matcher: [\n        '/((?!api/|_vercel/|sitemap.xml|robots.txt|.+\\..+).*)',\n    ],\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/sentry.edge.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/sentry.server.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/services/api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[319,322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[319,322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":66,"column":92,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":66,"endColumn":94},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":155,"column":16,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":155,"endColumn":45},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":247,"column":76,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":247,"endColumn":78},{"ruleId":"@typescript-eslint/explicit-module-boundary-types","severity":1,"message":"Missing return type on function.","line":253,"column":77,"nodeType":"ArrowFunctionExpression","messageId":"missingReturnType","endLine":253,"endColumn":79}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Article, BriefingReport, Tag, CleanArticleContent, AvailableFilters, Filter, GroupedArticles, TimeSlot } from '../types';\nimport { STAR_TAG } from '../constants';\n\n\n\n// --- Centralized API Service ---\ninterface RequestOptions extends Omit<RequestInit, 'body'> {\n    params?: Record<string, string>;\n    body?: any;\n}\n\nconst getBaseUrl = () => {\n    if (typeof window !== 'undefined') return window.location.origin;\n    if (process.env.NEXT_PUBLIC_BASE_URL) return process.env.NEXT_PUBLIC_BASE_URL;\n    if (process.env.VERCEL_URL) return `https://${process.env.VERCEL_URL}`;\n    // Fallback for local development if variable not set\n    return 'http://localhost:3000';\n};\n\nconst apiService = {\n    async request<T>(endpoint: string, options: RequestOptions = {}): Promise<T> {\n        const url = new URL(endpoint, getBaseUrl());\n        if (options.params) {\n            Object.entries(options.params).forEach(([key, value]) => {\n                url.searchParams.append(key, value);\n            });\n        }\n\n        const config: RequestInit = {\n            method: options.method || 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                ...options.headers,\n            },\n            ...options,\n        };\n\n        if (options.body) {\n            config.body = JSON.stringify(options.body);\n        }\n\n        try {\n            const response = await fetch(url.toString(), config);\n            if (!response.ok) {\n                const errorData = await response.json().catch(() => ({ message: `API request failed with status ${response.status} ` }));\n                throw new Error(errorData.message);\n            }\n            const result = await response.json();\n            return result;\n        } catch (error) {\n            console.error(`API request to ${endpoint} failed: `, error);\n            // Only show toast on client side\n            if (typeof window !== 'undefined') {\n                showToast(error instanceof Error ? error.message : 'An unknown error occurred.', 'error');\n            }\n            throw error;\n        }\n    },\n};\n\nimport { useToastStore } from '../store/toastStore';\n\n// ... (existing imports)\n\n// --- Reusable Toast Notification Utility ---\nexport const showToast = (message: string, type: 'success' | 'error' | 'info' = 'success') => {\n    useToastStore.getState().showToast(message, type);\n};\n\n// --- Helper for Shanghai Timezone ---\nexport const getTodayInShanghai = (): string => {\n    const formatter = new Intl.DateTimeFormat('en-CA', {\n        year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Shanghai'\n    });\n    return formatter.format(new Date());\n};\n\nexport const getCurrentTimeSlotInShanghai = (): 'morning' | 'afternoon' | 'evening' => {\n    const now = new Date();\n    const hour = parseInt(new Intl.DateTimeFormat('en-US', {\n        hour: '2-digit',\n        hour12: false,\n        timeZone: 'Asia/Shanghai'\n    }).format(now), 10);\n\n    if (hour >= 0 && hour < 12) {\n        return 'morning';\n    } else if (hour >= 12 && hour < 19) {\n        return 'afternoon';\n    } else {\n        return 'evening';\n    }\n};\n\n// --- Refactored API Functions ---\n\n// 【增】为 getArticlesByLabel 创建一个语义化的别名\nexport const getRawStarredArticles = (): Promise<Article[]> => {\n    // 复用 getArticlesByLabel，传入固定的 \"starred\" 标签 ID，获取 50 条\n    return getArticlesByLabel({ type: 'starred', value: STAR_TAG }, undefined, 50).then(res => res.articles);\n};\n\n\n\nexport const getAvailableDates = (): Promise<string[]> => {\n    return apiService.request<string[]>('/api/get-available-dates', {\n        params: { _t: Date.now().toString() }\n    }).catch(() => []);\n};\n\nexport const getBriefingReportsByDate = async (date: string, slot?: TimeSlot): Promise<BriefingReport[]> => {\n    const params: Record<string, string> = { date };\n    if (slot) params.slot = slot;\n\n    try {\n        const data = await apiService.request<GroupedArticles>('/api/get-briefings', { params });\n        if (!data || Object.values(data).every(arr => arr.length === 0)) return [];\n\n        const reportTitle = `${new Date(date).toLocaleString('zh-CN', { month: 'long', day: 'numeric' })} 简报`;\n        return [{ id: 1, title: reportTitle, articles: data }];\n    } catch {\n        return [];\n    }\n};\n\nexport const getArticlesDetails = (articleIds: (string | number)[]): Promise<Record<string, Article>> => {\n    if (!articleIds || articleIds.length === 0) {\n        return Promise.resolve({});\n    }\n    // 使用 URLSearchParams 来正确处理数组参数\n    const params = new URLSearchParams();\n    articleIds.forEach(id => params.append('articleIds', String(id)));\n\n    // 调用我们刚刚修改的 get-briefings 端点\n    return apiService.request<Record<string, Article>>(`/api/get-briefings?${params.toString()}`);\n};\n\nexport const markAllAsRead = (articleIds: (string | number)[]): Promise<(string | number)[]> => {\n    if (!articleIds || articleIds.length === 0) return Promise.resolve([]);\n\n    return apiService.request<void>('/api/update-state', {\n        method: 'POST',\n        body: { articleIds, action: 'read', isAdding: true },\n    }).then(() => {\n        // 【核心修改】成功后，在这里显示 Toast 并返回 articleIds\n        showToast(`已将 ${articleIds.length} 篇文章设为已读`, 'success');\n        return articleIds;\n    });\n};\n// --- Article Content Cache ---\nconst articleCache = new Map<string | number, CleanArticleContent>();\n\nexport const getCleanArticleContent = async (article: Article): Promise<CleanArticleContent> => {\n    if (articleCache.has(article.id)) {\n        return articleCache.get(article.id)!;\n    }\n    try {\n        const content = await apiService.request<CleanArticleContent>('/api/articles', {\n            method: 'POST',\n            body: { id: article.id },\n        });\n        articleCache.set(article.id, content);\n        return content;\n    } catch {\n        return {\n            title: article.title,\n            source: article.sourceName,\n            content: `< h3 > 无法加载文章内容 < /h3><p>获取文章内容时出错。请尝试直接访问原文链接。</p > <p><a href=\"${article.link}\" target = \"_blank\" rel = \"noopener noreferrer\" > 点击此处查看原文 < /a></p > `,\n        };\n    }\n};\n\nexport const getArticleStates = (articleIds: (string | number)[]): Promise<{ [key: string]: string[] }> => {\n    if (!articleIds || articleIds.length === 0) return Promise.resolve({});\n    return apiService.request<{ [key: string]: string[] }>('/api/article-states', {\n        method: 'POST',\n        body: { articleIds },\n    }).catch(() => {\n        const states: { [key: string]: string[] } = {};\n        articleIds.forEach(id => { states[String(id)] = []; });\n        return states;\n    });\n};\n\nexport const editArticleState = (articleId: string | number, action: 'star' | 'read', isAdding: boolean): Promise<void> => {\n    return apiService.request<void>('/api/update-state', {\n        method: 'POST',\n        body: { articleId, action, isAdding },\n    });\n};\n\nexport const editArticleTag = async (articleId: string | number, tagsToAdd: string[], tagsToRemove: string[]): Promise<void> => {\n    // API 调用保持不变\n    await apiService.request<void>('/api/update-state', {\n        method: 'POST',\n        body: {\n            articleId,\n            tagsToAdd: tagsToAdd,\n            tagsToRemove: tagsToRemove,\n        },\n    });\n\n    // 【核心修改】成功后，在这里直接显示 Toast\n    if (tagsToAdd.length > 0 || tagsToRemove.length > 0) {\n        const extractLabel = (tag: string) => decodeURIComponent(tag.split('/').pop() || tag);\n        const added = tagsToAdd.map(extractLabel).join(', ');\n        const removed = tagsToRemove.map(extractLabel).join(', ');\n        let message = '';\n        if (added) message += `成功添加标签: ${added} `;\n        if (removed) message += `${added ? ' ' : ''} 成功移除标签: ${removed} `;\n        showToast(message.trim(), 'success');\n    }\n};\n\nexport const getArticlesByLabel = (filter: Filter, continuation?: string, n: number = 20): Promise<{ articles: Article[], continuation?: string }> => {\n    const params: Record<string, string> = { value: filter.value, n: String(n) };\n    if (continuation) params.c = continuation;\n\n    return apiService.request<{ articles: Article[], continuation?: string }>('/api/articles-categories-tags', {\n        params,\n    });\n    // ❌ 删除 .catch(() => []); \n    // 这样我们才能在控制台看到真正的红色报错\n};\n\nexport const getStarredArticles = (): Promise<Article[]> => {\n    // Reuse getArticlesByLabel with the specific stream ID for starred articles, fetch 50 items\n    return getArticlesByLabel({ type: 'starred', value: STAR_TAG }, undefined, 50).then(res => res.articles);\n};\n\nexport const getAvailableFilters = (): Promise<AvailableFilters> => {\n    return apiService.request<AvailableFilters>('/api/list-categories-tags').catch(() => ({ categories: [], tags: [] }));\n};\n\nexport const getTags = async (): Promise<Tag[]> => {\n    try {\n        const filters = await getAvailableFilters();\n        return filters.tags;\n    } catch (error) {\n        console.error('Failed to fetch tags', error);\n        return [];\n    }\n};\n\n\n// 【增】获取每日简报完成状态\nexport const getDailyStatuses = async (startDate: string, endDate: string) => {\n    return apiService.request<Record<string, boolean>>('/api/daily-statuses', {\n        params: { start_date: startDate, end_date: endDate },\n    });\n};\n\nexport const updateDailyStatus = async (date: string, isCompleted: boolean) => {\n    return apiService.request<{ success: boolean, date: string, is_completed: boolean }>('/api/daily-statuses', {\n        method: 'POST',\n        body: { date, is_completed: isCompleted },\n    });\n};\n\n\n\n\n// 【增加】搜索文章\nexport const searchArticlesByKeyword = (query: string): Promise<Article[]> => {\n    return apiService.request<Article[]>('/api/search-articles', {\n        params: { query },\n    }).catch(() => []);\n};","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/services/articleLoader.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1471,1474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1471,1474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2461,2464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2461,2464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// services/articleLoader.ts\n\nimport {\n    getBriefingReportsByDate,\n    getRawStarredArticles,\n    getArticlesByLabel,\n    getStarredArticles,\n    getArticlesDetails,\n    getArticleStates,\n    searchArticlesByKeyword\n} from './api';\nimport { Article } from '../types';\n\n// --- 数据融合辅助函数 ---\n\n// 负责为 “FreshRSS文章” 补充 “Supabase详情”\nasync function mergeWithSupabaseDetails(freshArticles: Article[]): Promise<Article[]> {\n    if (!freshArticles || freshArticles.length === 0) return [];\n\n    try {\n        const articleIds = freshArticles.map(a => a.id);\n        const supaDetailsById = await getArticlesDetails(articleIds);\n        return freshArticles.map(freshArticle => {\n            const supaDetails = supaDetailsById[freshArticle.id];\n            // 合并时，以 FreshRSS 的数据为基础，用 Supabase 的详情（AI字段）覆盖它\n            // 之前的错误顺序导致空字符串覆盖了有价值的内容\n            return supaDetails ? { ...freshArticle, ...supaDetails } : freshArticle;\n        });\n    } catch (error) {\n        console.warn('Failed to merge Supabase details, returning fresh articles only:', error);\n        // 如果融合失败（比如 URL 太长），降级返回原始文章，保证列表能显示\n        return freshArticles;\n    }\n}\n\n// --- 导出的“数据加载器”函数 ---\n\n// 1. 加载简报文章（已融合）\n// 简报必须融合，因为需要 verdict.importance 进行分组\nexport async function fetchBriefingArticles(date: string, slot: string | null): Promise<Article[]> {\n    console.log(`[Loader] Fetching briefing for date: ${date}, slot: ${slot}`);\n    const fetchedReports = await getBriefingReportsByDate(date, slot as any);\n    const supaArticles = fetchedReports.flatMap(report => Object.values(report.articles).flat());\n    if (supaArticles.length === 0) return [];\n\n    const articleIds = supaArticles.map(a => a.id);\n    const statesById = await getArticleStates(articleIds);\n\n    return supaArticles.map(supaArticle => ({\n        ...supaArticle,\n        briefingSection: supaArticle.verdict?.importance || '常规更新',\n        tags: statesById[supaArticle.id] || [],\n    }));\n}\n\n// 2. 加载分类/标签文章（【核心修改】不再融合）\n// 2. 加载分类/标签文章\nexport async function fetchFilteredArticles(\n    filterValue: string,\n    continuation?: string,\n    n: number = 20,\n    merge: boolean = true // Changed back to true to ensure Client loads AI data by default\n): Promise<{ articles: Article[], continuation?: string }> {\n    console.log(`[Loader] Requesting articles for: ${filterValue}, continuation: ${continuation}, merge: ${merge}`);\n\n    // 1. 获取 FreshRSS 数据\n    const response = await getArticlesByLabel({ value: filterValue } as any, continuation, n);\n\n    // 2. 根据 merge 参数决定是否融合 Supabase 详情\n    if (merge) {\n        console.log('[Loader] Merging with Supabase details for Tag Page SSR...');\n        const mergedArticles = await mergeWithSupabaseDetails(response.articles);\n        return { ...response, articles: mergedArticles };\n    }\n\n    // 默认情况：直接返回，不预加载详情（客户端点击弹窗时再加载）\n    return response;\n}\n\n// 3. 加载收藏文章（【核心修改】建议也不再融合，保持一致性）\nexport async function fetchStarredArticles(): Promise<Article[]> {\n    const freshArticles = await getStarredArticles();\n    return freshArticles; // 直接返回\n}\n\n\n// 4. 加载收藏文章的“头部信息”（仅 ID 和标题，供侧边栏初始化使用）\nexport async function fetchStarredArticleHeaders(): Promise<{ id: string | number; title: string }[]> {\n    const freshArticles = await getRawStarredArticles();\n    return freshArticles.map(article => ({\n        id: article.id,\n        title: article.title,\n    }));\n}\n\n// 5. 搜索（保持融合，或者也可以改为不融合）\n// 搜索通常返回结果较少，且 Supabase 是搜索源，所以逻辑稍有不同\nexport async function fetchSearchResults(query: string): Promise<Article[]> {\n    // 搜索源是 Supabase，所以这里天然就有 Supabase 数据\n    const supaArticles = await searchArticlesByKeyword(query);\n    if (supaArticles.length === 0) return [];\n\n    const articleIds = supaArticles.map(a => a.id);\n    const statesById = await getArticleStates(articleIds);\n\n    return supaArticles.map(supaArticle => ({\n        ...supaArticle,\n        tags: statesById[supaArticle.id] || [],\n    }));\n}\n\n// 6. 预解析简报头图 URL\nexport async function resolveBriefingImage(date: string): Promise<string> {\n    // 【优化】恢复使用 Picsum，但不再进行服务端 Fetch 探测。\n    // 直接返回 Seed URL 既能保留每日一图的特性，又消除了 1.5s 的 TTFB 阻塞。\n    // Next.js Image 组件会自动处理 URL 及其重定向。\n    return `https://picsum.photos/seed/${date}/1600/1200`;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/store/articleStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/store/toastStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_state' is defined but never used.","line":22,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\n\nexport interface ToastState {\n    isVisible: boolean;\n    message: string;\n    type: 'success' | 'error' | 'info';\n}\n\ninterface ToastStore extends ToastState {\n    showToast: (message: string, type?: 'success' | 'error' | 'info') => void;\n    hideToast: () => void;\n}\n\nexport const useToastStore = create<ToastStore>((set) => ({\n    isVisible: false,\n    message: '',\n    type: 'info',\n\n    showToast: (message, type = 'info') => {\n        set({ isVisible: true, message, type });\n        setTimeout(() => {\n            set((_state) => {\n                // Only hide if the message hasn't changed (simple debounce/conflict resolution)\n                // Actually, for simplicity, just hide. If a new toast came in, it would have set isVisible=true again.\n                // But we need to be careful not to hide a *new* toast if the timeout overlaps.\n                // A simple way is to check if the message is still the same, but that's not perfect.\n                // For now, let's just hide. A more robust solution would use IDs.\n                // Given the requirements, a simple implementation is likely sufficient.\n                return { isVisible: false };\n            });\n        }, 3000);\n    },\n\n    hideToast: () => set({ isVisible: false }),\n}));\n","usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/store/uiStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/types/freshrss-greader.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/types/optional-mods.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/types/supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/utils/colorUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/utils/contentUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/utils/dateUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/utils/idHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Alok/alok-rss-daily/utils/indexnow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]