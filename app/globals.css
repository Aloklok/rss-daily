@import 'tailwindcss';
@plugin '@tailwindcss/typography';

@theme {
  /* Colors */
  --color-midnight-bg: oklch(90.39% 0.034 81.39);
  --color-midnight-sidebar: oklch(25.32% 0.052 291.68);
  --color-midnight-card: oklch(20.3% 0.039 270.62);
  --color-midnight-selected: oklch(57.06% 0.178 351.27);
  --color-midnight-border: oklch(20.3% 0.039 270.62);
  --color-midnight-text-primary: oklch(0% 0 0);
  --color-midnight-text-reader: oklch(0% 0 0);
  --color-midnight-text-secondary: oklch(66.6% 0.024 266.38);
  --color-midnight-text-title: oklch(0% 0 0);
  --color-midnight-metadata-bg: oklch(95.05% 0.009 95.83);
  --color-midnight-badge: oklch(28.25% 0.036 261.27);

  /* Callout Colors */
  --color-midnight-callout-pink-bg: oklch(94.5% 0.046 348.65);
  --color-midnight-callout-pink-title: oklch(21.43% 0.076 343.3);
  --color-midnight-callout-pink-body: oklch(36.19% 0.106 347.01);

  --color-midnight-callout-blue-bg: oklch(89.04% 0.042 277.49);
  --color-midnight-callout-blue-title: oklch(18.06% 0.068 281.33);
  --color-midnight-callout-blue-body: oklch(30.64% 0.126 274.62);

  --color-midnight-callout-orange-bg: oklch(97.16% 0.04 85.04);
  --color-midnight-callout-orange-title: oklch(19.34% 0.059 40.54);
  --color-midnight-callout-orange-body: oklch(35.53% 0.093 42.1);

  --color-midnight-callout-green-bg: oklch(94.5% 0.042 120.91);
  --color-midnight-callout-green-title: oklch(13.62% 0.055 142.12);
  --color-midnight-callout-green-body: oklch(30.29% 0.101 143.91);

  /* Fonts */
  --font-sans:
    var(--font-inter), system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei',
    'Noto Sans CJK SC', sans-serif;
  --font-serif:
    var(--font-playfair), 'Playfair Display', ui-serif, Georgia, Cambria, 'Times New Roman', Times,
    serif;

  /* Background Image */
  --background-image-paper-texture: url('/paper-texture.webp');
}

/* Base Styles & Resets */
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }

  button,
  a,
  [role='button'] {
    cursor: pointer;
  }
}

/* Typography Overrides - Replaces JS config */
@layer utilities {
  .prose {
    --tw-prose-body: var(--color-stone-800);
    /* Stone-800 */
    --tw-prose-headings: var(--color-stone-950);
    /* Stone-950 */
    --tw-prose-links: var(--color-orange-700);
    /* Orange-700 */
    --tw-prose-bold: var(--color-stone-950);
    --tw-prose-counters: var(--color-stone-600);
    --tw-prose-bullets: var(--color-stone-400);
    /* Stone-400 */
    --tw-prose-hr: var(--color-stone-200);
    /* Stone-200 */
    --tw-prose-quotes: var(--color-stone-700);
    --tw-prose-quote-borders: var(--color-orange-500);
    /* Orange-500 */
  }

  /* Dark Mode Prose */
  @media (prefers-color-scheme: dark) {
    .prose-invert {
      --tw-prose-body: var(--color-midnight-text-reader);
      --tw-prose-headings: var(--color-midnight-text-reader);
      --tw-prose-lead: var(--color-midnight-text-reader);
      --tw-prose-links: var(--color-blue-600);
      --tw-prose-bold: var(--color-midnight-text-reader);
      --tw-prose-counters: var(--color-midnight-text-reader);
      --tw-prose-bullets: var(--color-midnight-text-reader);
      --tw-prose-hr: var(--color-gray-300);
      --tw-prose-quotes: var(--color-midnight-text-reader);
      --tw-prose-quote-borders: var(--color-midnight-text-reader);
      --tw-prose-captions: var(--color-midnight-text-reader);
      --tw-prose-code: var(--color-rose-600);
      --tw-prose-pre-code: var(--color-midnight-text-reader);
      --tw-prose-pre-bg: var(--color-gray-800);
      --tw-prose-th-borders: var(--color-midnight-text-reader);
      --tw-prose-td-borders: var(--color-midnight-text-reader);
    }
  }
}

/* Specific Typography Elements */
.prose h1,
.prose h2,
.prose h3,
.prose h4 {
  font-family: var(--font-sans);
  color: var(--color-stone-950);
  font-weight: 800;
  letter-spacing: -0.025em;
  text-wrap: pretty;
}

.prose h2 {
  position: relative;
  font-size: 1.6em;
  margin-top: 2em;
  margin-bottom: 0.8em;
  padding-left: 0.75em;
  border: none;
  line-height: 1.3;
}

.prose h2::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.2em;
  bottom: 0.2em;
  width: 6px;
  border-radius: 99px;
  background-color: var(--color-orange-600);
  /* Orange-600 */
}

.prose h3 {
  position: relative;
  font-size: 1.25em;
  margin-top: 1.5em;
  margin-bottom: 0.6em;
  font-weight: 700;
  padding-left: 0.75em;
}

.prose h3::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0.25em;
  bottom: 0.25em;
  width: 5px;
  border-radius: 99px;
  background-color: var(--color-stone-400);
  /* Stone-400 */
}

.prose p {
  margin-top: 0.2em;
  margin-bottom: 0.6em;
  line-height: 1.6;
  text-wrap: pretty;
}

/* Hide empty P tags */
.prose p:empty {
  display: none;
}

.prose ul,
.prose ol {
  margin-top: 0.2em;
  margin-bottom: 0.6em;
  list-style-position: outside;
  padding-left: 1.25em;
}

.prose ul {
  list-style-type: disc;
}

.prose ol {
  list-style-type: decimal;
}

.prose li {
  margin-top: 0.2em;
  margin-bottom: 0.2em;
}

.prose pre {
  background-color: var(--color-slate-900);
  color: var(--color-slate-200);
  border-radius: 0.5rem;
  padding: 1rem 1.25rem;
  border: 1px solid oklch(100% 0 0 / 10%);
  margin-top: 1rem;
  margin-bottom: 1rem;
  max-height: none;
  /* Override default max-height if set */
  overflow-y: visible;
}

.prose pre code {
  background-color: transparent;
  color: inherit;
  font-size: 0.875em;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-weight: 500;
}

.prose code {
  color: var(--color-orange-900);
  /* Orange-900 */
  background-color: color-mix(in srgb, var(--color-orange-100), transparent 50%);
  padding: 0;
  border-radius: 0.25rem;
  font-weight: 600;
  font-family: monospace;
}

.prose code::before,
.prose code::after {
  content: '';
}

/* Override for Article Reader specifically (Modal & Page) */
#article-reader-content code:not(:where(pre code)),
#article-detail-content code:not(:where(pre code)) {
  color: var(--color-stone-700);
  background-color: var(--color-gray-300);
  font-weight: normal;
  padding: 3px;
}

.prose table {
  width: 100%;
  margin-top: 1.5rem;
  margin-bottom: 1.5rem;
  border-collapse: collapse;
  font-size: 0.95em;
  background-color: transparent;
  padding-left: 1rem;
}

.prose thead {
  background-color: color-mix(in srgb, var(--color-blue-950), transparent 37%);
  border-bottom: 1px solid color-mix(in srgb, var(--color-blue-950), transparent 37%);
}

.prose thead th {
  color: var(--color-stone-950);
  font-weight: 700;
  padding: 0.75rem;
  padding-bottom: 0.4rem !important;
  text-align: center !important;
  font-size: 1.05em;
}

.prose tbody tr {
  border-bottom: 1px solid var(--color-stone-200);
}

.prose tbody td {
  text-align: center !important;
  padding: 0.75rem;
  color: var(--color-stone-700);
  vertical-align: top;
}

/* Force removal of P margin in tables */
.prose tbody td p {
  margin-top: 0;
  margin-bottom: 0;
}

.prose blockquote {
  font-style: normal;
  border-left-color: var(--color-stone-500);
  /* Orange-500 equivalent */
  border-left-width: 4px;
  background-color: transparent;
  color: var(--color-stone-600);
  padding-left: 1.25rem;
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.prose i,
.prose em {
  font-style: italic;
}

.prose a {
  text-decoration: none;
  color: var(--color-orange-700);
  border-bottom: 1px solid color-mix(in srgb, var(--color-orange-700), transparent 70%);
  transition: border-color 0.2s;
}

.prose a:hover {
  border-bottom-color: var(--color-orange-700);
}

/* Image & Video Optimization */
.prose img {
  max-width: 100%;
  height: auto;
  display: block;
}

.prose video {
  max-width: 100%;
  height: auto;
}

.prose img[data-src] {
  min-height: 100px;
}

/* Custom Font Fallback */
@supports (font-variation-settings: normal) {
  body {
    font-family: var(--font-sans);
  }
}

html,
body {
  @apply bg-gray-50 antialiased;
  /* overflow-x: hidden; */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Dark Mode Backgrounds */
@media (prefers-color-scheme: dark) {
  html,
  body {
    @apply bg-midnight-sidebar text-slate-200;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
    background-repeat: repeat;
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background-color: oklch(0% 0 0 / 20%);
  border-radius: 4px;
  border: 2px solid transparent;
  background-clip: content-box;
}

::-webkit-scrollbar-thumb:hover {
  background-color: oklch(0% 0 0 / 40%);
}

/* Firefox Scrollbar */
* {
  scrollbar-width: thin;
  scrollbar-color: oklch(0% 0 0 / 20%) transparent;
}
