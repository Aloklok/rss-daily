# ğŸŒ é¡¹ç›®å›½é™…åŒ– (i18n) æŒ‡å—

æœ¬é¡¹ç›®é‡‡ç”¨äº†åŸºäº **å­—å…¸ (Dictionary-based)** çš„ Next.js å›½é™…åŒ–ç­–ç•¥ã€‚ç›®å‰æ”¯æŒ **ä¸­æ–‡ (zh)** å’Œ **è‹±æ–‡ (en)** ä¸¤å¥—è¯­è¨€ã€‚

---

---

## ğŸ“Œ æ ¸å¿ƒç­–ç•¥å‡†åˆ™ (Strategy Rules)

> âš ï¸ **IMPORTANT**: ä»¥ä¸‹è§„åˆ™ä¸ºé¡¹ç›®é“å¾‹ï¼Œä¿®æ”¹å‰è¯·åŠ¡å¿…ç¡®è®¤ã€‚

1.  **ä¸»ç«™å³ä¸­æ–‡ (Default Chinese)**:
    - `https://www.alok-rss.top/` é»˜è®¤ä¸ºä¸­æ–‡ç‰ˆã€‚
    - **è‡ªåŠ¨åˆ†æµ (Auto Redirect)**: å¿…é¡»åœ¨ç½‘å…³å±‚ (Cloudflare) å®ç°ï¼Œä¸¥ç¦åœ¨ Next.js Middleware ä¸­ç¡¬ç¼–ç é‡å®šå‘é€»è¾‘ï¼Œä»¥å…å¢åŠ è¾¹ç¼˜è®¡ç®—æˆæœ¬å’Œå»¶è¿Ÿã€‚
2.      *   **ç­–ç•¥**: Cloudflare è´Ÿè´£å°†é CN IP ä¸”æ—  Cookie çš„ç”¨æˆ·é‡å®šå‘è‡³ `/en`ï¼›å‰ç«¯ `LanguageSwitcher` è´Ÿè´£å†™å…¥ `NEXT_LOCALE` Cookie ä»¥èµ‹äºˆç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©çš„æœ€é«˜ä¼˜å…ˆçº§ã€‚

3.  **è‹±æ–‡ç‰ˆç‹¬ç«‹ (English Separate)**:
    - è‹±æ–‡ç‰ˆè·¯å¾„å›ºå®šä¸º `/en/` (e.g., `/en/date/2026-01-01`).
    - å¿…é¡»ä¸º `/` å’Œ `/en/` å»ºç«‹åŒå‘çš„ `Hreflang` å…³è”ã€‚

4.  **å†…éƒ¨ç³»ç»Ÿè±å… (Internal Logs Exception)**:
    - **æ—¥å¿—**: ä¸­é—´ä»¶ (`proxy.ts`)ã€æœåŠ¡ç«¯ (`logBotError`) çš„ç³»ç»Ÿæ—¥å¿—ä¿ç•™ä¸­æ–‡æˆ–ç°æœ‰çŠ¶æ€ï¼Œ**ä¸éœ€è¦**å›½é™…åŒ–ã€‚
    - **ç®¡ç†åå°**: `/admin` åŠç›¸å…³ç»„ä»¶ (`BackfillPanel`) ä»…ä¾›ç®¡ç†å‘˜ä½¿ç”¨ï¼Œä¿ç•™ä¸­æ–‡ï¼Œ**ä¸éœ€è¦**å›½é™…åŒ–ã€‚
    - **ç®¡ç†äº¤äº’æç¤º (Admin Toasts)**: å®¢æˆ·ç«¯æ¶‰åŠæ•°æ®å˜æ›´çš„äº¤äº’åé¦ˆï¼ˆå¦‚â€œæ”¶è—æˆåŠŸâ€ã€â€œæ ‡è®°å·²è¯»â€ï¼‰å±äºç®¡ç†å‘˜ä¸“å±åŠŸèƒ½ï¼Œå³ä½¿åœ¨è‹±æ–‡ç‰ˆé¡µé¢è§¦å‘ï¼Œä¹Ÿå¯ä»¥ä¿ç•™ä¸­æ–‡æç¤ºï¼Œ**ä¸éœ€è¦**å›½é™…åŒ–ã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### 1. è¯­è¨€å­—å…¸ (`src/app/i18n/dictionaries.ts`)

æ‰€æœ‰é™æ€æ–‡æœ¬å‡å®šä¹‰åœ¨æ­¤æ–‡ä»¶ä¸­ã€‚å®ƒåŒ…å«ä¸¤ä¸ªå¯¼å‡ºå¸¸é‡ï¼š`zh` å’Œ `en`ã€‚

- **ç±»å‹å®‰å…¨**ï¼š`en` å¿…é¡»ç¬¦åˆ `typeof zh` çš„ç»“æ„ï¼Œç¡®ä¿ä¸¤ç§è¯­è¨€çš„ Key å®Œå…¨åŒæ­¥ã€‚
- **ç»“æ„åŒ–**ï¼šå­—å…¸æŒ‰é¢†åŸŸï¼ˆå¦‚ `nav`, `briefing`, `sidebar`ï¼‰è¿›è¡Œç»„ç»‡ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œç»´æŠ¤ã€‚

### 2. è·¯ç”±ç»“æ„

é¡¹ç›®ä½¿ç”¨ Next.js çš„ **åˆ†ç»„è·¯ç”± (Route Groups)** å’Œ **å¹¶è¡Œè·¯ç”±** æ¥éš”ç¦»ä¸åŒè¯­è¨€çš„é¡µé¢ï¼š

- **é»˜è®¤ (ä¸­æ–‡)**: `src/app/(zh)/`
- **è‹±æ–‡**: `src/app/en/`

æ¯ä¸ªå¯¹åº”çš„é¡µé¢ï¼ˆå¦‚ `date/[date]`ï¼‰éƒ½ä¼šè°ƒç”¨é€šç”¨çš„ Server ç»„ä»¶ï¼ˆå¦‚ `BriefingPageServer`ï¼‰ï¼Œå¹¶ä¼ å…¥ `lang` å‚æ•°ã€‚

### 3. æ•°æ®åº“ç­–ç•¥ (Dual-Table Strategy)

ä¸ºäº†ç¡®ä¿æŸ¥è¯¢æ•ˆç‡å’Œæ•°æ®ç»“æ„çš„çµæ´»æ€§ï¼Œä¸­è‹±æ–‡æ•°æ®åœ¨ç‰©ç†å±‚è¿›è¡Œäº†éš”ç¦»ï¼š

- **`articles`**: å­˜å‚¨ä¸­æ–‡åŸæ–‡ä¸ç®€æŠ¥å†…å®¹ã€‚
- **`articles_en`**: å­˜å‚¨ç”± AI ç¿»è¯‘åçš„è‹±æ–‡å†…å®¹ã€‚
  - **è‡ªåŠ¨ç¿»è¯‘**: `api/system/translate` ç›‘å¬ `articles` æ’å…¥äº‹ä»¶ï¼Œè‡ªåŠ¨ç¿»è¯‘å¹¶å†™å…¥æ­¤è¡¨ã€‚
  - **è‡ªåŠ¨ Embedding**: ç›®å‰ä»…ä¸­æ–‡ (`articles`) å¯ç”¨å‘é‡ç”Ÿæˆï¼Œè‹±æ–‡ç‰ˆæš‚æ—¶ç¦ç”¨ã€‚
- **ç»Ÿä¸€éªŒè¯ (`revalidate-service`)**: è™½ç„¶ç‰©ç†è¡¨åˆ†ç¦»ï¼Œä½†ç¼“å­˜éªŒè¯é€»è¾‘å·²ç»Ÿä¸€æŠ½è±¡ä¸º `RevalidateService`ï¼Œæ”¯æŒé€šè¿‡ Webhook åŠ¨æ€åˆ·æ–°å¯¹åº”è¯­è¨€çš„ç¼“å­˜ (`/` vs `/en`)ã€‚

---

## ğŸ› ï¸ å®ç°æµç¨‹

### 1. ç»Ÿä¸€éªŒè¯æ¶æ„ (Unified Revalidation)

ä¸å†ç»´æŠ¤ä¸¤å¥— API é€»è¾‘ï¼Œè€Œæ˜¯é€šè¿‡ `src/domains/system/services/revalidate-service.ts` ç»Ÿä¸€ç®¡ç†ï¼š

- **ZH Webhook**: `api/system/revalidate` -> è°ƒç”¨ Service `{ lang: 'zh', table: 'articles' }`
- **EN Webhook**: `api/system/revalidate-en` -> è°ƒç”¨ Service `{ lang: 'en', table: 'articles_en' }`

è¯¥æœåŠ¡è‡ªåŠ¨å¤„ç†ï¼š

- Cache Tags (`briefing-data` vs `briefing-data-en`)
- Path Invalidation (`/date/..` vs `/en/date/..`)
- CDN Pre-warming
- Throttling (é˜²æŠ–)

### 2. æœåŠ¡ç«¯é€‰æ‹©å­—å…¸

åœ¨ Server Component ä¸­ï¼Œæ ¹æ® URL è·¯å¾„æˆ–å‚æ•°é€‰æ‹©å¯¹åº”çš„å­—å…¸å¯¹è±¡ï¼š

```typescript
// src/domains/reading/features/BriefingPageServer.tsx
import { zh, en } from '@/app/i18n/dictionaries';

export async function BriefingPage({ lang }: { lang: 'zh' | 'en' }) {
  const dict = lang === 'en' ? en : zh;
  // ... å°† dict ä¼ ç»™ Client Component
}
```

### 3. å®¢æˆ·ç«¯æ¥æ”¶ä¸ä½¿ç”¨

Client Component é€šè¿‡ Props æ¥æ”¶ `dict` å¯¹è±¡ã€‚**ä¸¥ç¦åœ¨ Client Component ä¸­ç›´æ¥å¯¼å…¥ `zh` æˆ– `en`ï¼ˆé™¤éæ˜¯ç”¨äºæµ‹è¯•æˆ–å…œåº•é€»è¾‘ï¼‰**ï¼Œä»¥ç¡®ä¿å“åº”å¼åˆ‡æ¢ã€‚

```tsx
interface Props {
  dict: Dictionary;
}

export default function Sidebar({ dict }: Props) {
  return <span>{dict.sidebar.categories}</span>;
}
```

---

## ğŸ” è¦†ç›–èŒƒå›´

ç›®å‰å·²å®Œæˆå›½é™…åŒ–çš„æ¨¡å—åŒ…æ‹¬ï¼š

- [x] **å¯¼èˆªæ  (Navigation)**: é¦–é¡µã€å½’æ¡£ã€è¶‹åŠ¿ã€è®¢é˜…æºã€‚
- [x] **ä¾§è¾¹æ  (Sidebar)**: æˆ‘çš„æ”¶è—ã€åˆ†ç±»ã€æ ‡ç­¾ã€æœˆä»½åˆ‡æ¢ã€æœç´¢æ¡†ã€‚
- [x] **ç®€æŠ¥è¯¦æƒ… (Briefing)**: å…¨é‡ UI æ±‰åŒ–/è‹±åŒ–ã€‚
- [x] **å†…å®¹å¡ç‰‡ (BriefCard)**: TLDRã€æŠ€æœ¯æ´å¯Ÿã€å¸‚åœºè§‚å¯Ÿã€‚
- [x] **é˜…è¯»å™¨å¼¹çª— (Unified Modal)**: æ”¯æŒåŒè¯­åŸæ–‡/AI ç®€æŠ¥åˆ‡æ¢ã€‚
- [x] **SEO ä¼˜åŒ– (SEO)**:
  - è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„ Titleã€Meta Descriptionã€‚
  - **Hreflang**: é¦–é¡µã€å½’æ¡£ã€è¶‹åŠ¿é¡µã€**èšåˆé¡µ (Stream)** å‡å·²å®ç°åŒå‘äº’æŒ‡ã€‚
  - **Sitemap**: `/en/sitemap.xml` ç‹¬ç«‹ç”Ÿæˆã€‚
  - **Schema**: Archive/Trends é¡µå·²æ³¨å…¥ `CollectionPage` ç»“æ„åŒ–æ•°æ®ã€‚
- [x] **åŸºç¡€è®¾æ–½**:
  - `LanguageSwitcher`: ä½äºæ­£æ–‡å·¦ä¸Šè§’ã€‚
  - Unified Revalidation API: æ”¯æŒåŒè¯­è‡ªåŠ¨ç¼“å­˜åˆ·æ–°ã€‚

---

### 4. åŠ¨æ€å†…å®¹ç¿»è¯‘ (`feed-dictionary.ts`)

é™¤äº† UI é™æ€æ–‡æœ¬ï¼Œæœ¬é¡¹ç›®è¿˜å®ç°äº†å¯¹ FreshRSS æŠ“å–çš„åŠ¨æ€å†…å®¹ï¼ˆåˆ†ç±»ã€æ ‡ç­¾ã€è®¢é˜…æºåç§°ï¼‰çš„å›½é™…åŒ–æ˜ å°„ï¼š

- **ä¸­è‹±æ˜ å°„è¡¨**: å­˜å‚¨åœ¨ `src/app/i18n/feed-dictionary.ts`ã€‚åŒ…å« `categoryEmojis`, `categoryTranslations`, `tagTranslations`, `feedTranslations`ã€‚
- **ç»Ÿä¸€æ˜¾ç¤ºè¾…åŠ©å‡½æ•°**: `src/domains/reading/utils/label-display.ts` å°è£…äº†æ‰€æœ‰æ¸…æ´—ä¸ç¿»è¯‘é€»è¾‘ã€‚
  - **Normalize**: è‡ªåŠ¨å‰¥ç¦» FreshRSS çš„å‰ç¼€ï¼ˆå¦‚ `user/-/label/`ï¼‰ã€‚
  - **Lookup**: åœ¨æŸ¥å­—å…¸åŒ¹é…è‹±æ–‡ key æ—¶ï¼Œä¼šè‡ªåŠ¨å‰”é™¤ Emoji å­—ç¬¦ï¼ˆåŒ…å« `\uFE00-\uFE0F` å˜ä½“é€‰æ‹©ç¬¦ï¼‰ï¼ŒåŒæ—¶ä¿ç•™æ ¸å¿ƒæ–‡å­—ä¸­é—´çš„å†…éƒ¨ç©ºæ ¼ï¼ˆå¦‚ `AI å¤§æ•°æ®`ï¼‰ï¼Œç¡®ä¿ç²¾å‡†åŒ¹é…ã€‚
  - **Decorate**: ä¸­æ–‡æ¨¡å¼ä¸‹ï¼Œå¦‚æœåˆ†ç±»ç¼ºå¤± Emojiï¼Œä¼šè‡ªåŠ¨æ ¹æ®é…ç½®è¡¥é½ã€‚

* **å…ƒæ•°æ®æœ¬åœ°åŒ– (Pre-translation)**: **[é‡è¦]** ç¿»è¯‘ç®¡é“åœ¨ä¿å­˜è‡³ `articles_en` è¡¨å‰ï¼Œä¼šé¢„å…ˆé€šè¿‡ `feed-dictionary` ç¿»è¯‘ `sourceName` å’Œ `category`ã€‚åŒæ—¶ï¼Œç³»ç»Ÿä¼šå°†ä¸»è¡¨çš„ `verdict` (JSONB) å­—æ®µåŸæ ·åŒæ­¥è‡³è‹±æ–‡è¡¨ã€‚è¿™ä¿è¯äº†è‹±æ–‡ç‰ˆæ•°æ®åº“ä¸­çš„å…ƒæ•°æ®ä¸ç»Ÿè®¡åˆ†å€¼ä¸ä¸­æ–‡ç‰ˆå®Œå…¨åŒæ­¥ï¼Œå‰ç«¯æ¸²æŸ“æ—¶æ— éœ€äºŒæ¬¡æŸ¥è¡¨æˆ– JOINã€‚

---

## ğŸ› ï¸ ç»´æŠ¤ä¸æ‰©å±•æŒ‡å— (Maintenance Guide)

å½“æ‚¨åœ¨ FreshRSS ä¸­æ–°å¢äº†åˆ†ç±»ã€æ ‡ç­¾æˆ–è®¢é˜…æºæ—¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åŒæ­¥å›½é™…åŒ–æ•°æ®ï¼š

### 1. æ·»åŠ æ–°åˆ†ç±» (Category)

- **æ–‡ä»¶**: `src/app/i18n/feed-dictionary.ts`
- **æ­¥éª¤**:
  1.  åœ¨ `categoryEmojis` ä¸­æ·»åŠ çº¯æ–‡å­— Key å¯¹åº”çš„ Emojiã€‚
  2.  åœ¨ `categoryTranslations` ä¸­æ·»åŠ çº¯æ–‡å­— Key å¯¹åº”çš„è‹±æ–‡ç¿»è¯‘ã€‚
- **æ’åºè°ƒæ•´**: å¦‚æœéœ€è¦è°ƒæ•´æ–°åˆ†ç±»åœ¨ä¾§è¾¹æ å’Œç­›é€‰é¡µçš„ä¼˜å…ˆçº§ï¼Œè¯·ä¿®æ”¹ `src/domains/reading/constants.ts` ä¸­çš„ `CATEGORY_ORDER` æ•°ç»„ã€‚
- **æ³¨æ„**: æŸ¥æ‰¾ Key æ—¶è¯·å¿½ç•¥åˆ†ç±»åŸæœ‰çš„ Emojiã€‚

### 2. æ·»åŠ æ–°è®¢é˜…æº (Feed)

- **æ–‡ä»¶**: `src/app/i18n/feed-dictionary.ts`
- **æ­¥éª¤**:
  1.  è·å–è®¢é˜…æºçš„ **åŸå§‹æ ‡é¢˜ (Raw Title)**ï¼ˆå¯ä» `/sources` ä¸‹æ‹‰æ¡†ä¸­æŸ¥çœ‹ï¼‰ã€‚
  2.  åœ¨ `feedTranslations` ä¸­ä»¥åŸå§‹æ ‡é¢˜ä¸º Keyï¼Œæ·»åŠ å¯¹åº”çš„è‹±æ–‡ç¿»è¯‘ã€‚

### 3. æ·»åŠ æ–°æ ‡ç­¾ (Tag)

- **æ–‡ä»¶**: `src/app/i18n/feed-dictionary.ts`
- **æ­¥éª¤**: ç›´æ¥åœ¨ `tagTranslations` ä¸­æ·»åŠ æ˜ å°„å³å¯ã€‚

### 4. ç®€æŠ¥ç« èŠ‚ç¿»è¯‘ (Briefing Sections)

- **æ–‡ä»¶**: `src/app/i18n/dictionaries.ts`
- **ä¸­è‹±æ–‡ Key**: `briefing.sections.important`, `briefing.sections.mustKnow`, `briefing.sections.regular`
- **ç°çŠ¶**:
  - **é‡è¦æ–°é—»**: Top Stories
  - **å¿…çŸ¥è¦é—»**: Crucial Insights
  - **å¸¸è§„æ›´æ–°**: Regular Updates
  - è‹±æ–‡ç‰ˆå·²ä¸ä¸­æ–‡ç‰ˆé€»è¾‘ **100% å¯¹é½**ï¼šæ”¯æŒä¸‰çº§è‡ªåŠ¨åˆ†ç»„ï¼Œä¸”ç»„å†…æ–‡ç« æŒ‰ `score` åˆ†å€¼å€’åºæ’åˆ—ã€‚
  - ç»Ÿä¸€é€šè¿‡ `fetchBriefingData(date, 'en')` è·å–æ•°æ®ã€‚

---

## ğŸ“ å¼€å‘è€…è´¡çŒ®æµç¨‹ (Static UI Text)

å¦‚æœæ‚¨éœ€è¦æ·»åŠ æ–°çš„ **é™æ€ UI æ–‡æ¡ˆ**ï¼ˆéè®¢é˜…æ•°æ®ï¼‰ï¼š

1.  æ‰“å¼€ `src/app/i18n/dictionaries.ts`ã€‚
2.  åœ¨ `zh` å¯¹è±¡ä¸­æ·»åŠ  Key å¹¶å†™å…¥ä¸­æ–‡æ–‡æ¡ˆã€‚
3.  åœ¨ `en` å¯¹è±¡ä¸­æ·»åŠ  **å®Œå…¨ç›¸åŒ** çš„ Key å¹¶å†™å…¥è‹±æ–‡ç¿»è¯‘ã€‚
4.  åœ¨å¯¹åº”çš„ç»„ä»¶ä¸­ï¼Œé€šè¿‡ `dict` å±æ€§è°ƒç”¨è¯¥æ–‡æœ¬ã€‚

---

### 6. åŠ¨æ€æ•°æ®ç¿»è¯‘ä¸ URL æ˜ å°„ (Dynamic Data & Slugs)

å¯¹äºæ ‡ç­¾ (Tags)ã€åˆ†ç±» (Categories) å’Œè®¢é˜…æº (Feeds) ç­‰åŠ¨æ€æ•°æ®ï¼Œæˆ‘ä»¬å®æ–½äº† **Slug Mapping** ç­–ç•¥ï¼Œä»¥ç¡®ä¿ URL çš„è¯­ä¹‰åŒ–ä¸ SEO å‹å¥½æ€§ã€‚

- **URL ç­–ç•¥**:
  - **ä¸­æ–‡ç‰ˆ**: `/stream/frontend` (ä¸å†ä½¿ç”¨ encoded ä¸­æ–‡ ID)
  - **è‹±æ–‡ç‰ˆ**: `/en/stream/frontend`
  - **Fallback**: è‹¥æ— ç¿»è¯‘ï¼Œåˆ™å›é€€åˆ° `encoded` ID (e.g. `/stream/%E5%...`)ï¼Œç¡®ä¿å¯è®¿é—®æ€§ã€‚

- **å®ç°æœºåˆ¶ (`slug-helper.ts`)**:
  - **Slug ç”Ÿæˆ (`getSlug`)**: è‡ªåŠ¨å°†å­—å…¸ä¸­çš„è‹±æ–‡ç¿»è¯‘è½¬æ¢ä¸º kebab-case slug (e.g. "AI & Big Data" -> "ai-big-data")ã€‚
  - **åå‘è§£æ (`resolveSlugId`)**: æ ¹æ® URL slug åæŸ¥åŸå§‹ FreshRSS IDã€‚
  - **å‰ç¼€å¤„ç† (`restoreLabelPrefix`)**: åœ¨é€šè¿‡ API è·å–æ•°æ®æ—¶ï¼Œè‡ªåŠ¨è¡¥å…¨ FreshRSS æ‰€éœ€çš„ `user/-/label/` å‰ç¼€ï¼Œç¡®ä¿æ•°æ®æŸ¥è¯¢å‡†ç¡®æ— è¯¯ã€‚

- **å­—å…¸æº**: `src/app/i18n/feed-dictionary.ts` æ”¯æŒ `string` (ç®€å•ç¿»è¯‘) å’Œ `{ label, slug }` (æ‰‹åŠ¨è¦†ç›–) ä¸¤ç§æ ¼å¼ã€‚

## ğŸ”® æœªæ¥è®¡åˆ’

- **AI ç¿»è¯‘æ‰©å®¹**: å¾… AI é¢†åŸŸé€»è¾‘æˆç†Ÿåï¼Œæ‰€æœ‰ AI ç”Ÿæˆçš„å†…å®¹å°†é€šè¿‡ LLM å®ç°å®Œå…¨å¯¹ç­‰æ˜ å°„ç¿»è¯‘ã€‚
