# 基础设施性能审计报告 (Infrastructure Performance Audit)

**日期**: 2026-01-16  
**变更**: Vercel Function 执行区域从 **美国东部 (iad1)** 迁移至 **韩国首尔 (icn1)**

---

## 🚀 核心结论

这是一份非常令人振奋的数据！我们可以直接看到“迁址首尔”带来的质变。通过物理同域（Vercel App 与 Supabase DB 同在首尔），我们成功消除了跨洋网络延迟。

## 📊 数据对比：质的飞跃

| 指标                   | 旧数据 (美国 iad1) | 新数据 (首尔 icn1) | 提升幅度               | 备注                   |
| :--------------------- | :----------------- | :----------------- | :--------------------- | :--------------------- |
| **Full TTFB**          | **1.35 s**         | **966 ms**         | **快了 ~400ms (↓28%)** | 浏览器拿到首字节的时间 |
| **FCP** (首次绘制)     | 2.25 s             | **1.84 s**         | **快了 ~400ms (↓18%)** | 浏览器渲染出首屏内容   |
| **LCP** (最大内容绘制) | 2.28 s             | **1.86 s**         | **快了 ~420ms (↓18%)** | 核心内容（如头图）可见 |
| **TBT** (总阻塞时间)   | 260 ms             | 272 ms             | 基本持平               | JS 执行阻塞主线程      |

---

## 🔍 深度诊断分析

### 1. TTFB 的“天花板”已被捅破

你的 TTFB 从 `1.35s` 降到了 `966ms`。这意味着什么？

- **物理定律验证**：浏览器现在提前了将近 **半秒钟** 拿到了 HTML 源码。这正好对应减去了两次跨太平洋的物理延迟（美国往返）。
- **净处理耗时**：剩余的 `966ms` 说明你的后端逻辑（Supabase 查询 + FreshRSS 同步 + Next.js 渲染）大约需要 **0.5s - 0.7s** 的“净处理时间”。考虑到复杂的 SSR 聚合逻辑，这个速度已经非常扎实。

### 2. 渲染链路：那 0.9s 的“顽疾”依然存在

观察 `FCP - TTFB` 的差值：

- **旧数据**：2.25 - 1.35 = **0.90s**
- **新数据**：1.84 - 0.96 = **0.88s**

**结论**：这个差值几乎没有任何变化。这再次印证了之前的判断：这 `0.9s` 与服务器位置无关，完全是浏览器在处理那 **1.5MB+（解压后）HTML** 和 **135KB JSON** 时的主线程开销（Style Calculation & Layout）。

### 3. LCP 的完美跟随

你的 LCP (`1.86s`) 紧紧贴着 FCP (`1.84s`)。
这说明你的 **图片预加载 (Priority)** 和 **CDN (Cloudflare)** 工作得非常完美。一旦浏览器获准渲染，核心内容瞬间就位，几乎没有额外的资源加载延迟。

---

## 🔮 结论与展望

目前的 **966ms TTFB** 和 **1.84s FCP** 已经是物理层面的最强形态，架构非常稳固。

关于 JSON Payload 的优化（RSC 化）：
经评估，虽然 RSC 可以进一步降低 TBT，但会牺牲**毫秒级客户端筛选**（TimeSlot/Verdict）的极速体验。鉴于当前的性能指标已经非常优秀，且 `__NEXT_DATA__` 中的数据（全部来自 Supabase，不含 FreshRSS 冗余字段）对于交互功能是必需的，我们决定**保持现状**，优先保障交互流畅度。

---

### 地理位置优化的终极推演：Next Stop, Hong Kong?

在"首尔迁址"取得巨大成功后，我们通过日志发现了一个潜在的"重心偏移"现象：
虽然核心数据库 (Supabase) 在首尔，但系统的可用性保护机制 (Fallback) 和部分元数据获取依赖于 **印尼 (Jakarta)** 的 FreshRSS。
且我们的主要目标用户（包括你自己）位于 **香港/中国大陆**。

#### 延迟账本：HKG vs ICN

假设在 **香港** 发起访问，并触发了 3 次串行 FreshRSS 请求（如日志所示）：

| 链路环节                    | 方案 A: Vercel @ Seoul (现状)   | 方案 B: Vercel @ Hong Kong (推演) |
| :-------------------------- | :------------------------------ | :-------------------------------- |
| **User ➔ Vercel**           | 香港 → 首尔 (~45ms)             | 香港同城 (~5ms)                   |
| **Vercel ➔ Supabase** (2次) | 首尔同城 (~2ms)                 | 香港 → 首尔 (~45ms)               |
| **Vercel ➔ FreshRSS** (3次) | 首尔 → 印尼 (~80ms × 3 = 240ms) | 香港 → 印尼 (~40ms × 3 = 120ms)   |
| **Vercel ➔ User**           | 首尔 → 香港 (~45ms)             | 香港同城 (~5ms)                   |
| **理论总耗时 (串行)**       | **~332ms** + 计算耗时           | **~175ms** + 计算耗时             |

#### 结论

**香港 (hkg1)** 可能是比首尔更优的"黄金中转站"。

1.  **几何中心**：它位于 首尔库 和 印尼源 的中间位置，能有效平衡两端的延迟。
2.  **容错红利**：在发生多次串行请求（如 FreshRSS Fallback）时，香港到印尼的低延迟优势会被放大。
3.  **第一公里**：直接覆盖核心用户群，SSL 握手和首字节到达会更快。

> **决策建议**：暂时保持首尔节点稳定运行。若后续需要进一步压榨 TTFB，可尝试将 Vercel 该项目迁移至 `hkg1` 进行 A/B 测试。
